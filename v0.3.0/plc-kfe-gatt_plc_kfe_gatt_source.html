<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DUTs &mdash; pcdshub/lcls-plc-kfe-gatt  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/tree.css?v=837a00b9" />
      <link rel="stylesheet" type="text/css" href="_static/width.css?v=ab210c7a" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/docs-versions-menu.js?v=3d6a1aea"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Data Types" href="plc-kfe-gatt_plc_kfe_gatt_epics.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            pcdshub/lcls-plc-kfe-gatt
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">plc-kfe-gatt</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gatt_pragmas.html">Pragmas</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gatt_nc.html">NC Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gatt_ethercat.html">EtherCAT Terminals</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gatt_boxes.html">Boxes</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gatt_links.html">Links</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">plc_kfe_gatt</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gatt_plc_kfe_gatt_summary.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gatt_plc_kfe_gatt_summary.html#pragmas">Pragmas</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gatt_plc_kfe_gatt_summary.html#libraries">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gatt_plc_kfe_gatt_summary.html#symbols">Symbols</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gatt_plc_kfe_gatt_epics.html">Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="plc-kfe-gatt_plc_kfe_gatt_epics.html#database-records">Database Records</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">DUTs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#e-gastype">E_GasType</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-homestate">E_HomeState</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-maa-states">E_MAA_States</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-maa-states-x">E_MAA_States_X</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-movestate">E_MoveState</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-state">E_State</a></li>
<li class="toctree-l2"><a class="reference internal" href="#st-drl">ST_DRL</a></li>
<li class="toctree-l2"><a class="reference internal" href="#st-vgp">ST_VGP</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#gvls">GVLs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#global-version">Global_Version</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-devices">GVL_Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-gatt">GVL_GATT</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-mot">GVL_MOT</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-pmps">GVL_PMPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-variables">GVL_Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#main">Main</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#pous">POUs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#diagnostics">DIAGNOSTICS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#f-coef-ar">F_COEF_AR</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-ilk-test">FB_ILK_TEST</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-maa">FB_MAA</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-maa-states">FB_MAA_States</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-maa-states-x">FB_MAA_States_X</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-vcn-lin">FB_VCN_Lin</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-vgp">FB_VGP</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-1-plctask">PRG_1_PlcTask</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-gasselection">PRG_GasSelection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-gatt">PRG_GATT</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-ilk">PRG_ILK</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-inj">PRG_INJ</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-motion">PRG_Motion</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-motors-test">PRG_Motors_Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-pmps">PRG_PMPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-transmission">PRG_Transmission</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-vgp">PRG_VGP</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pcdshub/lcls-plc-kfe-gatt</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">DUTs</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/plc-kfe-gatt_plc_kfe_gatt_source.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="duts">
<h1>DUTs<a class="headerlink" href="#duts" title="Link to this heading"></a></h1>
<section id="e-gastype">
<h2>E_GasType<a class="headerlink" href="#e-gastype" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">E_GasType</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">none</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">Nitrogen</span><span class="p">,</span>
    <span class="n">Argon</span>
<span class="p">);</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#e-gastype">E_GasType</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="e-homestate">
<h2>E_HomeState<a class="headerlink" href="#e-homestate" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">E_HomeState</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">H_READY</span><span class="p">,</span>
    <span class="n">H_INIT</span><span class="p">,</span>
    <span class="n">H_RESET_LL</span><span class="p">,</span>
    <span class="n">H_RESET_HL</span><span class="p">,</span>
    <span class="n">H_ENABLE</span><span class="p">,</span>
    <span class="n">H_MOVING</span><span class="p">,</span>
    <span class="n">H_MOVING2</span><span class="p">,</span>
    <span class="n">H_CHECK</span><span class="p">,</span>
    <span class="n">H_RESET</span><span class="p">,</span>
    <span class="n">H_SET_POS</span><span class="p">,</span>
    <span class="n">H_ERROR</span><span class="p">,</span>
    <span class="n">H_WRITE_LL</span><span class="p">,</span>
    <span class="n">H_WRITE_HL</span><span class="p">,</span>
    <span class="n">H_DONE</span>

<span class="p">)</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="e-maa-states">
<h2>E_MAA_States<a class="headerlink" href="#e-maa-states" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">E_MAA_States</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">Unknown</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">Aprt1</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">//</span><span class="n">smallest</span>
    <span class="n">Aprt2</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">Aprt3</span> <span class="o">:=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">Aprt4</span> <span class="o">:=</span> <span class="mi">4</span>
<span class="p">);</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="e-maa-states-x">
<h2>E_MAA_States_X<a class="headerlink" href="#e-maa-states-x" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">E_MAA_States_X</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">Unknown</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">Centered</span><span class="o">:=</span><span class="mi">1</span>
<span class="p">);</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="e-movestate">
<h2>E_MoveState<a class="headerlink" href="#e-movestate" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">E_MoveState</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">ABORT</span><span class="p">,</span>
    <span class="n">INIT</span><span class="p">,</span>
    <span class="n">ENABLE</span><span class="p">,</span>
    <span class="n">FORWARD</span><span class="p">,</span>
    <span class="n">BACKWARDS</span><span class="p">,</span>
    <span class="n">READY</span><span class="p">,</span>
    <span class="n">MOVING</span><span class="p">,</span>
    <span class="n">NEWTARGETPOSITION</span><span class="p">,</span>
    <span class="n">NEWTARGETPOSITION2</span><span class="p">,</span>
    <span class="n">ERROR</span><span class="p">,</span>
    <span class="n">RESET</span><span class="p">,</span>
    <span class="n">HALT</span><span class="p">,</span>
    <span class="n">HOME</span>
<span class="p">)</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="e-state">
<h2>E_State<a class="headerlink" href="#e-state" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;strict&#39;</span><span class="p">}</span>
<span class="n">TYPE</span> <span class="n">E_State</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">unknown</span><span class="p">,</span>
    <span class="n">error</span><span class="p">,</span>
    <span class="n">warning</span><span class="p">,</span>
    <span class="n">ok</span>
<span class="p">);</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="st-drl">
<h2>ST_DRL<a class="headerlink" href="#st-drl" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">ST_DRL</span> <span class="p">:</span>
<span class="n">STRUCT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: TEMP &#39;</span><span class="p">}</span>
    <span class="n">TEMP</span> <span class="n">AT</span><span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: SV &#39;</span><span class="p">}</span>
    <span class="n">SV</span>  <span class="n">AT</span><span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: SC &#39;</span><span class="p">}</span>
    <span class="n">SC</span>  <span class="n">AT</span><span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="st-vgp">
<h2>ST_VGP<a class="headerlink" href="#st-vgp" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">ST_VGP</span> <span class="p">:</span>
<span class="n">STRUCT</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">POS_RBV</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="o">//</span> <span class="n">Inputs</span>
    <span class="n">i_iPosition</span>     <span class="p">:</span>       <span class="n">REAL</span><span class="p">;</span> <span class="o">//</span><span class="n">Encoder</span> <span class="n">position</span> <span class="n">readback</span> <span class="p">(</span><span class="k">if</span> <span class="n">it</span> <span class="n">exists</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ENC_RBV</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="o">//</span> <span class="n">Inputs</span>
    <span class="n">rEnoder_Position</span>        <span class="p">:</span>       <span class="n">REAL</span><span class="p">;</span> <span class="o">//</span><span class="n">Encoder</span> <span class="n">position</span> <span class="n">readback</span> <span class="p">(</span><span class="k">if</span> <span class="n">it</span> <span class="n">exists</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ERROR</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="o">//</span> <span class="n">Inputs</span>
    <span class="n">pv_xError</span>       <span class="p">:</span>       <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">IS_HOMED</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="o">//</span> <span class="n">Inputs</span>
    <span class="n">pv_xHomed</span>       <span class="p">:</span>       <span class="n">BOOL</span> <span class="o">:=</span><span class="n">false</span><span class="p">;</span>


    <span class="o">//</span><span class="n">Softvariables</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ILK_OK</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">xIlkOK</span>  <span class="p">:</span>       <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Interlock</span> <span class="n">Bit</span>
    <span class="o">//</span><span class="n">Manually</span> <span class="n">Pressing</span> <span class="n">valve</span> <span class="s2">&quot;Open/Close&quot;</span> <span class="n">on</span> <span class="n">EDM</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">OPN_SW</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">pv_xOPN_SW</span>      <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">GO_SW</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">pv_xGo_SW</span>       <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">HOME_SW</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">pv_xHome_SW</span>     <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">Reset_SW</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">pv_xReset_SW</span>    <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">Busy</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">xBusy</span>   <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ABORT</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">pv_xABORT_SW</span>    <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>


    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">POS_CTRL</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqPosition</span>    <span class="p">:</span>       <span class="n">REAL</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Outputs</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">POS_DES</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">q_iRawPosition</span>  <span class="p">:</span>       <span class="n">INT</span><span class="p">;</span> <span class="o">//</span><span class="n">Position</span> <span class="n">control</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">STATE</span><span class="p">;</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">mbbi</span> <span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZRST</span> <span class="n">CLOSE</span> <span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONST</span> <span class="n">OPEN</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">TWST</span> <span class="n">PRESS</span> <span class="n">CNTRL</span> <span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">THST</span> <span class="n">MANUAL</span> <span class="n">CNTRL</span> <span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">eValveControl</span>   <span class="p">:</span>       <span class="n">E_VCN</span> <span class="o">:=</span> <span class="n">CloseValve</span><span class="p">;</span> <span class="o">//</span> <span class="n">Valve</span> <span class="n">control</span> <span class="n">state</span>
    <span class="o">///</span> <span class="n">state</span> <span class="n">machine</span> <span class="n">state</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">Axis_STATE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">eState</span><span class="p">:</span> <span class="n">E_MoveState</span><span class="p">;</span> <span class="o">//</span><span class="n">Axis</span> <span class="n">Move</span> <span class="n">state</span>
    <span class="n">ftIlk</span>   <span class="p">:</span>       <span class="n">F_TRIG</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ERR_ID</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">nErrorID</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ERR_MSG</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">sErrorMessage</span> <span class="p">:</span> <span class="n">STRING</span><span class="p">;</span>

<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#e-movestate">E_MoveState</a></p></li>
</ul>
</dd>
</dl>
</section>
</section>
<section id="gvls">
<h1>GVLs<a class="headerlink" href="#gvls" title="Link to this heading"></a></h1>
<section id="global-version">
<h2>Global_Version<a class="headerlink" href="#global-version" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcGenerated&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;no-analysis&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;linkalways&#39;</span><span class="p">}</span>
<span class="o">//</span> <span class="n">This</span> <span class="n">function</span> <span class="n">has</span> <span class="n">been</span> <span class="n">automatically</span> <span class="n">generated</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">project</span> <span class="n">information</span><span class="o">.</span>
<span class="n">VAR_GLOBAL</span> <span class="n">CONSTANT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;const_non_replaced&#39;</span><span class="p">}</span>
    <span class="n">stLibVersion_KFE_GATT</span> <span class="p">:</span> <span class="n">ST_LibVersion</span> <span class="o">:=</span> <span class="p">(</span><span class="n">iMajor</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">iMinor</span> <span class="o">:=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">iBuild</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">iRevision</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nFlags</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sVersion</span> <span class="o">:=</span> <span class="s1">&#39;0.3.0&#39;</span><span class="p">);</span>
<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
<section id="gvl-devices">
<h2>GVL_Devices<a class="headerlink" href="#gvl-devices" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VAR_GLOBAL</span>
<span class="p">(</span><span class="o">*</span><span class="n">AT1K0</span><span class="o">*</span><span class="p">)</span>
<span class="o">///</span> <span class="n">Injector</span>
<span class="o">//</span><span class="n">Valves</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:VCN:70 &#39;</span><span class="p">}</span>
    <span class="n">VCN_70</span> <span class="p">:</span> <span class="n">FB_VCN</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:VVC:71 &#39;</span><span class="p">}</span>
    <span class="n">VVC_71</span> <span class="p">:</span> <span class="n">FB_VVC</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:VVC:72 &#39;</span><span class="p">}</span>
    <span class="n">VVC_72</span> <span class="p">:</span> <span class="n">FB_VVC</span><span class="p">;</span>


    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:VGP:80 &#39;</span><span class="p">}</span>
    <span class="n">VGP_80</span> <span class="p">:</span> <span class="n">FB_VGP</span><span class="p">;</span>

<span class="o">//</span><span class="n">Gauges</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:GCM:70 &#39;</span><span class="p">}</span>
    <span class="n">GCM_70</span><span class="p">:</span> <span class="n">FB_GCM</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:GCM:80 &#39;</span><span class="p">}</span>
    <span class="n">GCM_80</span><span class="p">:</span> <span class="n">FB_GCM</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:GCM:81 &#39;</span><span class="p">}</span>
    <span class="n">GCM_81</span><span class="p">:</span> <span class="n">FB_GCM</span><span class="p">;</span>
    <span class="p">(</span><span class="o">*</span><span class="n">Pseudo</span> <span class="n">gauge</span> <span class="n">device</span> <span class="n">Structure</span> <span class="n">to</span> <span class="n">combine</span> <span class="n">the</span> <span class="n">readings</span> <span class="n">of</span> <span class="n">two</span> <span class="n">GCM</span> <span class="n">gauges</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:GCM:82  &#39;</span><span class="p">}</span>
    <span class="n">GCM_82</span> <span class="p">:</span> <span class="n">ST_VG</span><span class="p">;</span>


<span class="o">/////////////////////////////</span>


    <span class="o">//////////////////////////////////</span>
<span class="o">//</span> <span class="n">MKS275</span> <span class="n">Gauges</span>

<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GPI:111 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GPI_111</span> <span class="p">:</span> <span class="n">FB_MKS275</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GPI:121 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GPI_121</span> <span class="p">:</span> <span class="n">FB_MKS275</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GPI:141 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GPI_141</span> <span class="p">:</span> <span class="n">FB_MKS275</span><span class="p">;</span>

<span class="o">//</span> <span class="n">FB_MKS317</span>

<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GPI:10 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GPI_10</span> <span class="p">:</span> <span class="n">FB_MKS317</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GPI:20 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GPI_20</span> <span class="p">:</span> <span class="n">FB_MKS317</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GPI:11 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GPI_11</span> <span class="p">:</span> <span class="n">FB_MKS317</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GPI:30 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GPI_30</span> <span class="p">:</span> <span class="n">FB_MKS317</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GPI:40 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GPI_40</span> <span class="p">:</span> <span class="n">FB_MKS317</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GPI:50 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GPI_50</span> <span class="p">:</span> <span class="n">FB_MKS317</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GPI:60 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GPI_60</span> <span class="p">:</span> <span class="n">FB_MKS317</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GPI:51 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GPI_51</span> <span class="p">:</span> <span class="n">FB_MKS317</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GPI:80 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GPI_80</span> <span class="p">:</span> <span class="n">FB_MKS317</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GPI:90 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GPI_90</span> <span class="p">:</span> <span class="n">FB_MKS317</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GPI:100 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GPI_100</span> <span class="p">:</span> <span class="n">FB_MKS317</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GPI:110 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GPI_110</span> <span class="p">:</span> <span class="n">FB_MKS317</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GPI:120 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GPI_120</span> <span class="p">:</span> <span class="n">FB_MKS317</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GPI:130 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GPI_130</span> <span class="p">:</span> <span class="n">FB_MKS317</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GPI:140 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GPI_140</span> <span class="p">:</span> <span class="n">FB_MKS317</span><span class="p">;</span>

<span class="o">//</span> <span class="n">FB_MKS422</span>

<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GCC:10 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GCC_10</span> <span class="p">:</span> <span class="n">FB_MKS422</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GCC:20 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GCC_20</span> <span class="p">:</span> <span class="n">FB_MKS422</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GCC:30 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GCC_30</span> <span class="p">:</span> <span class="n">FB_MKS422</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GCC:40 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GCC_40</span> <span class="p">:</span> <span class="n">FB_MKS422</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GCC:50 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GCC_50</span> <span class="p">:</span> <span class="n">FB_MKS422</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GCC:60 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GCC_60</span> <span class="p">:</span> <span class="n">FB_MKS422</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GCC:80 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GCC_80</span> <span class="p">:</span> <span class="n">FB_MKS422</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GCC:90 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GCC_90</span> <span class="p">:</span> <span class="n">FB_MKS422</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GCC:100 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GCC_100</span> <span class="p">:</span> <span class="n">FB_MKS422</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GCC:110 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GCC_110</span> <span class="p">:</span> <span class="n">FB_MKS422</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GCC:120 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GCC_120</span> <span class="p">:</span> <span class="n">FB_MKS422</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GCC:130 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GCC_130</span> <span class="p">:</span> <span class="n">FB_MKS422</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GCC:140 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GCC_140</span> <span class="p">:</span> <span class="n">FB_MKS422</span><span class="p">;</span>




<span class="o">//</span> <span class="n">FB_VRC</span>

<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:VRC:10 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_VRC_10</span> <span class="p">:</span> <span class="n">FB_VRC_EBD</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:VRC:20 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_VRC_20</span> <span class="p">:</span> <span class="n">FB_VRC_EBD</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:VRC:30 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_VRC_30</span> <span class="p">:</span> <span class="n">FB_VRC_EBD</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:VRC:40 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_VRC_40</span> <span class="p">:</span> <span class="n">FB_VRC_EBD</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:VRC:50 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_VRC_50</span> <span class="p">:</span> <span class="n">FB_VRC</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:VRC:60 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_VRC_60</span> <span class="p">:</span> <span class="n">FB_VRC</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:VRC:70 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_VRC_70</span> <span class="p">:</span> <span class="n">FB_VRC</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:VRC:80 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_VRC_80</span> <span class="p">:</span> <span class="n">FB_VRC</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:VRC:90 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_VRC_90</span> <span class="p">:</span> <span class="n">FB_VRC</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:VRC:100 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_VRC_100</span> <span class="p">:</span> <span class="n">FB_VRC</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:VRC:110 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_VRC_110</span> <span class="p">:</span> <span class="n">FB_VRC</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:VRC:120 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_VRC_120</span> <span class="p">:</span> <span class="n">FB_VRC</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:VRC:130 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_VRC_130</span> <span class="p">:</span> <span class="n">FB_VRC</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:VRC:140 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_VRC_140</span> <span class="p">:</span> <span class="n">FB_VRC</span><span class="p">;</span>

<span class="o">//</span> <span class="n">PUMPS</span>
<span class="o">//</span> <span class="n">Turbos</span>
<span class="o">//</span> <span class="n">FB_PTM_Ebara_010M</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:PTM:10 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_PTM_10</span> <span class="p">:</span> <span class="n">FB_PTM_Ebara_010M</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:PTM:20 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_PTM_20</span> <span class="p">:</span> <span class="n">FB_PTM_Ebara_010M</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:PTM:30 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_PTM_30</span> <span class="p">:</span> <span class="n">FB_PTM_Ebara_010M</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:PTM:40 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_PTM_40</span> <span class="p">:</span> <span class="n">FB_PTM_Ebara_010M</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:PTM:80 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_PTM_80</span> <span class="p">:</span> <span class="n">FB_PTM_TwisTorr</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:PTM:120 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_PTM_120</span> <span class="p">:</span> <span class="n">FB_PTM_Ebara_010M</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:PTM:130 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_PTM_130</span> <span class="p">:</span> <span class="n">FB_PTM_Ebara_010M</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:PTM:140 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_PTM_140</span> <span class="p">:</span> <span class="n">FB_PTM_Ebara_010M</span><span class="p">;</span>
<span class="o">//</span> <span class="n">FB_PTM_Ebara_011M</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:PTM:110 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_PTM_110</span> <span class="p">:</span> <span class="n">FB_PTM_Ebara_011M</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Roughing</span>
<span class="o">//</span> <span class="n">FB_EbaraDryPump</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:PMF:10 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_PMF_10</span> <span class="p">:</span> <span class="n">FB_ScrollPump</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:PMF:60 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_PMF_60</span> <span class="p">:</span> <span class="n">FB_ScrollPump</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:PMF:90 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_PMF_90</span> <span class="p">:</span> <span class="n">FB_EbaraDryPump</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:PMF:100 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_PMF_100</span> <span class="p">:</span> <span class="n">FB_EbaraDryPump</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:PMF:110 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_PMF_110</span> <span class="p">:</span> <span class="n">FB_EbaraEVA</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:PMF:120 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_PMF_120</span> <span class="p">:</span> <span class="n">FB_EbaraEVA</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:PMF:140 &#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_PMF_140</span> <span class="p">:</span> <span class="n">FB_EbaraEVA</span><span class="p">;</span>

<span class="o">//</span><span class="n">Roughing</span> <span class="n">DC</span> <span class="n">Valves</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:VCP:110 &#39;</span><span class="p">}</span>
<span class="o">//</span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span>  <span class="s1">&#39;.q_xOPN_DO     :=      TIIB[=+-EL2212_06_25]^DOX Control Channel 1^Control^Output&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span>    <span class="s1">&#39;.q_xOPN_DO     :=      TIIB[=+-ES2004_05_02]^Channel 3^Output&#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_VVC_110</span> <span class="p">:</span> <span class="n">FB_VVC</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:VCP:120 &#39;</span><span class="p">}</span>
<span class="o">//</span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span>  <span class="s1">&#39;.q_xOPN_DO     :=      TIIB[=+-EL2212_06_25]^DOX Control Channel 2^Control^Output&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span>    <span class="s1">&#39;.q_xOPN_DO     :=      TIIB[=+-ES2004_05_02]^Channel 4^Output&#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_VVC_120</span> <span class="p">:</span> <span class="n">FB_VVC</span><span class="p">;</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:VCP:140 &#39;</span><span class="p">}</span>
<span class="o">//</span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span>  <span class="s1">&#39;.q_xOPN_DO     :=      TIIB[=+-EL2212_04_18]^DOX Control Channel 1^Control^Output&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span>    <span class="s1">&#39;.q_xOPN_DO     :=      TIIB[=+-ES2004_05_04]^Channel 3^Output&#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_VVC_140</span> <span class="p">:</span> <span class="n">FB_VVC</span><span class="p">;</span>

<span class="o">//</span><span class="n">PTM</span> <span class="mi">80</span> <span class="n">VRC</span> <span class="n">back</span> <span class="n">stream</span> <span class="n">valve</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:VVC:80 &#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span>    <span class="s1">&#39;.q_xOPN_DO     :=      TIIB[=+-EL2212_04_18]^DOX Control Channel 2^Control^Output&#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_VVC_80</span> <span class="p">:</span> <span class="n">FB_VVC</span><span class="p">;</span>
<span class="o">//</span><span class="n">NEW</span> <span class="n">added</span> <span class="n">Valve</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">the</span> <span class="n">manual</span> <span class="n">valve</span> <span class="n">at</span> <span class="n">the</span> <span class="n">roughing</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">EBD</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:VRC:11 &#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span>    <span class="s1">&#39;.q_xOPN_DO     :=      TIIB[=+-ES2008_02_14]^Channel 1^Output;</span>
                            <span class="o">.</span><span class="n">i_xClsLS</span>       <span class="o">:=</span>      <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">ES1004_03_21</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                            <span class="o">.</span><span class="n">i_xOpnLS</span>       <span class="o">:=</span>      <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">ES1004_03_21</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Input</span><span class="s1">&#39;}</span>


<span class="n">fb_AT1K0_GAS_VRC_11</span> <span class="p">:</span> <span class="n">FB_VRC_EBD</span><span class="p">;</span>

<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:GPI:12 &#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span>    <span class="s1">&#39;.i_iPRESS_R    :=      TIIB[=+-ES3064_01_09]^AI Standard Channel 4^Value&#39;</span><span class="p">}</span>
<span class="n">fb_AT1K0_GAS_GPI_12</span> <span class="p">:</span> <span class="n">FB_MKS317</span><span class="p">;</span>

<span class="n">END_VAR</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-vgp">FB_VGP</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="gvl-gatt">
<h2>GVL_GATT<a class="headerlink" href="#gvl-gatt" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VAR_GLOBAL</span>

<span class="n">fbLogHandler</span><span class="p">:</span> <span class="n">FB_LogHandler</span><span class="p">;</span>
<span class="n">fbLogger</span> <span class="p">:</span> <span class="n">FB_LogMessage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">eSubsystem</span><span class="o">:=</span><span class="n">E_SubSystem</span><span class="o">.</span><span class="n">MPS</span><span class="p">,</span><span class="n">nMinTimeViolationAcceptable</span><span class="o">:=</span><span class="mi">10</span><span class="p">,</span><span class="n">nLocalTripThreshold</span> <span class="o">:=</span> <span class="n">T</span><span class="c1">#500ms);</span>
<span class="n">fbEcatDiagWrapper</span> <span class="p">:</span> <span class="n">FB_EcatDiagWrapper</span><span class="p">;</span>

<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
<section id="gvl-mot">
<h2>GVL_MOT<a class="headerlink" href="#gvl-mot" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VAR_GLOBAL</span>


<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
<section id="gvl-pmps">
<h2>GVL_PMPS<a class="headerlink" href="#gvl-pmps" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VAR_GLOBAL</span>

<span class="o">//</span><span class="n">MPS</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PLC</span><span class="p">:</span><span class="n">KFE</span><span class="p">:</span><span class="n">GATT</span><span class="p">:</span><span class="n">FFO</span><span class="p">:</span><span class="mi">01</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.q_xFastFaultOut:=TIIB[=+-ES2202_00_07]^Channel 1^Output&#39;</span><span class="p">}</span>
    <span class="n">g_FastFaultOutput1</span>  <span class="p">:</span>   <span class="n">FB_HardwareFFOutput</span> <span class="o">:=</span><span class="p">(</span><span class="n">i_sNetID</span><span class="o">:=</span><span class="s1">&#39;172.21.92.73.1.1&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PLC</span><span class="p">:</span><span class="n">KFE</span><span class="p">:</span><span class="n">GATT</span><span class="p">:</span><span class="n">FFO</span><span class="p">:</span><span class="mi">02</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.q_xFastFaultOut:=TIIB[=+-ES2202_00_07]^Channel 2^Output&#39;</span><span class="p">}</span>
    <span class="n">g_FastFaultOutput2</span>  <span class="p">:</span>   <span class="n">FB_HardwareFFOutput</span> <span class="o">:=</span><span class="p">(</span><span class="n">i_sNetID</span><span class="o">:=</span><span class="s1">&#39;172.21.92.73.1.1&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
     <span class="n">pv</span><span class="p">:</span> <span class="n">PLC</span><span class="p">:</span><span class="n">KFE</span><span class="p">:</span><span class="n">GATT</span><span class="p">:</span><span class="n">FF_RESET</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
     <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">xFastFaultReset</span> <span class="p">:</span>   <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PLC</span><span class="p">:</span><span class="n">KFE</span><span class="p">:</span><span class="n">GATT</span><span class="p">:</span><span class="n">ARB</span><span class="p">:</span><span class="mi">01</span>
    <span class="s1">&#39;}</span>
    <span class="n">fbArbiter1</span>   <span class="p">:</span>   <span class="n">FB_Arbiter</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PLC</span><span class="p">:</span><span class="n">KFE</span><span class="p">:</span><span class="n">GATT</span><span class="p">:</span><span class="n">ARB</span><span class="p">:</span><span class="mi">02</span>
    <span class="s1">&#39;}</span>
    <span class="n">fbArbiter2</span>   <span class="p">:</span>   <span class="n">FB_Arbiter</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">AT1K0</span><span class="p">:</span><span class="n">GAS</span><span class="p">:</span><span class="n">MODE</span> <span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">Local</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">PMPS</span><span class="p">;</span>
     <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">xPMPSMode</span>       <span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;:=TIIB[PMPS_PRE]^IO Inputs^Requested Transmission&#39;</span><span class="p">}</span>
    <span class="n">Req_Trans</span> <span class="n">AT</span><span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">ST_PMPS_Attenuator_IO</span><span class="p">;</span>

     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;:=TIIB[PMPS_PRE]^IO Outputs^Current Transmission&#39;</span><span class="p">}</span>
    <span class="n">Cur_Trans</span> <span class="n">AT</span><span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">ST_PMPS_Attenuator_IO</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">AT1K0</span><span class="p">:</span><span class="n">GAS</span><span class="p">:</span><span class="n">PhotonEnergy</span>
    <span class="s1">&#39;}</span>

    <span class="n">rPhotonEnergy</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="n">stStatus</span><span class="p">:</span> <span class="n">ST_AttenuatorStatus</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;:=TIIB[PMPS_PRE]^IO Outputs^bGattStatus&#39;</span><span class="p">}</span>
    <span class="n">bStatus</span>  <span class="n">AT</span><span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span><span class="n">Byte</span><span class="p">;</span>


<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
<section id="gvl-variables">
<h2>GVL_Variables<a class="headerlink" href="#gvl-variables" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VAR_GLOBAL</span>

<span class="p">(</span><span class="o">*</span><span class="n">Transmission</span> <span class="n">related</span> <span class="n">variables</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">AT1K0</span><span class="p">:</span><span class="n">GAS</span><span class="p">:</span><span class="n">GAS_TYPE</span> <span class="p">;</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">mbbi</span> <span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZRST</span> <span class="n">none</span> <span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONST</span> <span class="n">N2</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">TWST</span> <span class="n">Ar</span> <span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">SelectedGas</span><span class="p">:</span> <span class="n">E_GasType</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:CNTRL:CALC_SP;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">HOPR</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">LOPR</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">PREC</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">EGU</span> <span class="s2">&quot;TORR&quot;</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rRequiredPressureSP</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span>  <span class="n">AT1K0</span><span class="p">:</span><span class="n">GAS</span><span class="p">:</span><span class="n">MAA</span><span class="p">:</span><span class="n">GET</span><span class="p">;</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">ZRST</span> <span class="n">Unknown</span><span class="p">;</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">ONST</span> <span class="mf">5.5</span><span class="n">mm</span><span class="p">;</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">TWST</span> <span class="mi">8</span><span class="n">mm</span><span class="p">;</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">THST</span> <span class="mi">10</span><span class="n">mm</span><span class="p">;</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">FRST</span> <span class="mi">13</span><span class="n">mm</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">eSelectedAprt</span><span class="p">:</span><span class="n">E_MAA_States</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span>  <span class="n">AT1K0</span><span class="p">:</span><span class="n">GAS</span><span class="p">:</span><span class="n">MAA</span><span class="p">:</span><span class="n">SET</span><span class="p">;</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">ZRST</span> <span class="n">Unknown</span><span class="p">;</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">ONST</span> <span class="mf">5.5</span><span class="n">mm</span><span class="p">;</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">TWST</span> <span class="mi">8</span><span class="n">mm</span><span class="p">;</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">THST</span> <span class="mi">10</span><span class="n">mm</span><span class="p">;</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">FRST</span> <span class="mi">13</span><span class="n">mm</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">eSetAprt</span><span class="p">:</span><span class="n">E_MAA_States</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">AT1K0</span><span class="p">:</span><span class="n">GAS</span><span class="p">:</span><span class="n">TRANS</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">HOPR</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">LOPR</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">PREC</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span><span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rCalculatedTransmissionValue</span><span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">AT1K0</span><span class="p">:</span><span class="n">GAS</span><span class="p">:</span><span class="n">TRANS_REQ</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">HOPR</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">LOPR</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">PREC</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span><span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rRequestedTransmission</span><span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">AT1K0</span><span class="p">:</span><span class="n">GAS</span><span class="p">:</span><span class="n">TRANS_SP</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">HOPR</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">LOPR</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">PREC</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span><span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rTransmissionSP</span><span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>


    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span>  <span class="n">AT1K0</span><span class="p">:</span><span class="n">GAS</span><span class="p">:</span><span class="n">STATE</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZRST</span> <span class="n">unknown</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONST</span> <span class="n">error</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">TWST</span> <span class="n">warning</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">THST</span> <span class="n">ok</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">eState</span><span class="p">:</span><span class="n">E_State</span><span class="p">;</span>

    <span class="n">TransmissionValue</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">OldTransmissionValue</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">rtNewTrans</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">bChangeAperture</span><span class="p">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bChangeGas</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>



    <span class="p">(</span><span class="o">*</span> <span class="n">EPS</span> <span class="ow">and</span> <span class="n">Interlock</span> <span class="n">Variables</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: AT1K0:GAS:VAC:OVRD_ON ;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">Override</span> <span class="n">OFF</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">Override</span> <span class="n">ON</span><span class="p">;</span>
     <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span><span class="s1">&#39;}</span>
    <span class="n">xSystemOverrideMode</span>     <span class="p">:</span>       <span class="n">BOOL</span><span class="p">;</span> <span class="p">(</span><span class="o">*</span> <span class="n">Global</span> <span class="n">system</span> <span class="n">override</span> <span class="k">for</span> <span class="n">the</span> <span class="n">GATT</span><span class="o">*</span><span class="p">)</span>


    <span class="o">//</span><span class="n">VRC</span> <span class="n">ILK</span> <span class="n">setpoints</span> <span class="n">to</span> <span class="n">OPEN</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:CNTRL:US:SP;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">HOPR</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">LOPR</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">PREC</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">EGU</span> <span class="s2">&quot;TORR&quot;</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rVRC_US_SP</span> <span class="p">:</span><span class="n">REAL</span><span class="o">:=</span><span class="mf">0.001</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:CNTRL:DS:SP;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">HOPR</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">LOPR</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">PREC</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">EGU</span> <span class="s2">&quot;TORR&quot;</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rVRC_DS_SP</span> <span class="p">:</span><span class="n">REAL</span><span class="o">:=</span><span class="mf">0.001</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">AT1K0</span><span class="p">:</span><span class="n">GAS</span><span class="p">:</span><span class="n">MODE</span><span class="p">:</span><span class="n">PressureControl</span> <span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">Local</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">PMPS</span><span class="p">;</span>
     <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">xPressureControlMode</span>    <span class="p">:</span><span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">AT1K0</span><span class="p">:</span><span class="n">GAS</span><span class="p">:</span><span class="n">AtTarget</span> <span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
     <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">xAtTarget</span>       <span class="p">:</span><span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">AT1K0</span><span class="p">:</span><span class="n">GAS</span><span class="p">:</span><span class="n">Moving</span> <span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
     <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">xMoving</span> <span class="p">:</span><span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">AT1K0</span><span class="p">:</span><span class="n">GAS</span><span class="p">:</span><span class="n">OK</span> <span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
     <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">xOK</span>     <span class="p">:</span><span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>


    <span class="p">(</span><span class="o">*</span> <span class="n">Interlock</span> <span class="n">related</span> <span class="n">bits</span><span class="p">,</span> <span class="n">local</span> <span class="n">to</span> <span class="n">the</span> <span class="n">PLC</span><span class="o">*</span><span class="p">)</span>
    <span class="n">US_MAA_OK</span><span class="p">:</span>  <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">US_Turbo_Valves_Open</span><span class="p">:</span>  <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">DS_MAA_OK</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">DS_Turbo_Valves_Open</span><span class="p">:</span>  <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">US_Turbo_Running</span><span class="p">:</span>  <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">DS_Turbo_Running</span><span class="p">:</span>  <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">TwinscrewPumps_Valves_Closed</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">US_Roughing_Valves_Open</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">DS_Roughing_Valves_Open</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">US_Aperture_Closed</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">DS_Aperture_Closed</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

<span class="n">END_VAR</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#e-gastype">E_GasType</a></p></li>
<li><p><a class="reference internal" href="#e-maa-states">E_MAA_States</a></p></li>
<li><p><a class="reference internal" href="#e-state">E_State</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="main">
<h2>Main<a class="headerlink" href="#main" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VAR_GLOBAL</span>

    <span class="o">//</span><span class="n">MAA</span> <span class="n">EBD</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: AT1K0:GAS_MA_X:MMS:1&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[=+-ES7041_02_05]^STM Status^Status^Digital input 1;</span>
                               <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">ES7041_02_05</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
                            <span class="o">//</span>  <span class="o">.</span><span class="n">nRawEncoderINT</span>         <span class="o">:=</span>  <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">E3054_02_17</span><span class="p">]</span><span class="o">^</span><span class="n">AI</span> <span class="n">Standard</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Value</span><span class="s1">&#39;}</span>
    <span class="n">M1</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;AT1K0:GAS_MA_X:MMS:1&#39;</span><span class="p">);</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: AT1K0:GAS_MA_Y:MMS:1&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[=+-ES7041_02_06]^STM Status^Status^Digital input 2;</span>
                               <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">ES7041_02_06</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">1</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bBrakeRelease</span>        <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">ES2004_02_07</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">3</span><span class="o">^</span><span class="n">Output</span><span class="s1">&#39;}</span>
                              <span class="o">//.</span><span class="n">nRawEncoderINT</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">E3054_02_17</span><span class="p">]</span><span class="o">^</span><span class="n">AI</span> <span class="n">Standard</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Value</span><span class="s1">&#39;}</span>
    <span class="n">M2</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;AT1K0:GAS_MA_Y:MMS:1&#39;</span><span class="p">);</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: AT1K0:GAS_MA_X:MMS:2&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[=+-ES7041_02_09]^STM Status^Status^Digital input 1;</span>
                               <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">ES7041_02_09</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="s1">&#39;}</span>
                             <span class="o">//</span> <span class="o">.</span><span class="n">nRawEncoderINT</span>       <span class="o">:=</span>  <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">E3054_02_17</span><span class="p">]</span><span class="o">^</span><span class="n">AI</span> <span class="n">Standard</span> <span class="n">Channel</span> <span class="mi">3</span><span class="o">^</span><span class="n">Value</span><span class="s1">&#39;}</span>
    <span class="n">M3</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;AT1K0:GAS_MA_X:MMS:2&#39;</span><span class="p">);</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: AT1K0:GAS_MA_Y:MMS:2&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[=+-ES7041_02_10]^STM Status^Status^Digital input 2;</span>
                               <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">ES7041_02_10</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">1</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bBrakeRelease</span>        <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">ES2004_02_07</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">4</span><span class="o">^</span><span class="n">Output</span><span class="s1">&#39;}</span>
                             <span class="o">//</span> <span class="o">.</span><span class="n">nRawEncoderINT</span>       <span class="o">:=</span>  <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">E3054_02_17</span><span class="p">]</span><span class="o">^</span><span class="n">AI</span> <span class="n">Standard</span> <span class="n">Channel</span> <span class="mi">4</span><span class="o">^</span><span class="n">Value</span><span class="s1">&#39;}</span>
    <span class="n">M4</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;AT1K0:GAS_MA_Y:MMS:2&#39;</span><span class="p">);</span>
    <span class="o">//</span><span class="n">MAA</span> <span class="n">FEE</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: AT1K0:GAS_MA_X:MMS:3&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[=+-EL7041_04_07]^STM Status^Status^Digital input 2;</span>
                               <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">EL7041_04_07</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">1</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bBrakeRelease</span>        <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">ES2004_04_09</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Output</span><span class="s1">&#39;}</span>
                             <span class="o">//</span> <span class="o">.</span><span class="n">nRawEncoderINT</span>       <span class="o">:=</span>  <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">E3054_04_12</span><span class="p">]</span><span class="o">^</span><span class="n">AI</span> <span class="n">Standard</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Value</span><span class="s1">&#39;}</span>
    <span class="n">M5</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;AT1K0:GAS_MA_X:MMS:3&#39;</span><span class="p">);</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: AT1K0:GAS_MA_Y:MMS:3&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[=+-EL7041_04_08]^STM Status^Status^Digital input 2;</span>
                               <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">EL7041_04_08</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">1</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bBrakeRelease</span>        <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">ES2004_04_09</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Output</span><span class="s1">&#39;}</span>
                             <span class="o">//</span> <span class="o">.</span><span class="n">nRawEncoderINT</span>       <span class="o">:=</span>  <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">E3054_04_12</span><span class="p">]</span><span class="o">^</span><span class="n">AI</span> <span class="n">Standard</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Value</span><span class="s1">&#39;}</span>
    <span class="n">M6</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;AT1K0:GAS_MA_Y:MMS:3&#39;</span><span class="p">);</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: AT1K0:GAS_MA_X:MMS:4&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[=+-EL7041_04_10]^STM Status^Status^Digital input 2;</span>
                               <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">EL7041_04_10</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">1</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bBrakeRelease</span>        <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">ES2004_04_09</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">3</span><span class="o">^</span><span class="n">Output</span><span class="s1">&#39;}</span>
                              <span class="o">//.</span><span class="n">nRawEncoderINT</span>       <span class="o">:=</span>  <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">E3054_04_12</span><span class="p">]</span><span class="o">^</span><span class="n">AI</span> <span class="n">Standard</span> <span class="n">Channel</span> <span class="mi">3</span><span class="o">^</span><span class="n">Value</span><span class="s1">&#39;}</span>
    <span class="n">M7</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;AT1K0:GAS_MA_X:MMS:4&#39;</span><span class="p">);</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: AT1K0:GAS_MA_Y:MMS:4&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[=+-EL7041_04_11]^STM Status^Status^Digital input 2;</span>
                               <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">EL7041_04_11</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">1</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bBrakeRelease</span>        <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">ES2004_04_09</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">4</span><span class="o">^</span><span class="n">Output</span><span class="s1">&#39;}</span>
                            <span class="o">//</span>  <span class="o">.</span><span class="n">nRawEncoderINT</span>       <span class="o">:=</span>  <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">E3054_04_12</span><span class="p">]</span><span class="o">^</span><span class="n">AI</span> <span class="n">Standard</span> <span class="n">Channel</span> <span class="mi">4</span><span class="o">^</span><span class="n">Value</span><span class="s1">&#39;}</span>
    <span class="n">M8</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;AT1K0:GAS_MA_Y:MMS:4&#39;</span><span class="p">);</span>

<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
</section>
<section id="pous">
<h1>POUs<a class="headerlink" href="#pous" title="Link to this heading"></a></h1>
<section id="diagnostics">
<h2>DIAGNOSTICS<a class="headerlink" href="#diagnostics" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">DIAGNOSTICS</span>
<span class="n">VAR</span>
    <span class="o">//</span><span class="n">Change</span> <span class="n">the</span> <span class="n">PLC</span> <span class="n">String</span> <span class="n">Name</span> <span class="n">to</span> <span class="n">the</span> <span class="n">actual</span> <span class="n">PLC</span> <span class="n">NAME</span>
    <span class="n">sPLCName</span> <span class="p">:</span><span class="n">STRING</span> <span class="o">:=</span> <span class="s1">&#39;PLC-KFE_GATT&#39;</span><span class="p">;</span>
    <span class="o">//</span><span class="n">Link</span> <span class="n">the</span> <span class="n">sAMSNetID</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Etherat</span> <span class="n">Master</span> <span class="n">netID</span>
    <span class="n">i_sAMSNetID</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">AMSNETID</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">DO</span> <span class="n">NOT</span> <span class="n">CHANGE</span>
    <span class="n">sAMSNetID</span> <span class="p">:</span> <span class="n">STRING</span><span class="p">;</span> <span class="o">//</span><span class="n">used</span> <span class="k">for</span> <span class="n">EPICS</span> <span class="n">PV</span>
    <span class="n">sLibVersion_LCLS_General</span> <span class="p">:</span> <span class="n">STRING</span><span class="p">;(</span><span class="o">*</span> <span class="o">:=</span> <span class="n">stLibVersion_LCLS_General</span><span class="o">.</span><span class="n">sVersion</span><span class="o">*</span><span class="p">)</span> <span class="p">;</span>
    <span class="n">fbEcatDiag</span><span class="p">:</span><span class="n">FB_EcatDiag</span><span class="p">;</span>
    <span class="n">bAllSlaveStateGood</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bMasterStateGood</span> <span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
    <span class="n">iMasterState</span><span class="p">:</span> <span class="n">WORD</span><span class="p">;</span>
    <span class="n">sMasterState</span><span class="p">:</span><span class="n">STRING</span><span class="p">;</span>
    <span class="n">nSlaveNumber</span> <span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="n">aiSlaveStates</span><span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1..256</span><span class="p">]</span> <span class="n">OF</span> <span class="n">BYTE</span><span class="p">;</span>
    <span class="n">aEcSlaveInfo</span> <span class="p">:</span>  <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1..256</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_EcDevice</span><span class="p">;</span>


    <span class="o">//</span> <span class="n">Infor</span> <span class="n">Data</span> <span class="kn">from</span> <span class="nn">Diagnostics</span> <span class="n">terminals</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:DRL:04 &#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span>        <span class="s1">&#39;.TEMP  :=      TIIB[=+-EL2212_04_18]^DOX Synchron info data Channel 1^Info data 1;</span>
                                 <span class="o">.</span><span class="n">SV</span>        <span class="o">:=</span>      <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">EL2212_04_18</span><span class="p">]</span><span class="o">^</span><span class="n">DOX</span> <span class="n">Synchron</span> <span class="n">info</span> <span class="n">data</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Info</span> <span class="n">data</span> <span class="mi">2</span><span class="p">;</span>
                                 <span class="o">.</span><span class="n">SC</span>        <span class="o">:=</span>      <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">EL2212_04_18</span><span class="p">]</span><span class="o">^</span><span class="n">DOX</span> <span class="n">Synchron</span> <span class="n">info</span> <span class="n">data</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Info</span> <span class="n">data</span> <span class="mi">1</span><span class="s1">&#39;}</span>
    <span class="n">DRL_04</span> <span class="p">:</span> <span class="n">ST_DRL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:DRL:05 &#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span>        <span class="s1">&#39;.TEMP  :=      TIIB[=+-EL2212_05_09]^DOX Synchron info data Channel 1^Info data 1;</span>
                                 <span class="o">.</span><span class="n">SV</span>        <span class="o">:=</span>      <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">EL2212_05_09</span><span class="p">]</span><span class="o">^</span><span class="n">DOX</span> <span class="n">Synchron</span> <span class="n">info</span> <span class="n">data</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Info</span> <span class="n">data</span> <span class="mi">2</span><span class="p">;</span>
                                 <span class="o">.</span><span class="n">SC</span>        <span class="o">:=</span>      <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">EL2212_05_09</span><span class="p">]</span><span class="o">^</span><span class="n">DOX</span> <span class="n">Synchron</span> <span class="n">info</span> <span class="n">data</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Info</span> <span class="n">data</span> <span class="mi">1</span><span class="s1">&#39;}</span>
    <span class="n">DRL_05</span> <span class="p">:</span> <span class="n">ST_DRL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39; pv: AT1K0:GAS:DRL:06 &#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span>        <span class="s1">&#39;.TEMP  :=      TIIB[=+-EL2212_06_25]^DOX Synchron info data Channel 1^Info data 1;</span>
                                 <span class="o">.</span><span class="n">SV</span>        <span class="o">:=</span>      <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">EL2212_06_25</span><span class="p">]</span><span class="o">^</span><span class="n">DOX</span> <span class="n">Synchron</span> <span class="n">info</span> <span class="n">data</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Info</span> <span class="n">data</span> <span class="mi">2</span><span class="p">;</span>
                                 <span class="o">.</span><span class="n">SC</span>        <span class="o">:=</span>      <span class="n">TIIB</span><span class="p">[</span><span class="o">=+-</span><span class="n">EL2212_06_25</span><span class="p">]</span><span class="o">^</span><span class="n">DOX</span> <span class="n">Synchron</span> <span class="n">info</span> <span class="n">data</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Info</span> <span class="n">data</span> <span class="mi">1</span><span class="s1">&#39;}</span>
    <span class="n">DRL_06</span> <span class="p">:</span> <span class="n">ST_DRL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Instaniating</span> <span class="n">a</span> <span class="n">call</span> <span class="n">to</span> <span class="n">the</span> <span class="n">fbEcatDiag</span>
<span class="n">fbEcatDiag</span><span class="p">(</span>
    <span class="n">I_AMSNetId</span><span class="o">:=</span><span class="n">i_sAMSNetID</span> <span class="p">,</span>
    <span class="n">i_xFirstPass</span><span class="o">:=</span> <span class="n">_TaskInfo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">FirstCycle</span><span class="p">,</span>
    <span class="n">q_xAllSlaveStatesGood</span><span class="o">=&gt;</span> <span class="n">bAllSlaveStateGood</span> <span class="p">,</span>
    <span class="n">q_anTermStates</span><span class="o">=&gt;</span> <span class="n">aiSlaveStates</span><span class="p">,</span>
    <span class="n">q_xMasterStateGood</span><span class="o">=&gt;</span><span class="n">bMasterStateGood</span> <span class="p">,</span>
    <span class="n">q_nMasterState</span><span class="o">=&gt;</span> <span class="n">iMasterState</span><span class="p">,</span>
    <span class="n">q_sMasterState</span><span class="o">=&gt;</span> <span class="n">sMasterState</span> <span class="p">,</span>
    <span class="n">q_astEcConfSlaveInfo</span><span class="o">=&gt;</span> <span class="n">aEcSlaveInfo</span> <span class="p">,</span>
    <span class="n">q_nSlaves</span><span class="o">=&gt;</span> <span class="n">nSlaveNumber</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#st-drl">ST_DRL</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="f-coef-ar">
<h2>F_COEF_AR<a class="headerlink" href="#f-coef-ar" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION</span> <span class="n">F_COEF_AR</span> <span class="p">:</span> <span class="n">REAL</span>
<span class="n">VAR_INPUT</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>

<span class="n">END_VAR</span>


<span class="n">END_FUNCTION</span>
</pre></div>
</div>
</section>
<section id="fb-ilk-test">
<h2>FB_ILK_TEST<a class="headerlink" href="#fb-ilk-test" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_ILK_TEST</span>
<span class="n">VAR_INPUT</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
<span class="n">END_VAR</span>


<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</section>
<section id="fb-maa">
<h2>FB_MAA<a class="headerlink" href="#fb-maa" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_MAA</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">fbArbiter</span><span class="p">:</span> <span class="n">FB_Arbiter</span><span class="p">;</span>
    <span class="n">fbFFHWO</span><span class="p">:</span> <span class="n">FB_HardwareFFOutput</span><span class="p">;</span>
    <span class="n">stYStage</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">stXStage</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>

<span class="n">END_VAR</span>
<span class="n">VAR_INPUT</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="p">:</span><span class="n">PMPS</span><span class="p">:</span><span class="n">AribterEnabled</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">bArbiterEnabled</span><span class="p">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;;</span>
     <span class="n">nTransitionAssertionID</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>
    <span class="n">stAprt1</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">stAprt2</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">stAprt3</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">stAprt4</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">stXCen</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">i_DevName</span><span class="p">:</span> <span class="n">STRING</span><span class="o">:=</span> <span class="s1">&#39;AT1K0-MAA&#39;</span><span class="p">;</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">Y</span><span class="p">:</span><span class="n">STATE</span><span class="p">:</span><span class="n">SET</span><span class="p">;</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">ZRST</span> <span class="n">Unknown</span><span class="p">;</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">ONST</span> <span class="mf">5.5</span><span class="n">mm</span><span class="p">;</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">TWST</span> <span class="mi">8</span><span class="n">mm</span><span class="p">;</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">THST</span> <span class="mi">10</span><span class="n">mm</span><span class="p">;</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">FRST</span> <span class="mi">13</span><span class="n">mm</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
     <span class="n">enumSet</span><span class="p">:</span> <span class="n">E_MAA_states</span><span class="p">;</span>
    <span class="n">sPmpsDeviceName</span><span class="p">:</span> <span class="n">STRING</span><span class="p">;</span>
    <span class="n">sTransitionKey</span><span class="p">:</span> <span class="n">STRING</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">Y</span><span class="p">:</span><span class="n">STATE</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">fbStates</span><span class="p">:</span> <span class="n">FB_MAA_States</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">X</span><span class="p">:</span><span class="n">STATE</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">fbStates_X</span><span class="p">:</span> <span class="n">FB_MAA_States_X</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>

    <span class="n">fbYStage</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbXStage</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>


<span class="o">//</span>  <span class="n">fSize1</span><span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span><span class="mf">3.0</span><span class="p">;</span> <span class="o">//</span><span class="n">mm</span>
<span class="o">//</span>  <span class="n">fSize2</span><span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span><span class="mf">7.0</span><span class="p">;</span> <span class="o">//</span><span class="n">mm</span>
<span class="o">//</span>  <span class="n">fSize3</span><span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span><span class="mf">8.5</span><span class="p">;</span> <span class="o">//</span><span class="n">mm</span>
<span class="o">//</span>  <span class="n">fSize4</span><span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span><span class="mf">9.0</span><span class="p">;</span> <span class="o">//</span><span class="n">mm</span>



    <span class="n">bInit</span><span class="p">:</span><span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">tArbiterTimeout</span><span class="p">:</span> <span class="n">TIME</span><span class="o">:=</span> <span class="n">T</span><span class="c1">#10S;</span>
    <span class="n">FFO</span>    <span class="p">:</span>    <span class="n">FB_FastFault</span> <span class="o">:=</span><span class="p">(</span>
        <span class="n">i_DevName</span> <span class="o">:=</span> <span class="s1">&#39;AT1K0-MAA&#39;</span><span class="p">,</span>
        <span class="n">i_Desc</span> <span class="o">:=</span> <span class="s1">&#39;Fault occurs when the PMPS Aribter is switched off for the aperture plate states BPTM&#39;</span><span class="p">,</span>
        <span class="n">i_TypeCode</span> <span class="o">:=</span> <span class="mi">16</span><span class="c1">#AAFF);</span>

<span class="n">END_VAR</span>
<span class="k">if</span><span class="p">(</span><span class="n">bInit</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">stYStage</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stYStage</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stYStage</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">IF_MOVING</span><span class="p">;</span>
    <span class="n">stXStage</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stXStage</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stXStage</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">bInit</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">States</span> <span class="n">settings</span>
    <span class="o">//</span><span class="n">stAprt1</span><span class="o">.</span><span class="n">nRequestAssertionID</span> <span class="o">:=</span> <span class="n">nTransitionAssertionID</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
    <span class="o">//</span><span class="n">stAprt1</span><span class="o">.</span><span class="n">stBeamParams</span> <span class="o">:=</span> <span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">cstFullBeam</span><span class="p">;</span>
    <span class="o">//</span><span class="n">stAprt1</span><span class="o">.</span><span class="n">stBeamParams</span><span class="o">.</span><span class="n">astApertures</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Height</span> <span class="o">:=</span> <span class="n">fSize1</span><span class="p">;</span>
    <span class="o">//</span><span class="n">stAprt1</span><span class="o">.</span><span class="n">stBeamParams</span><span class="o">.</span><span class="n">astApertures</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Width</span> <span class="o">:=</span> <span class="n">fSize1</span><span class="p">;</span>
    <span class="n">stAprt1</span><span class="o">.</span><span class="n">bUseRawCounts</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stAprt1</span><span class="o">.</span><span class="n">bValid</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stAprt1</span><span class="o">.</span><span class="n">stPMPS</span><span class="o">.</span><span class="n">sPmpsState</span> <span class="o">:=</span> <span class="n">CONCAT</span><span class="p">(</span><span class="n">sPmpsDeviceName</span><span class="p">,</span><span class="s1">&#39;-APERTURE1&#39;</span><span class="p">);</span>

    <span class="o">//</span><span class="n">stAprt2</span><span class="o">.</span><span class="n">nRequestAssertionID</span> <span class="o">:=</span> <span class="n">nTransitionAssertionID</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span>
    <span class="o">//</span><span class="n">stAprt2</span><span class="o">.</span><span class="n">stBeamParams</span> <span class="o">:=</span> <span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">cstFullBeam</span><span class="p">;</span>
    <span class="o">//</span><span class="n">stAprt2</span><span class="o">.</span><span class="n">stBeamParams</span><span class="o">.</span><span class="n">astApertures</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Height</span> <span class="o">:=</span> <span class="n">fSize2</span><span class="p">;</span>
    <span class="o">//</span><span class="n">stAprt2</span><span class="o">.</span><span class="n">stBeamParams</span><span class="o">.</span><span class="n">astApertures</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Width</span> <span class="o">:=</span><span class="n">fSize2</span><span class="p">;</span>
    <span class="n">stAprt2</span><span class="o">.</span><span class="n">bUseRawCounts</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stAprt2</span><span class="o">.</span><span class="n">bValid</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stAprt2</span><span class="o">.</span><span class="n">stPMPS</span><span class="o">.</span><span class="n">sPmpsState</span> <span class="o">:=</span> <span class="n">CONCAT</span><span class="p">(</span><span class="n">sPmpsDeviceName</span><span class="p">,</span><span class="s1">&#39;-APERTURE2&#39;</span><span class="p">);</span>

    <span class="o">//</span><span class="n">stAprt3</span><span class="o">.</span><span class="n">nRequestAssertionID</span> <span class="o">:=</span> <span class="n">nTransitionAssertionID</span><span class="o">+</span><span class="mi">3</span><span class="p">;</span>
    <span class="o">//</span><span class="n">stAprt3</span><span class="o">.</span><span class="n">stBeamParams</span> <span class="o">:=</span> <span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">cstFullBeam</span><span class="p">;</span>
    <span class="o">//</span><span class="n">stAprt3</span><span class="o">.</span><span class="n">stBeamParams</span><span class="o">.</span><span class="n">astApertures</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Height</span> <span class="o">:=</span> <span class="n">fSize3</span><span class="p">;</span>
    <span class="o">//</span><span class="n">stAprt3</span><span class="o">.</span><span class="n">stBeamParams</span><span class="o">.</span><span class="n">astApertures</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Width</span> <span class="o">:=</span> <span class="n">fSize3</span><span class="p">;</span>
    <span class="n">stAprt3</span><span class="o">.</span><span class="n">bUseRawCounts</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stAprt3</span><span class="o">.</span><span class="n">bValid</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stAprt3</span><span class="o">.</span><span class="n">stPMPS</span><span class="o">.</span><span class="n">sPmpsState</span> <span class="o">:=</span> <span class="n">CONCAT</span><span class="p">(</span><span class="n">sPmpsDeviceName</span><span class="p">,</span><span class="s1">&#39;-APERTURE3&#39;</span><span class="p">);</span>

    <span class="o">//</span><span class="n">stAprt4</span><span class="o">.</span><span class="n">nRequestAssertionID</span> <span class="o">:=</span> <span class="n">nTransitionAssertionID</span><span class="o">+</span><span class="mi">4</span><span class="p">;</span>
    <span class="o">//</span><span class="n">stAprt4</span><span class="o">.</span><span class="n">stBeamParams</span> <span class="o">:=</span> <span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">cstFullBeam</span><span class="p">;</span>
    <span class="o">//</span><span class="n">stAprt4</span><span class="o">.</span><span class="n">stBeamParams</span><span class="o">.</span><span class="n">astApertures</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Height</span> <span class="o">:=</span> <span class="n">fSize4</span><span class="p">;</span>
    <span class="o">//</span><span class="n">stAprt4</span><span class="o">.</span><span class="n">stBeamParams</span><span class="o">.</span><span class="n">astApertures</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Width</span> <span class="o">:=</span> <span class="n">fSize4</span><span class="p">;</span>
    <span class="n">stAprt4</span><span class="o">.</span><span class="n">bUseRawCounts</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stAprt4</span><span class="o">.</span><span class="n">bValid</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stAprt4</span><span class="o">.</span><span class="n">stPMPS</span><span class="o">.</span><span class="n">sPmpsState</span> <span class="o">:=</span> <span class="n">CONCAT</span><span class="p">(</span><span class="n">sPmpsDeviceName</span><span class="p">,</span><span class="s1">&#39;-APERTURE4&#39;</span><span class="p">);</span>

    <span class="o">//</span><span class="n">stXCen</span><span class="o">.</span><span class="n">nRequestAssertionID</span> <span class="o">:=</span> <span class="n">nTransitionAssertionID</span><span class="o">+</span><span class="mi">6</span><span class="p">;</span>
    <span class="o">//</span><span class="n">stXCen</span><span class="o">.</span><span class="n">stBeamParams</span> <span class="o">:=</span> <span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">cstFullBeam</span><span class="p">;</span>
    <span class="n">stXCen</span><span class="o">.</span><span class="n">bUseRawCounts</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stXCen</span><span class="o">.</span><span class="n">bValid</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stXCen</span><span class="o">.</span><span class="n">stPMPS</span><span class="o">.</span><span class="n">sPmpsState</span> <span class="o">:=</span> <span class="n">CONCAT</span><span class="p">(</span><span class="n">sPmpsDeviceName</span><span class="p">,</span><span class="s1">&#39;-XCENTER&#39;</span><span class="p">);</span>

    <span class="n">FFO</span><span class="o">.</span><span class="n">i_DevName</span> <span class="o">:=</span> <span class="n">i_DevName</span><span class="p">;</span>

<span class="n">END_IF</span>


<span class="n">fbYStage</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stYStage</span><span class="p">);</span>
<span class="n">fbXStage</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stXStage</span><span class="p">);</span>

<span class="n">fbStates</span><span class="p">(</span>
    <span class="n">fbArbiter</span><span class="o">:=</span><span class="n">fbArbiter</span><span class="p">,</span>
    <span class="n">fbFFHWO</span><span class="o">:=</span><span class="n">fbFFHWO</span><span class="p">,</span>
    <span class="o">//</span><span class="n">nTransitionAssertionID</span><span class="o">:=</span><span class="n">nTransitionAssertionID</span><span class="p">,</span>
    <span class="o">//</span><span class="n">stTransitionBeam</span><span class="o">:=</span> <span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">cst0RateBeam</span><span class="p">,</span>
    <span class="n">bArbiterEnabled</span> <span class="o">:=</span> <span class="n">bArbiterEnabled</span><span class="p">,</span>
    <span class="n">tArbiterTimeout</span> <span class="o">:=</span><span class="n">tArbiterTimeout</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stYStage</span><span class="p">,</span>
    <span class="n">bEnable</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
    <span class="n">stAprt1</span><span class="o">:=</span><span class="n">stAprt1</span><span class="p">,</span>
    <span class="n">stAprt2</span><span class="o">:=</span><span class="n">stAprt2</span><span class="p">,</span>
    <span class="n">stAprt3</span><span class="o">:=</span><span class="n">stAprt3</span><span class="p">,</span>
    <span class="n">stAprt4</span><span class="o">:=</span><span class="n">stAprt4</span><span class="p">,</span>
    <span class="n">enumSet</span><span class="o">:=</span> <span class="n">enumSet</span><span class="p">,</span>
    <span class="n">sPmpsDeviceName</span><span class="o">:=</span><span class="n">sPmpsDeviceName</span><span class="p">,</span>
    <span class="n">sTransitionKey</span><span class="o">:=</span><span class="n">CONCAT</span><span class="p">(</span><span class="n">sTransitionKey</span><span class="p">,</span><span class="s1">&#39;_Y&#39;</span><span class="p">),</span>
    <span class="n">bBPOKAutoReset</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">);</span>

<span class="n">fbStates_X</span><span class="p">(</span>
    <span class="n">fbArbiter</span><span class="o">:=</span><span class="n">fbArbiter</span><span class="p">,</span>
    <span class="n">fbFFHWO</span><span class="o">:=</span><span class="n">fbFFHWO</span><span class="p">,</span>
    <span class="n">tArbiterTimeout</span> <span class="o">:=</span> <span class="n">tArbiterTimeout</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stXStage</span><span class="p">,</span>
    <span class="n">bEnable</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
    <span class="n">stXCen</span><span class="o">:=</span><span class="n">stXCen</span><span class="p">,</span>
    <span class="n">sPmpsDeviceName</span><span class="o">:=</span><span class="n">sPmpsDeviceName</span><span class="p">,</span>
    <span class="n">sTransitionKey</span><span class="o">:=</span><span class="n">CONCAT</span><span class="p">(</span><span class="n">sTransitionKey</span><span class="p">,</span><span class="s1">&#39;_X&#39;</span><span class="p">),</span>
    <span class="n">bBPOKAutoReset</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">);</span>


<span class="p">(</span><span class="o">*</span><span class="n">FAST</span> <span class="n">FAULT</span><span class="o">*</span><span class="p">)</span>
<span class="n">FFO</span><span class="p">(</span><span class="n">i_xOK</span> <span class="o">:=</span> <span class="n">bArbiterEnabled</span><span class="p">,</span>
    <span class="n">i_xReset</span> <span class="o">:=</span> <span class="p">,</span>
    <span class="n">i_xAutoReset</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
    <span class="n">io_fbFFHWO</span> <span class="o">:=</span> <span class="n">fbFFHWO</span><span class="p">);</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-maa-states">FB_MAA_States</a></p></li>
<li><p><a class="reference internal" href="#fb-maa-states-x">FB_MAA_States_X</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="fb-maa-states">
<h2>FB_MAA_States<a class="headerlink" href="#fb-maa-states" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_MAA_States</span> <span class="n">EXTENDS</span> <span class="n">FB_PositionStateBase_WithPMPS</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">enumSet</span><span class="p">:</span> <span class="n">E_MAA_states</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_INPUT</span>
    <span class="n">bStatesLock</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">stAprt1</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">stAprt2</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">stAprt3</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">stAprt4</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">GET</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">ZRST</span> <span class="n">Unknown</span><span class="p">;</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">ONST</span> <span class="mf">5.5</span><span class="n">mm</span><span class="p">;</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">TWST</span> <span class="mi">8</span><span class="n">mm</span><span class="p">;</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">THST</span> <span class="mi">10</span><span class="n">mm</span><span class="p">;</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">FRST</span> <span class="mi">13</span><span class="n">mm</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">enumGet</span><span class="p">:</span> <span class="n">E_MAA_States</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">bStatesInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fDelta1</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="o">//</span><span class="n">only</span> <span class="k">for</span> <span class="n">commissioning</span> <span class="n">should</span> <span class="n">change</span> <span class="n">to</span> <span class="n">more</span> <span class="n">conservative</span> <span class="n">values</span>
    <span class="n">fDelta2</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="n">fDelta3</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="n">fDelta4</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mi">3</span><span class="p">;</span>

<span class="n">END_VAR</span>
<span class="n">VAR</span> <span class="n">CONSTANT</span>
    <span class="n">fVelocity</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">fAccel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mi">200</span><span class="p">;</span>
    <span class="n">fDecel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mi">25</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">bStatesInit</span> <span class="n">THEN</span>
    <span class="n">bStatesInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">stAprt1</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;5.5mm&#39;</span><span class="p">;</span>
    <span class="n">stAprt1</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fVelocity</span><span class="p">;</span>
    <span class="n">stAprt1</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fDelta1</span><span class="p">;</span>
    <span class="n">stAprt1</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fAccel</span><span class="p">;</span>
    <span class="n">stAprt1</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fAccel</span><span class="p">;</span>
    <span class="n">stAprt1</span><span class="o">.</span><span class="n">bMoveOk</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="n">stAprt2</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;8mm&#39;</span><span class="p">;</span>
    <span class="n">stAprt2</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fVelocity</span><span class="p">;</span>
    <span class="n">stAprt2</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fDelta2</span><span class="p">;</span>
    <span class="n">stAprt2</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fAccel</span><span class="p">;</span>
    <span class="n">stAprt2</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fAccel</span><span class="p">;</span>
    <span class="n">stAprt2</span><span class="o">.</span><span class="n">bMoveOk</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="n">stAprt3</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;10mm&#39;</span><span class="p">;</span>
    <span class="n">stAprt3</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fVelocity</span><span class="p">;</span>
    <span class="n">stAprt3</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fDelta3</span><span class="p">;</span>
    <span class="n">stAprt3</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fAccel</span><span class="p">;</span>
    <span class="n">stAprt3</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fAccel</span><span class="p">;</span>
    <span class="n">stAprt3</span><span class="o">.</span><span class="n">bMoveOk</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="n">stAprt4</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;13mm&#39;</span><span class="p">;</span>
    <span class="n">stAprt4</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fVelocity</span><span class="p">;</span>
    <span class="n">stAprt4</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fDelta4</span><span class="p">;</span>
    <span class="n">stAprt4</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fAccel</span><span class="p">;</span>
    <span class="n">stAprt4</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fAccel</span><span class="p">;</span>
    <span class="n">stAprt4</span><span class="o">.</span><span class="n">bMoveOk</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>



    <span class="n">arrStates</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="n">stAprt1</span><span class="p">;</span>
    <span class="n">arrStates</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="n">stAprt2</span><span class="p">;</span>
    <span class="n">arrStates</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">:=</span> <span class="n">stAprt3</span><span class="p">;</span>
    <span class="n">arrStates</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">:=</span> <span class="n">stAprt4</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="n">setState</span> <span class="o">:=</span> <span class="n">enumSet</span><span class="p">;</span>
<span class="n">Exec</span><span class="p">();</span>
<span class="n">enumGet</span> <span class="o">:=</span> <span class="n">getState</span><span class="p">;</span>
<span class="n">enumSet</span> <span class="o">:=</span> <span class="n">setState</span><span class="p">;</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#e-maa-states">E_MAA_States</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="fb-maa-states-x">
<h2>FB_MAA_States_X<a class="headerlink" href="#fb-maa-states-x" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_MAA_States_X</span> <span class="n">EXTENDS</span> <span class="n">FB_PositionStateBase_WithPMPS</span>
<span class="n">VAR_INPUT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">SET</span><span class="p">;</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">ZRST</span> <span class="n">Unknown</span><span class="p">;</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">ONST</span> <span class="n">Centered</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">enumSet</span><span class="p">:</span> <span class="n">E_MAA_states_X</span><span class="p">;</span>
    <span class="n">bStatesLock</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">stXCen</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">GET</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">ZRST</span> <span class="n">Unknown</span><span class="p">;</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">ONST</span> <span class="n">Centered</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">enumGet</span><span class="p">:</span> <span class="n">E_MAA_states_X</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">bStatesInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fDelta</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.5</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span> <span class="n">CONSTANT</span>
    <span class="n">fVelocity</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>
    <span class="n">fAccel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mi">25</span><span class="p">;</span>
    <span class="n">fDecel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mi">25</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">bStatesInit</span> <span class="n">THEN</span>
    <span class="n">bStatesInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stXCen</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Centered&#39;</span><span class="p">;</span>
    <span class="n">stXCen</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fVelocity</span><span class="p">;</span>
    <span class="n">stXCen</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fDelta</span><span class="p">;</span>
    <span class="n">stXCen</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fAccel</span><span class="p">;</span>
    <span class="n">stXCen</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fAccel</span><span class="p">;</span>
    <span class="n">stXCen</span><span class="o">.</span><span class="n">bMoveOk</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="n">arrStates</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="n">stXCen</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="n">setState</span> <span class="o">:=</span> <span class="n">enumSet</span><span class="p">;</span>
<span class="n">Exec</span><span class="p">();</span>
<span class="n">enumGet</span> <span class="o">:=</span> <span class="n">getState</span><span class="p">;</span>
<span class="n">enumSet</span> <span class="o">:=</span> <span class="n">setState</span><span class="p">;</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</section>
<section id="fb-vcn-lin">
<h2>FB_VCN_Lin<a class="headerlink" href="#fb-vcn-lin" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">*</span> <span class="n">This</span> <span class="n">function</span> <span class="n">implements</span> <span class="n">the</span> <span class="n">Basic</span> <span class="n">functions</span> <span class="k">for</span> <span class="n">the</span> <span class="n">Pfeiffer</span> <span class="n">EVR</span> <span class="mi">116</span> <span class="n">needle</span> <span class="n">valve</span><span class="o">*</span><span class="p">)</span>
<span class="n">FUNCTION_BLOCK</span> <span class="n">FB_VCN_Lin</span> <span class="n">EXTENDS</span> <span class="n">FB_Valve</span>
<span class="n">VAR_INPUT</span>
    <span class="n">i_xExtIlkOK</span>     <span class="p">:</span>       <span class="n">BOOL</span><span class="p">;</span> <span class="o">//</span><span class="n">External</span> <span class="n">Interlock</span><span class="p">,</span> <span class="n">SET</span> <span class="n">to</span> <span class="n">TRUE</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">used</span>
    <span class="n">i_ReqPos</span>        <span class="p">:</span>       <span class="n">REAL</span><span class="p">;</span> <span class="o">//</span><span class="n">Requested</span> <span class="n">position</span>
    <span class="n">i_xPurge</span>        <span class="p">:</span> <span class="n">BOOL</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span><span class="o">//</span> <span class="n">When</span> <span class="n">purge</span> <span class="ow">is</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">maximum</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="n">ignored</span><span class="p">,</span> <span class="n">has</span> <span class="n">to</span> <span class="n">be</span> <span class="nb">set</span> <span class="n">evey</span> <span class="n">cycle</span><span class="o">.</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span>
    <span class="s1">&#39;}</span>
    <span class="n">iq_stVCN</span>        <span class="p">:</span>       <span class="n">ST_VCN</span><span class="p">;</span> <span class="o">//</span><span class="n">Needle</span> <span class="n">valve</span> <span class="n">structure</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span> <span class="n">CONSTANT</span>
    <span class="n">rOpenVoltage</span>    <span class="p">:</span>       <span class="n">REAL</span> <span class="o">:=</span> <span class="mf">9.1</span><span class="p">;</span> <span class="o">//</span> <span class="n">From</span> <span class="n">the</span> <span class="n">EVR</span> <span class="mi">116</span> <span class="n">manual</span><span class="p">,</span> <span class="n">A</span> <span class="n">Voltage</span> <span class="n">of</span> <span class="mi">9</span><span class="n">V</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">completely</span> <span class="n">Open</span>
    <span class="n">rCloseVoltage</span>   <span class="p">:</span>       <span class="n">REAL</span> <span class="o">:=</span> <span class="mf">0.4</span><span class="p">;</span><span class="o">//</span> <span class="n">a</span> <span class="n">voltage</span> <span class="o">&lt;</span><span class="mf">0.5</span> <span class="n">V</span> <span class="n">the</span> <span class="n">valve</span> <span class="ow">is</span> <span class="n">closed</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="o">//</span> <span class="n">Requested</span> <span class="n">voltage</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">POS_AO</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span> <span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqVoltage</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="o">//</span><span class="n">iResolution</span><span class="p">:</span> <span class="n">INT</span> <span class="o">:=</span><span class="mi">16</span><span class="p">;</span>
    <span class="o">//</span>
    <span class="p">(</span><span class="o">*</span><span class="n">IO</span><span class="o">*</span><span class="p">)</span>
    <span class="n">q_iRawPosition</span> <span class="n">AT</span><span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span><span class="n">INT</span><span class="p">;</span>

    <span class="o">//</span><span class="n">CONTROL</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS</span>         <span class="p">:</span> <span class="n">ST_CTRL_LIN_INTERPOLATION_PARAMS</span><span class="p">;</span>
    <span class="n">fbCTRL_LIN_INTERPOLATION</span>                                        <span class="p">:</span> <span class="n">FB_CTRL_LIN_INTERPOLATION</span><span class="p">;</span>
    <span class="n">arrTable</span> <span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1..10</span><span class="p">,</span><span class="mf">1..2</span><span class="p">]</span> <span class="n">OF</span> <span class="n">FLOAT</span><span class="p">;</span>
    <span class="n">arrTable_RBV</span> <span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1..10</span><span class="p">,</span><span class="mf">1..2</span><span class="p">]</span> <span class="n">OF</span> <span class="n">FLOAT</span><span class="p">;</span>
    <span class="o">//</span><span class="n">Readdback</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS_RBV</span>     <span class="p">:</span> <span class="n">ST_CTRL_LIN_INTERPOLATION_PARAMS</span><span class="p">;</span>
    <span class="n">fbCTRL_LIN_INTERPOLATION_RBV</span>                                    <span class="p">:</span> <span class="n">FB_CTRL_LIN_INTERPOLATION</span><span class="p">;</span>
    <span class="n">eMode</span>           <span class="p">:</span> <span class="n">E_CTRL_MODE</span><span class="p">;</span>
    <span class="n">iCounter</span><span class="p">:</span><span class="n">INT</span><span class="p">;</span>
    <span class="n">bInit</span> <span class="p">:</span><span class="n">BOOL</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span> <span class="n">PERSISTENT</span>
    <span class="n">rUpperLimit</span>     <span class="p">:</span>       <span class="n">REAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span> <span class="n">Needle</span> <span class="n">valve</span> <span class="n">control</span> <span class="n">FB</span>
<span class="n">A</span><span class="o">.</span> <span class="n">Wallace</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">7</span><span class="o">-</span><span class="mi">21</span>

<span class="n">This</span> <span class="n">FB</span> <span class="n">should</span> <span class="n">be</span> <span class="n">used</span> <span class="k">as</span> <span class="n">a</span> <span class="n">low</span> <span class="n">level</span> <span class="n">control</span> <span class="n">block</span><span class="o">.</span>

<span class="n">It</span> <span class="n">provides</span><span class="p">:</span>

<span class="n">Valve</span> <span class="n">position</span> <span class="n">ceiling</span>
<span class="n">Interlock</span>
<span class="n">Scaling</span>

<span class="n">It</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">intended</span> <span class="k">for</span><span class="p">:</span>
<span class="n">Closed</span><span class="o">-</span><span class="n">loop</span> <span class="n">control</span>

<span class="n">It</span> <span class="n">could</span> <span class="n">be</span> <span class="n">used</span> <span class="k">for</span><span class="p">:</span>
<span class="n">Valve</span> <span class="n">position</span><span class="o">/</span><span class="n">flow</span> <span class="n">linearization</span>

<span class="n">Note</span><span class="p">:</span> <span class="n">Raw</span> <span class="n">position</span> <span class="n">calc</span> <span class="ow">is</span> <span class="n">based</span> <span class="n">on</span> <span class="mf">0.5</span> <span class="n">to</span> <span class="mi">9</span><span class="n">V</span> <span class="n">span</span><span class="p">,</span> <span class="mi">32767</span> <span class="n">bits</span>
<span class="o">*</span><span class="p">)</span>


<span class="n">iq_stVCN</span><span class="o">.</span><span class="n">rUpperLimit</span> <span class="o">:=</span>  <span class="n">LIMIT</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">rUpperLimit</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

<span class="o">//</span> <span class="n">Interlocking</span>
<span class="n">iq_stVCN</span><span class="o">.</span><span class="n">xIlkOK</span> <span class="o">:=</span> <span class="n">i_xExtIlkOK</span><span class="p">;</span>
<span class="p">(</span><span class="o">*</span><span class="n">Checking</span> <span class="n">which</span> <span class="n">Control</span> <span class="n">mode</span> <span class="ow">is</span> <span class="n">selected</span><span class="o">*</span><span class="p">)</span>
<span class="n">IF</span> <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">xIlkOK</span> <span class="n">THEN</span>
    <span class="n">IF</span> <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">eValveControl</span> <span class="o">=</span> <span class="n">OpenValve</span> <span class="n">THEN</span>
        <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">rReqPosition</span> <span class="o">:=</span> <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">rUpperLimit</span><span class="p">;(</span><span class="o">*</span><span class="n">Percentage</span><span class="o">*</span><span class="p">)</span>
    <span class="n">ELSIF</span> <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">eValveControl</span> <span class="o">=</span> <span class="n">CloseValve</span> <span class="n">THEN</span>
        <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">rReqPosition</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="o">*</span><span class="n">Percentage</span><span class="o">*</span><span class="p">)</span>
    <span class="n">ELSIF</span> <span class="p">(</span><span class="n">iq_stVCN</span><span class="o">.</span><span class="n">eValveControl</span> <span class="o">=</span> <span class="n">ManualControl</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">AND</span> <span class="p">(</span><span class="n">iq_stVCN</span><span class="o">.</span><span class="n">xOPN_SW</span><span class="p">)</span><span class="o">*</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">rReqPosition</span> <span class="o">:=</span> <span class="n">LIMIT</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">rReqPosition</span><span class="p">,</span> <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">rUpperLimit</span><span class="p">);</span>
    <span class="n">ELSIF</span> <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">eValveControl</span> <span class="o">=</span> <span class="n">PressureControl</span> <span class="n">THEN</span>
        <span class="n">IF</span> <span class="p">(</span><span class="n">i_xPurge</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">rReqPosition</span> <span class="o">:=</span> <span class="n">LIMIT</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i_ReqPos</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
        <span class="n">ELSE</span> <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">rReqPosition</span> <span class="o">:=</span> <span class="n">LIMIT</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i_ReqPos</span><span class="p">,</span> <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">rUpperLimit</span><span class="p">);</span>
        <span class="n">END_IF</span>
    <span class="n">END_IF</span>
<span class="n">ELSE</span>
    <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">rReqPosition</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">eValveControl</span> <span class="o">:=</span> <span class="n">CloseValve</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="o">//</span><span class="n">Raw</span> <span class="n">position</span> <span class="n">calc</span>
<span class="n">iq_stvcn</span><span class="o">.</span><span class="n">q_iRawPosition</span> <span class="o">:=</span> <span class="n">REAL_TO_INT</span><span class="p">(</span> <span class="mi">32767</span><span class="o">/</span><span class="mi">10</span> <span class="o">*</span> <span class="n">rReqVoltage</span><span class="p">);</span>

<span class="p">(</span><span class="o">*</span><span class="n">SOft</span> <span class="n">IO</span> <span class="n">Mapping</span><span class="o">*</span><span class="p">)</span>
<span class="n">ACT_IO</span><span class="p">();</span>

<span class="p">(</span><span class="o">*</span><span class="n">Load</span> <span class="ow">or</span> <span class="n">save</span> <span class="n">the</span> <span class="n">persistent</span> <span class="n">variables</span><span class="o">*</span><span class="p">)</span>
<span class="n">ACT_Persistent</span><span class="p">();</span>

<span class="n">ACT_INIT</span><span class="p">();</span>

<span class="n">END_FUNCTION_BLOCK</span>

<span class="n">ACTION</span> <span class="n">ACT_INIT</span><span class="p">:</span>
<span class="p">{</span><span class="n">attribute</span> <span class="n">no_check</span><span class="p">}</span>
<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>


    <span class="p">(</span><span class="o">*</span> <span class="n">init</span> <span class="n">array</span> <span class="k">with</span> <span class="n">the</span> <span class="n">interpolation</span> <span class="n">points</span>  <span class="o">*</span><span class="p">)</span>
    <span class="p">(</span><span class="o">*</span>      <span class="n">fIn</span>                                      <span class="o">|</span>              <span class="n">fOut</span>            <span class="o">*</span><span class="p">)</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>                     <span class="n">arrTable</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">15</span><span class="p">;</span>            <span class="n">arrTable</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">1.4</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">19</span><span class="p">;</span>            <span class="n">arrTable</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">1.75</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span>  <span class="mi">25</span><span class="p">;</span>       <span class="n">arrTable</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">2.25</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span>  <span class="mi">31</span><span class="p">;</span>       <span class="n">arrTable</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">2.8</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">39</span><span class="p">;</span>            <span class="n">arrTable</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">3.55</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">49</span><span class="p">;</span>            <span class="n">arrTable</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">4.45</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">62</span><span class="p">;</span>        <span class="n">arrTable</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">5.65</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">78</span><span class="p">;</span>        <span class="n">arrTable</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">7.1</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">100</span><span class="p">;</span>          <span class="n">arrTable</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">9.1</span><span class="p">;</span>


    <span class="p">(</span><span class="o">*</span> <span class="n">init</span> <span class="n">parameter</span> <span class="n">struct</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS</span><span class="o">.</span><span class="n">tCtrlCycleTime</span>                                  <span class="o">:=</span> <span class="n">T</span><span class="c1">#10ms;</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS</span><span class="o">.</span><span class="n">tTaskCycleTime</span>                                  <span class="o">:=</span> <span class="n">T</span><span class="c1">#10ms;</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS</span><span class="o">.</span><span class="n">nDataTable_NumberOfRows</span>         <span class="o">:=</span> <span class="n">INT_TO_UINT</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

    <span class="p">(</span><span class="o">*</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">addresses</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS</span><span class="o">.</span><span class="n">pDataTable_ADR</span>                  <span class="o">:=</span> <span class="n">ADR</span><span class="p">(</span><span class="n">arrTable</span><span class="p">);</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS</span><span class="o">.</span><span class="n">nDataTable_SIZEOF</span>               <span class="o">:=</span> <span class="n">SIZEOF</span><span class="p">(</span><span class="n">arrTable</span><span class="p">);</span>

    <span class="p">(</span><span class="o">*</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">mode</span> <span class="n">to</span> <span class="n">ACTIVE</span> <span class="o">--&gt;</span> <span class="n">normal</span> <span class="n">operation</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">eMode</span>                                                   <span class="o">:=</span> <span class="n">eCTRL_MODE_ACTIVE</span><span class="p">;</span>


    <span class="p">(</span><span class="o">*</span> <span class="n">init</span> <span class="n">array</span> <span class="k">with</span> <span class="n">the</span> <span class="n">interpolation</span> <span class="n">points</span>  <span class="o">*</span><span class="p">)</span>
    <span class="p">(</span><span class="o">*</span>      <span class="n">fIn</span>                                      <span class="o">|</span>              <span class="n">fOut</span>            <span class="o">*</span><span class="p">)</span>
     <span class="n">FOR</span> <span class="n">iCounter</span><span class="o">:=</span><span class="mi">1</span> <span class="n">TO</span> <span class="mi">10</span> <span class="n">BY</span> <span class="mi">1</span> <span class="n">DO</span>
        <span class="n">arrTable_RBV</span><span class="p">[</span><span class="n">iCounter</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="n">arrTable</span><span class="p">[</span><span class="n">iCounter</span><span class="p">,</span><span class="mi">2</span><span class="p">];</span>
        <span class="n">arrTable_RBV</span><span class="p">[</span><span class="n">iCounter</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="n">arrTable</span><span class="p">[</span><span class="n">iCounter</span><span class="p">,</span><span class="mi">1</span><span class="p">];</span>
     <span class="n">END_FOR</span><span class="p">;</span>


    <span class="p">(</span><span class="o">*</span> <span class="n">init</span> <span class="n">parameter</span> <span class="n">struct</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS_RBV</span><span class="o">.</span><span class="n">tCtrlCycleTime</span>                                      <span class="o">:=</span> <span class="n">T</span><span class="c1">#10ms;</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS_RBV</span><span class="o">.</span><span class="n">tTaskCycleTime</span>                                      <span class="o">:=</span> <span class="n">T</span><span class="c1">#10ms;</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS_RBV</span><span class="o">.</span><span class="n">nDataTable_NumberOfRows</span>             <span class="o">:=</span> <span class="n">INT_TO_UINT</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

    <span class="p">(</span><span class="o">*</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">addresses</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS_RBV</span><span class="o">.</span><span class="n">pDataTable_ADR</span>                      <span class="o">:=</span> <span class="n">ADR</span><span class="p">(</span><span class="n">arrTable_RBV</span><span class="p">);</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS_RBV</span><span class="o">.</span><span class="n">nDataTable_SIZEOF</span>           <span class="o">:=</span> <span class="n">SIZEOF</span><span class="p">(</span><span class="n">arrTable_RBV</span><span class="p">);</span>

    <span class="p">(</span><span class="o">*</span> <span class="n">reset</span> <span class="n">the</span> <span class="n">init</span> <span class="n">flag</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">bInit</span>                                                   <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">END_IF</span><span class="p">;</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_IO</span><span class="p">:</span>
<span class="p">(</span><span class="o">*</span><span class="n">outputs</span><span class="o">*</span><span class="p">)</span>
<span class="n">q_iRawPosition</span> <span class="o">:=</span> <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">q_iRawPosition</span><span class="p">;</span>
<span class="p">(</span><span class="o">*</span><span class="n">inputs</span><span class="o">*</span><span class="p">)</span>
<span class="n">iq_stVCN</span><span class="o">.</span><span class="n">i_iPosition</span> <span class="o">:=</span> <span class="n">iq_stvcn</span><span class="o">.</span><span class="n">q_iRawPosition</span><span class="p">;</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_LIN_INTERPOLATION</span><span class="p">:</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;no_check&#39;</span><span class="p">}</span>
<span class="n">fbCTRL_LIN_INTERPOLATION</span><span class="p">(</span>
    <span class="n">fIn</span><span class="o">:=</span>  <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">rReqPosition</span> <span class="p">,</span>
    <span class="n">fManValue</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">bExtrapolate</span><span class="o">:=</span> <span class="p">,</span>
    <span class="n">eMode</span><span class="o">:=</span> <span class="n">eMode</span><span class="p">,</span>
    <span class="n">fOut</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">bInIsGreaterThanMaxElement</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">bInIsLessThanMinElement</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">eState</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">eErrorId</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">bError</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">stParams</span><span class="o">:=</span> <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS</span> <span class="p">);</span>

<span class="o">//</span> <span class="n">Requested</span> <span class="n">Voltage</span> <span class="n">calculation</span>
<span class="o">//</span><span class="n">rReqVoltage</span> <span class="o">:=</span> <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">rReqPosition</span> <span class="o">*</span> <span class="p">(</span><span class="n">rOpenVoltage</span><span class="o">-</span><span class="n">rCloseVoltage</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span> <span class="o">+</span> <span class="n">rCloseVoltage</span><span class="p">;</span>
<span class="n">rReqVoltage</span> <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">(</span><span class="n">LIMIT</span><span class="p">(</span><span class="n">rCloseVoltage</span><span class="p">,</span> <span class="n">fbCTRL_LIN_INTERPOLATION</span><span class="o">.</span><span class="n">fOut</span><span class="p">,</span> <span class="n">rOpenVoltage</span><span class="p">));</span> <span class="o">//</span><span class="n">The</span> <span class="n">requested</span> <span class="n">voltage</span> <span class="n">should</span> <span class="n">remain</span> <span class="n">within</span> <span class="n">this</span> <span class="nb">range</span>

<span class="n">fbCTRL_LIN_INTERPOLATION_RBV</span><span class="p">(</span>
    <span class="n">fIn</span><span class="o">:=</span> <span class="n">rReqVoltage</span> <span class="p">,</span>
    <span class="n">fManValue</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">bExtrapolate</span><span class="o">:=</span> <span class="p">,</span>
    <span class="n">eMode</span><span class="o">:=</span> <span class="n">eMode</span><span class="p">,</span>
    <span class="n">fOut</span><span class="o">=&gt;</span>  <span class="p">,</span>
    <span class="n">bInIsGreaterThanMaxElement</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">bInIsLessThanMinElement</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">eState</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">eErrorId</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">bError</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">stParams</span><span class="o">:=</span> <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS_RBV</span> <span class="p">);</span>
<span class="o">//</span> <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">rReqPosition</span> <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">(</span><span class="n">fbCTRL_LIN_INTERPOLATION_RBV</span><span class="o">.</span><span class="n">fOut</span><span class="p">);</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Logger</span><span class="p">:</span>
<span class="o">//</span> <span class="n">ILK</span> <span class="n">logger</span>

<span class="n">IF</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">iq_stVCN</span><span class="o">.</span><span class="n">xIlkOK</span> <span class="p">)</span> <span class="n">AND</span> <span class="n">NOT</span><span class="p">(</span><span class="n">ePrevState</span> <span class="o">=</span> <span class="n">CloseValve</span><span class="p">)</span> <span class="n">THEN</span>
         <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Lost interlock ok bit while valve was open.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Critical</span><span class="p">);</span>
<span class="n">END_IF</span>


<span class="o">//</span><span class="n">Control</span> <span class="n">STATE</span> <span class="n">Logger</span>
<span class="n">IF</span> <span class="n">ePrevState</span> <span class="o">&lt;&gt;</span> <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">eValveControl</span> <span class="n">THEN</span>
      <span class="n">CASE</span> <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">eValveControl</span> <span class="n">OF</span>
        <span class="n">ManualControl</span><span class="p">:</span>
            <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Valve in manual control mode&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Warning</span><span class="p">);</span>
        <span class="n">OpenValve</span><span class="p">:</span>
            <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Valve Open.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Info</span><span class="p">);</span>
        <span class="n">PressureControl</span><span class="p">:</span>
            <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Valve in pressure control mode.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Info</span><span class="p">);</span>
        <span class="n">CloseValve</span><span class="p">:</span>
            <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Valve closed.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Info</span><span class="p">);</span>
      <span class="n">END_CASE</span>
      <span class="n">ePrevState</span> <span class="o">:=</span> <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">eValveControl</span><span class="p">;</span>
  <span class="n">END_IF</span>


<span class="o">//</span> <span class="n">Log</span> <span class="n">valve</span> <span class="nb">open</span>
<span class="n">tAction</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span> <span class="p">(</span><span class="n">iq_stVCN</span><span class="o">.</span><span class="n">eValveControl</span> <span class="o">=</span> <span class="n">OpenValve</span><span class="p">)</span> <span class="p">);</span>
<span class="n">IF</span> <span class="n">tAction</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span> <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Valve commanded to fully open&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Info</span><span class="p">);</span> <span class="n">END_IF</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Persistent</span><span class="p">:</span>
<span class="p">(</span><span class="o">*</span><span class="n">On</span> <span class="n">first</span> <span class="n">PLC</span> <span class="k">pass</span><span class="p">,</span> <span class="n">load</span> <span class="n">the</span> <span class="n">persistent</span> <span class="n">value</span> <span class="n">into</span> <span class="n">the</span> <span class="n">structrue</span> <span class="n">variable</span><span class="o">*</span><span class="p">)</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">bRestorePersistentData</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">bRestorePersistentData</span>  <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">rUpperLimit</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">rUpperLimit</span> <span class="o">:=</span> <span class="n">rUpperLimit</span><span class="p">;</span>
    <span class="n">END_IF</span><span class="p">;</span>

<span class="n">END_IF</span>
<span class="p">(</span><span class="o">*</span><span class="n">Check</span> <span class="k">if</span> <span class="n">a</span> <span class="n">new</span> <span class="n">value</span> <span class="n">has</span> <span class="n">been</span> <span class="n">written</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">structure</span> <span class="n">variable</span> <span class="n">copy</span> <span class="n">it</span> <span class="n">to</span> <span class="n">the</span> <span class="n">persistent</span> <span class="n">variable</span><span class="o">*</span><span class="p">)</span>
<span class="n">IF</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">iq_stVCN</span><span class="o">.</span><span class="n">rUpperLimit</span> <span class="o">=</span> <span class="n">rUpperLimit</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">rUpperLimit</span> <span class="o">:=</span> <span class="n">iq_stVCN</span><span class="o">.</span><span class="n">rUpperLimit</span><span class="p">;</span>
    <span class="o">//</span><span class="n">fbWritePersistentData</span><span class="p">(</span><span class="n">NETID</span><span class="o">:=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">PORT</span><span class="o">:=</span><span class="mi">851</span><span class="p">,</span> <span class="n">START</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">TMOUT</span><span class="o">:=</span><span class="n">T</span><span class="c1">#1s );</span>
<span class="n">ELSE</span>
     <span class="o">//</span> <span class="n">fbWritePersistentData</span><span class="p">(</span> <span class="n">START</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
<span class="n">END_IF</span><span class="p">;</span>
<span class="n">END_ACTION</span>

<span class="n">METHOD</span> <span class="n">M_SetThrottle</span> <span class="p">:</span> <span class="n">BOOL</span>
<span class="n">VAR_INPUT</span>
    <span class="n">rUpperLimit</span>     <span class="p">:</span>       <span class="n">REAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">iq_stVCN</span><span class="o">.</span><span class="n">rUpperLimit</span> <span class="o">:=</span> <span class="n">LIMIT</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rUpperLimit</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">M_ValveControl</span> <span class="p">:</span> <span class="n">BOOL</span>
<span class="n">VAR_INPUT</span>
    <span class="n">state</span><span class="p">:</span><span class="n">E_VCN</span><span class="p">;</span> <span class="o">//</span> <span class="n">Close</span><span class="p">,</span> <span class="n">Open</span><span class="p">,</span> <span class="n">Pressure</span><span class="p">,</span> <span class="n">Manual</span>
<span class="n">END_VAR</span>
<span class="n">iq_stVCN</span><span class="o">.</span><span class="n">eValveControl</span> <span class="o">:=</span> <span class="n">state</span><span class="p">;</span>
<span class="n">END_METHOD</span>
</pre></div>
</div>
</section>
<section id="fb-vgp">
<h2>FB_VGP<a class="headerlink" href="#fb-vgp" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(* This function implements the Basic functions for the Vat Motorized valve*)
{attribute &#39;no_check&#39;}
FUNCTION_BLOCK FB_VGP
VAR_INPUT
    i_xExtIlkOK     :       BOOL; //External Interlock, SET to TRUE if not used
    i_xOpenIlkOK: BOOL; //Interlock Bit that allows the valve to open
    i_xCloseIlkOK: BOOL; //Interlock Bit that allows the valve to Close

    i_ReqPos        :       REAL; //Requested position

    arrTable        : ARRAY[1..14,1..2] OF FLOAT;
END_VAR
VAR_OUTPUT
    {attribute &#39;pytmc&#39; := &#39;
    pv:
    &#39;}
    q_stVGP :       ST_VGP; // valve structure
END_VAR
VAR_IN_OUT

END_VAR

VAR CONSTANT
    rUpperLimit     :       REAL:=100;      //Percentage Upper limit on valve open
    rClosePosition : REAL:=0; // Encoder Min. Fully Closed
    rMaxDiffPressure: REAL:= 22.5; //Torr
END_VAR

VAR
    rOpenPosition: REAL:=1680; // Encoder MAX. Fully Open
    rTargetPosition : REAL;
    rTargetVelocity: REAL:=30;
    rHomingVelocity: REAL:=10;
    rHomingDistance: REAL:=-20;//every 150 is 10% , 1%  is 14.975
    rOldTargetPosition: REAL;
    rHyst:REAL :=10;
    //
    /// axis reference data structure
    Axis: AXIS_REF;
    //
    InfoData_State AT %I*: UINT ;

    // Axis MC functions

    fbPowerAxis: MC_Power;
    /// debug function block output data
    PowerAxisOut: ST_McOutputs;
    fbMoveAxisABS: MC_MoveAbsolute;
    /// debug function block output data
    MoveAbsoluteOut: ST_McOutputs;
    fbMoveAxisABS2: MC_MoveAbsolute;
    /// debug function block output data
    MoveAbsoluteOut2: ST_McOutputs;

    fbReset: MC_Reset;
    /// debug function block output data
    ResetOut: ST_McOutputs;
    MoveAxisREL: MC_MoveAbsolute;
    MoveRelativeOut: ST_McOutputs;



    rOverride: LREAL := 100;
    fbHalt: MC_Halt;


    // Homing Functions
    bGo:BOOL := FALSE; //to execute motion
    bHome:BOOL :=FALSE; // should be set to true
    bEnable:Bool; //to be removed
    fbMoveRel: MC_MoveRelative;
    fbSetPosition: MC_SetPosition;
    fbWriteParameter: MC_WriteBoolParameter;
    HomeState: E_HomeState;

    // For Monitoring while Axis moving
    rPrevEncoderPosition : REAL;
    // interpolation
    bInit : BOOL := TRUE;
    eMode           : E_CTRL_MODE;
    iCounter:INT;
    //CONTROL
    stCTRL_LIN_INTERPOLATION_PARAMS         : ST_CTRL_LIN_INTERPOLATION_PARAMS;
    fbCTRL_LIN_INTERPOLATION                                        : FB_CTRL_LIN_INTERPOLATION;
    arrTable_ENC : ARRAY[1..14,1..2] OF FLOAT;
    //Readdback
    stCTRL_LIN_INTERPOLATION_PARAMS_ENC             : ST_CTRL_LIN_INTERPOLATION_PARAMS;
    fbCTRL_LIN_INTERPOLATION_ENC                                    : FB_CTRL_LIN_INTERPOLATION;

    // Logger
     // For logging
    fbLogger : FB_LogMessage := (eSubsystem:=E_SubSystem.VACUUM);
    ePrevState : E_VCN;
    tErrorPresent : R_TRIG;
    tAction : R_TRIG; // Primary action of this device (OPN_DO, PUMP_RUN, etc.)

    rt_close :R_TRIG;
    rt_Open :R_TRIG;
END_VAR
/// Interpolation  function initialization
ACT_INIT();

// Interlocking
q_stVGP.xIlkOK := i_xExtIlkOK;
(*Checking which Control mode is selected*)
IF i_xExtIlkOK AND NOT (q_stVGP.pv_xError) THEN
    IF q_stVGP.eValveControl = OpenValve THEN
        q_stVGP.rReqPosition := rUpperLimit;
    ELSIF q_stVGP.eValveControl = CloseValve THEN
        q_stVGP.rReqPosition := 0;
    ELSIF q_stVGP.eValveControl = ManualControl THEN
        q_stVGP.rReqPosition := LIMIT(0, q_stVGP.rReqPosition, rUpperLimit);
    ELSIF q_stVGP.eValveControl = PressureControl THEN
         q_stVGP.rReqPosition := LIMIT(0, i_ReqPos, rUpperLimit);
    END_IF
ELSIF NOT i_xExtIlkOK THEN
    q_stVGP.rReqPosition := 0;
    q_stVGP.eValveControl := CloseValve;//CloseValve;
END_IF

rt_close (CLK:= q_stVGP.eValveControl = CloseValve);
rt_Open (CLK:= q_stVGP.eValveControl = OpenValve);

IF (rt_close.Q) OR (rt_Open.Q) THEN
    q_stVGP.pv_xGo_SW:=TRUE;
END_IF
//Check the Drive State

IF (*(InfoData_State&lt;&gt;16#8) OR*) (q_stVGP.eState = ERROR) THEN
    q_stVGP.pv_xError:=TRUE;
ELSE
    q_stVGP.pv_xError:=FALSE;
    // Call function to execute move
    // call motion function blocks???
END_IF


IF (q_stVGP.pv_xABORT_SW ) THEN
    q_stVGP.pv_xABORT_SW := FALSE;
    q_stVGP.eState:= ABORT;
    HomeState:= H_READY;
END_IF


ACT_LIN_INTERPOLATION();
ACT_AXIS();
ACT_HOME();
ACT_MONITOR();

END_FUNCTION_BLOCK

ACTION ACT_AXIS:
//update the axis status
AXIS();
q_stVGP.rEnoder_Position := LREAL_TO_REAL(Axis.NcToPlc.ActPos); // encoder position


(*IF NOT (i_xExtIlkOK) THEN
    q_stVGP.eState := NEWTARGETPOSITION;
END_IF*)
//Homing STATE is missing

// state machine for axis motion
    (* move axis using a state machine *)
    CASE q_stVGP.eState OF

        INIT :      (* initialisation *)
            (* initialize all function blocks *)
            fbMoveAxisABS.Execute := FALSE;
            fbMoveAxisABS2.Execute := FALSE;
            fbReset.Execute := FALSE;
            fbHALT.Execute :=FALSE;//
            q_stVGP.eState := ENABLE; // Check homing first
            HomeState:= H_READY;

        ENABLE :
            fbPowerAxis.Enable :=  TRUE;
            fbPowerAxis.Enable_Positive := TRUE;
            fbPowerAxis.Enable_Negative := TRUE;
            IF fbPowerAxis.Status THEN
                q_stVGP.eState := READY;
            ELSIF fbPowerAxis.Error THEN
                q_stVGP.eState := ERROR;
            END_IF

        READY: // waiting for move command
            IF NOT fbPowerAxis.Status THEN
                q_stVGP.eState := ENABLE;
            ELSIF fbPowerAxis.Error THEN
                q_stVGP.eState := ERROR;
            END_IF
            IF (HomeState = H_READY) AND (q_stVGP.pv_xHome_SW) THEN
                    HomeState:= H_INIT;
                    q_stVGP.pv_xHome_SW:=false;
                    q_stVGP.eState := HOME;
                    ELSE
                    q_stVGP.eState := READY;
                END_IF
            IF (q_stVGP.pv_xGo_SW) AND q_stVGP.pv_xHomed(* AND( rOldTargetPosition &lt;&gt; rTargetPosition) *) THEN
                q_stVGP.pv_xGo_SW := false;
                q_stVGP.eState := NEWTARGETPOSITION;
                rOldTargetPosition:= rTargetPosition;
            END_IF


        HOME:
                if (HomeState = H_DONE) THEN
                     q_stVGP.eState := INIT;
                     q_stVGP.pv_xHomed := TRUE;
                     HomeState := H_READY;
                END_IF

                if (HomeState = H_ERROR) THEN
                    q_stVGP.eState := ERROR;
                      q_stVGP.pv_xHomed := FALSE;
                END_IF

        NEWTARGETPOSITION:
            fbMoveAxisABS.Position := rTargetPosition;
            fbMoveAxisABS.Velocity := rTargetVelocity;
            //fbMoveAxisABS.BufferMode := MC_BlendingNext;
            fbMoveAxisABS.Execute := TRUE;
            IF fbMoveAxisABS.Active  THEN
                (* axis is executing job but is not yet finished *)
                fbMoveAxisABS.Execute := FALSE;
                (* leave this state and buffer a second command *)
                q_stVGP.eState := MOVING;
            ElSIF fbMoveAxisABS.Done THEN
                fbMoveAxisABS.Execute := FALSE;
                q_stVGP.eState := READY;
            ELSIF fbMoveAxisABS.CommandAborted OR fbMoveAxisABS.Error THEN
                q_stVGP.eState := ERROR;
            END_IF


        MOVING://
            IF fbMoveAxisABS.CommandAborted OR fbMoveAxisABS.Error THEN
                q_stVGP.eState := ERROR;
            END_IF
            IF NOT ( Axis.Status.Moving) OR (fbMoveAxisABS.Done) THEN //(fbMoveAxisABS.Done) AND (fbMoveAxisABS2.Done) THEN
                q_stVGP.eState := READY;
            END_IF


        HALT:
            fbHALT.Execute :=TRUE;
            IF Axis.Status.Error THEN
                q_stVGP.eState := RESET;    (* axis error requires reset *)
            ELSE
                q_stVGP.eState := INIT;             (* function block errors don&#39;t need a reset *)
            END_IF

        ERROR :
            IF HomeState = H_READY THEN
                q_stVGP.eState := RESET;
            ELSE
                q_stVGP.eState := HOME;
            END_IF

        RESET :
            //fbReset.Execute := TRUE;
            IF fbReset.Done THEN q_stVGP.eState :=INIT;
            //      HomeState := H_READY;
            ELSIF fbReset.Error THEN
                q_stVGP.eState := ERROR; (* keep trying to reset*)
            END_IF

        ABORT:
            fbMoveAxisABS.Execute := FALSE;
            fbMoveAxisABS2.Execute := FALSE;
            fbReset.Execute := FALSE;
            (* save target position*)
            rOldTargetPosition :=   q_stVGP.i_iPosition;
            fbHALT.Execute :=FALSE;
            fbPowerAxis.Enable := FALSE;
            fbPowerAxis.Enable_Positive := FALSE;
            fbPowerAxis.Enable_Negative := FALSE;
            q_stVGP.eState := ENABLE; // Check homing first

    END_CASE






/// Motion Function Blocks
(* AXIS POWER*)
fbPowerAxis(
    Axis:= Axis,
    Enable:= ,
    Enable_Positive:= i_xOpenIlkOK,
    Enable_Negative:= ,
    Override:= rOverride,
    BufferMode:= ,
    Options:= ,
    Status=&gt;  ,
    Busy=&gt; PowerAxisOut.Busy ,
    Active=&gt; PowerAxisOut.Active ,
    Error=&gt; PowerAxisOut.Error,
    ErrorID=&gt; PowerAxisOut.ErrorID);
(* AXIS MOVE ABSOLUTE*)
fbMoveAxisABS(
    Axis:= Axis ,
    Execute:= ,
    Position:= ,
    Velocity:= ,
    Acceleration:= ,
    Deceleration:= ,
    Jerk:= ,
    BufferMode:= MC_BlendingNext ,
    Options:= ,
    Done=&gt;MoveAbsoluteOut.Done,
    Busy=&gt; MoveAbsoluteOut.Busy,
    Active=&gt; MoveAbsoluteOut.Active,
    CommandAborted=&gt; MoveAbsoluteOut.CommandAborted ,
    Error=&gt; MoveAbsoluteOut.Error,
    ErrorID=&gt; MoveAbsoluteOut.ErrorID);
    (* AXIS MOVE ABSOLUTE*)
fbMoveAxisABS2(
    Axis:= Axis ,
    Execute:= ,
    Position:= ,
    Velocity:= ,
    Acceleration:= ,
    Deceleration:= ,
    Jerk:= ,
    BufferMode:= MC_BlendingNext ,
    Options:= ,
    Done=&gt;MoveAbsoluteOut2.Done,
    Busy=&gt; MoveAbsoluteOut2.Busy,
    Active=&gt; MoveAbsoluteOut2.Active,
    CommandAborted=&gt; MoveAbsoluteOut2.CommandAborted ,
    Error=&gt; MoveAbsoluteOut2.Error,
    ErrorID=&gt; MoveAbsoluteOut2.ErrorID);
(*AXIS RESET*)
fbReset(
    Axis:= Axis,
    Execute:= This^.q_stVGP.pv_xReset_SW ,
    Done=&gt;ResetOut.Done ,
    Busy=&gt;ResetOut.Busy ,
    Error=&gt; ResetOut.Error,
    ErrorID=&gt; ResetOut.ErrorID);

(*HALT*)
fbHalt(
    Axis:= Axis,
    Execute:= ,
    Deceleration:= ,
    Jerk:= ,
    BufferMode:= MC_BlendingNext ,
    Options:= ,
    Done=&gt; ,
    Busy=&gt; ,
    Active=&gt; ,
    CommandAborted=&gt; ,
    Error=&gt; ,
    ErrorID=&gt; );


/// ERROR
IF Axis.Status.Error  THEN
    q_stVGP.eState := ERROR;
END_IF;

// Error Handling
if( fbPowerAxis.Error and fbPowerAxis.Active ) then
    This^.q_stVGP.pv_xError:= fbPowerAxis.Error;
    This^.q_stVGP.nErrorID:= fbPowerAxis.ErrorID;
END_IF
if( fbMoveAxisABS.Error and fbMoveAxisABS.Active ) then
    This^.q_stVGP.pv_xError:= fbMoveAxisABS.Error;
    This^.q_stVGP.nErrorID:= fbMoveAxisABS.ErrorID;
END_IF

IF This^.q_stVGP.pv_xReset_SW THEN This^.q_stVGP.pv_xReset_SW:=FALSE; END_IF
(*Convert nErrorID to string*)
This^.q_stVGP.sErrorMessage:=WORD_TO_HEXSTR(in:=TO_WORD(This^.q_stVGP.nErrorID) , iPrecision:= 4, bLoCase:=0 );

This^.q_stVGP.xBusy := (NOT(q_stVGP.eState = READY) AND (HomeState = H_READY));
END_ACTION

ACTION ACT_HOME:
CASE HomeState OF
    H_READY:
        fbSetPosition.Execute := FALSE;
        fbWriteParameter.Execute := FALSE;
        fbMoveRel.Execute := FALSE;

    H_INIT:
    HomeState:=H_RESET_LL;


    H_RESET_LL:
        // disable soft limits in order to be able to move the drive
        fbWriteParameter.ParameterNumber := MC_AxisParameter.EnableLimitNeg;//EnableLimitPos;// .EnableLimitNeg;
        fbWriteParameter.Value := FALSE;
        fbWriteParameter.Execute := TRUE;
        if (fbWriteParameter.Done) THEN
            fbWriteParameter.Execute := FALSE;
            HomeState:= H_RESET_HL;
        END_IF

    H_RESET_HL:
        // disable soft limits in order to be able to move the drive
        fbWriteParameter.ParameterNumber := MC_AxisParameter.EnableLimitPos;
        fbWriteParameter.Value := FALSE;
        fbWriteParameter.Execute := TRUE;
        if (fbWriteParameter.Done) THEN
            fbWriteParameter.Execute := FALSE;
            HomeState:= H_ENABLE;
        END_IF

    H_ENABLE:
        // Make Sure drive is enabled
        fbPowerAxis.Enable :=  TRUE;
        fbPowerAxis.Enable_Positive := TRUE;
        fbPowerAxis.Enable_Negative := TRUE;
        IF fbPowerAxis.Status THEN
            HomeState:= H_MOVING;
        ELSIF fbPowerAxis.Error THEN
            HomeState := H_ERROR;
        END_IF

    H_MOVING:
        fbMoveRel.Execute := TRUE;
        IF fbMoveRel.Active  THEN
            (* axis is executing job but is not yet finished *)
            fbMoveRel.Execute := FALSE;
            (* leave this state and buffer a second command *)
            HomeState := H_MOVING2;
        ElSIF fbMoveRel.Done THEN
            fbMoveRel.Execute := FALSE;
            HomeState := H_MOVING;//2?
        ELSIF fbMoveRel.CommandAborted OR fbMoveRel.Error THEN
            fbMoveRel.Execute := FALSE;
            HomeState := H_CHECK;
        END_IF

    H_MOVING2:
        IF fbMoveRel.CommandAborted OR fbMoveRel.Error THEN
            HomeState := H_CHECK;
        END_IF
        IF NOT ( Axis.Status.Moving) OR (fbMoveRel.Done) THEN //(fbMoveAxisABS.Done) AND (fbMoveAxisABS2.Done) THEN
            HomeState := H_MOVING;
            fbMoveRel.Execute := FALSE;
        END_IF

    H_CHECK:
        //Check position lag monitoring error
        if (Axis.Status.ErrorID = 16#00004550)THEN
            This^.q_stVGP.pv_xReset_SW := TRUE;
            HomeState := H_RESET;
        ELSE
            HomeState := H_ERROR;
        END_IF

    H_RESET:
        IF fbReset.Done THEN
            This^.q_stVGP.pv_xReset_SW := FALSE;
            HomeState := H_SET_POS;
        END_IF

    H_SET_POS:
     // Set Current Position
        fbSetPosition.Position := 0;
        fbSetPosition.Execute := TRUE;
        IF ( fbSetPosition.Done ) THEN
            fbSetPosition.Execute := FALSE;
            HomeState:= H_WRITE_LL;
        ELSIF (fbSetPosition.Error) THEN
            HomeState := H_ERROR;
        END_IF


    H_WRITE_LL:
    // Re Enable the Soft limits
        fbWriteParameter.ParameterNumber := MC_AxisParameter.AxisEnMinSoftPosLimit;//AxisEnMaxSoftPosLimit;// .AxisEnMinSoftPosLimit;
        fbWriteParameter.Value := TRUE;
        fbWriteParameter.Execute := TRUE;
        if (fbWriteParameter.Done) THEN
            fbWriteParameter.Execute := FALSE;
            HomeState:= H_WRITE_HL;
        END_IF

    H_WRITE_HL:
    // Re Enable the Soft limits
        fbWriteParameter.ParameterNumber := MC_AxisParameter.AxisEnMaxSoftPosLimit;
        fbWriteParameter.Value := TRUE;
        fbWriteParameter.Execute := TRUE;
        if (fbWriteParameter.Done) THEN
            fbWriteParameter.Execute := FALSE;
            HomeState:= H_DONE;
        END_IF


    H_ERROR:
        //taken care of in the axis motion state machine
    H_DONE:
        //taken care of in the axis motion state machine

END_CASE

// Move backward to fully closed
fbMoveRel(
    Axis:= Axis ,
    Execute:= ,
    Distance:= rHomingDistance ,
    Velocity:= rHomingVelocity,
    Acceleration:= ,
    Deceleration:= ,
    Jerk:= ,
    BufferMode:= MC_BlendingNext,
    Options:= ,
    Done=&gt; ,
    Busy=&gt; ,
    Active=&gt; ,
    CommandAborted=&gt; ,
    Error=&gt; ,
    ErrorID=&gt; );

// Set Encoder Position
fbSetPosition(
    Axis:= Axis ,
    Execute:= ,
    Position:= 0 ,
    Mode:= FALSE, //Absolute
    Options:= ,
    Done=&gt; ,
    Busy=&gt; ,
    Error=&gt; ,
    ErrorID=&gt; );

// Write Parameters
fbWriteParameter(
    Axis:= Axis ,
    Execute:= ,
    ParameterNumber:= ,
    Value:= ,
    Done=&gt; ,
    Busy=&gt; ,
    Error=&gt; ,
    ErrorID=&gt; );

If ( fbWriteParameter.Error) OR (fbSetPosition.Error)(* OR (fbMoveRel.Error) *)THEN
    HomeState:= H_ERROR;
    q_stVGP.eState := ERROR;
END_IF
END_ACTION

ACTION ACT_INIT:
{attribute no_check}
IF bInit THEN

(*
    (* init array with the interpolation points  *)
    (*      fIn                                      |              fOut            *)
    arrTable[1,1] := 0;                     arrTable[1,2] := 0;
    arrTable[2,1] := 5;                 arrTable[2,2] := 135;
    arrTable[3,1] := 10;            arrTable[3,2] := 245;
    arrTable[4,1] :=  20;       arrTable[4,2] := 405;
    arrTable[5,1] :=  30;       arrTable[5,2] := 535;
    arrTable[6,1] := 40;            arrTable[6,2] := 689;
    arrTable[7,1] := 50;            arrTable[7,2] := 830;
    arrTable[8,1] := 60;        arrTable[8,2] := 960;
    arrTable[9,1] := 70;        arrTable[9,2] := 1095;
    arrTable[10,1] := 80;           arrTable[10,2] := 1225;
    arrTable[11,1] := 90;           arrTable[11,2] := 1415;
    arrTable[12,1] := 95;           arrTable[12,2] := 1495;
    arrTable[13,1] := 98;           arrTable[13,2] := 1559;
    arrTable[14,1] := 100;          arrTable[14,2] := 1645;
    *)

    (* init parameter struct *)
    stCTRL_LIN_INTERPOLATION_PARAMS.tCtrlCycleTime                                  := T#10ms;
    stCTRL_LIN_INTERPOLATION_PARAMS.tTaskCycleTime                                  := T#10ms;
    stCTRL_LIN_INTERPOLATION_PARAMS.nDataTable_NumberOfRows         := INT_TO_UINT(14);

    (* set the addresses *)
    stCTRL_LIN_INTERPOLATION_PARAMS.pDataTable_ADR                  := ADR(arrTable);
    stCTRL_LIN_INTERPOLATION_PARAMS.nDataTable_SIZEOF               := SIZEOF(arrTable);

    (* set the mode to ACTIVE --&gt; normal operation *)
    eMode                                                   := eCTRL_MODE_ACTIVE;


    (* init array with the interpolation points  *)
    (*      fIn                                      |              fOut            *)
     FOR iCounter:=1 TO 14 BY 1 DO
        arrTable_ENC[iCounter,1] := arrTable[iCounter,2];
        arrTable_ENC[iCounter,2] := arrTable[iCounter,1];
     END_FOR;
    (*
    arrTable_ENC[1,1] := 0;                 arrTable_ENC[1,2] := 0;
    arrTable_ENC[2,1] := 135;                   arrTable_ENC[2,2] := 5;
    arrTable_ENC[3,1] := 245;               arrTable_ENC[3,2] := 10;
    arrTable_ENC[4,1] :=  405;          arrTable_ENC[4,2] := 20;
    arrTable_ENC[5,1] :=  535;          arrTable_ENC[5,2] := 30;
    arrTable_ENC[6,1] := 689;               arrTable_ENC[6,2] := 40;
    arrTable_ENC[7,1] := 830;               arrTable_ENC[7,2] := 50;
    arrTable_ENC[8,1] := 960;           arrTable_ENC[8,2] := 60;
    arrTable_ENC[9,1] := 1095;          arrTable_ENC[9,2] := 70;
    arrTable_ENC[10,1] := 1225;             arrTable_ENC[10,2] := 80;
    arrTable_ENC[11,1] := 1415;             arrTable_ENC[11,2] := 90;
    arrTable_ENC[12,1] := 1495;             arrTable_ENC[12,2] := 95;
    arrTable_ENC[13,1] := 1559;             arrTable_ENC[13,2] := 98;
    arrTable_ENC[14,1] := 1645;             arrTable_ENC[14,2] := 100;*)


    (* init parameter struct *)
    stCTRL_LIN_INTERPOLATION_PARAMS_ENC.tCtrlCycleTime                                      := T#10ms;
    stCTRL_LIN_INTERPOLATION_PARAMS_ENC.tTaskCycleTime                                      := T#10ms;
    stCTRL_LIN_INTERPOLATION_PARAMS_ENC.nDataTable_NumberOfRows             := INT_TO_UINT(14);

    (* set the addresses *)
    stCTRL_LIN_INTERPOLATION_PARAMS_ENC.pDataTable_ADR                      := ADR(arrTable_ENC);
    stCTRL_LIN_INTERPOLATION_PARAMS_ENC.nDataTable_SIZEOF           := SIZEOF(arrTable_ENC);

    (* reset the init flag *)
    bInit                                                   := FALSE;

END_IF;
END_ACTION

ACTION ACT_LIN_INTERPOLATION:
{attribute &#39;no_check&#39;}
fbCTRL_LIN_INTERPOLATION(
    fIn:= q_stVGP.rReqPosition ,
    fManValue:= 0,
    bExtrapolate:= ,
    eMode:= eMode,
    fOut=&gt; ,
    bInIsGreaterThanMaxElement=&gt; ,
    bInIsLessThanMinElement=&gt; ,
    eState=&gt; ,
    eErrorId=&gt; ,
    bError=&gt; ,
    stParams:= stCTRL_LIN_INTERPOLATION_PARAMS );

// Target position Calculation
rTargetPosition := LREAL_TO_REAL(fbCTRL_LIN_INTERPOLATION.fOut);
//rTargetPosition := LIMIT(rClosePosition, rTargetPosition, rOpenPosition);

fbCTRL_LIN_INTERPOLATION_ENC(
    fIn:= Axis.NcToPlc.ActPos ,
    fManValue:= 0,
    bExtrapolate:= ,
    eMode:= eMode,
    fOut=&gt;  ,
    bInIsGreaterThanMaxElement=&gt; ,
    bInIsLessThanMinElement=&gt; ,
    eState=&gt; ,
    eErrorId=&gt; ,
    bError=&gt; ,
    stParams:= stCTRL_LIN_INTERPOLATION_PARAMS_ENC );
q_stVGP.i_iPosition := LREAL_TO_REAL(fbCTRL_LIN_INTERPOLATION_ENC.fOut);
END_ACTION

ACTION ACT_MONITOR:
IF (This^.q_stVGP.xBusy) THEN
    rPrevEncoderPosition:= This^.q_stVGP.rEnoder_Position;
ELSIF NOT((rPrevEncoderPosition &lt; This^.q_stVGP.rEnoder_Position +rHyst) AND (rPrevEncoderPosition &gt; This^.q_stVGP.rEnoder_Position -rHyst)) AND NOT( q_stVGP.eState =HOME)  AND NOT( q_stVGP.eState =ERROR) THEN
      q_stVGP.eState := ERROR;
      q_stVGP.pv_xHomed := FALSE;
      This^.q_stVGP.pv_xError := TRUE;
      This^.q_stVGP.sErrorMessage := &#39;Encoder Position Error&#39;;

END_IF

tErrorPresent(CLK:=q_stVGP.pv_xError);
IF tErrorPresent.Q THEN fbLogger(sMsg:=q_stVGP.sErrorMessage, eSevr:=TcEventSeverity.Error); END_IF

// Log valve motion
tAction(CLK:= q_stVGP.pv_xGo_SW);
IF tAction.Q THEN fbLogger(sMsg:=&#39;Valve commanded to move&#39;, eSevr:=TcEventSeverity.Info); END_IF


IF ePrevState &lt;&gt; q_stVGP.eValveControl THEN
      CASE q_stVGP.eValveControl OF

        CloseValve:
            fbLogger(sMsg:=&#39;Valve set to Close.&#39;, eSevr:=TcEventSeverity.Info);
          OpenValve:
            fbLogger(sMsg:=&#39;Valve set to Open.&#39;, eSevr:=TcEventSeverity.Info);
        PressureControl:
            fbLogger(sMsg:=&#39;Valve set to pressure control mode.&#39;, eSevr:=TcEventSeverity.Info);
        ManualControl:
            fbLogger(sMsg:=&#39;Valve set to manual control mode.&#39;, eSevr:=TcEventSeverity.Info);
      END_CASE
      ePrevState := q_stVGP.eValveControl;
  END_IF
END_ACTION

METHOD ConfigEncoder : BOOL
VAR_INPUT
    EncoderMax: REAl; // Maximum encoder reading from fully closed to fully open
    invert: Bool; // Invert Encoder Counting Direction
END_VAR
VAR
    fbWriteParameter1: MC_WriteBoolParameter;
END_VAR
rOpenPosition := EncoderMax;

// fEncScaleFactor  -  AxisEncoderScalingFactor

// bEncIsInverse  -
if (invert) THEN
    fbWriteParameter1.ParameterNumber :=  MC_AxisParameter.AxisEncoderDirectionInverse;
    fbWriteParameter1.Value := True;
END_IF

// Write Parameters
fbWriteParameter1(
    Axis:= Axis ,
    Execute:= ,
    ParameterNumber:= ,
    Value:= ,
    Done=&gt; ,
    Busy=&gt; ,
    Error=&gt; ,
    ErrorID=&gt; );
END_METHOD

METHOD M_INIT : BOOL
VAR_INPUT
    arrTable        : ARRAY[1..14,1..2] OF FLOAT;
    arrTable_ENC : ARRAY[1..14,1..2] OF FLOAT;
END_VAR
(* init array with the interpolation points  *)
    (*      fIn                                      |              fOut            *)
    arrTable[1,1] := 0;                     arrTable[1,2] := 0;
    arrTable[2,1] := 5;                 arrTable[2,2] := 135;
    arrTable[3,1] := 10;            arrTable[3,2] := 245;
    arrTable[4,1] :=  20;       arrTable[4,2] := 405;
    arrTable[5,1] :=  30;       arrTable[5,2] := 535;
    arrTable[6,1] := 40;            arrTable[6,2] := 689;
    arrTable[7,1] := 50;            arrTable[7,2] := 830;
    arrTable[8,1] := 60;        arrTable[8,2] := 960;
    arrTable[9,1] := 70;        arrTable[9,2] := 1095;
    arrTable[10,1] := 80;           arrTable[10,2] := 1225;
    arrTable[11,1] := 90;           arrTable[11,2] := 1415;
    arrTable[12,1] := 95;           arrTable[12,2] := 1495;
    arrTable[13,1] := 98;           arrTable[13,2] := 1559;
    arrTable[14,1] := 100;          arrTable[14,2] := 1645;


    (* init parameter struct *)
    stCTRL_LIN_INTERPOLATION_PARAMS.tCtrlCycleTime                                  := T#10ms;
    stCTRL_LIN_INTERPOLATION_PARAMS.tTaskCycleTime                                  := T#10ms;
    stCTRL_LIN_INTERPOLATION_PARAMS.nDataTable_NumberOfRows         := INT_TO_UINT(14);

    (* set the addresses *)
    stCTRL_LIN_INTERPOLATION_PARAMS.pDataTable_ADR                  := ADR(arrTable);
    stCTRL_LIN_INTERPOLATION_PARAMS.nDataTable_SIZEOF               := SIZEOF(arrTable);

    (* set the mode to ACTIVE --&gt; normal operation *)
    eMode                                                   := eCTRL_MODE_ACTIVE;


    (* init array with the interpolation points  *)
    (*      fIn                                      |              fOut            *)
    arrTable_ENC[1,1] := 0;                 arrTable_ENC[1,2] := 0;
    arrTable_ENC[2,1] := 135;                   arrTable_ENC[2,2] := 5;
    arrTable_ENC[3,1] := 245;               arrTable_ENC[3,2] := 10;
    arrTable_ENC[4,1] :=  405;          arrTable_ENC[4,2] := 20;
    arrTable_ENC[5,1] :=  535;          arrTable_ENC[5,2] := 30;
    arrTable_ENC[6,1] := 689;               arrTable_ENC[6,2] := 40;
    arrTable_ENC[7,1] := 830;               arrTable_ENC[7,2] := 50;
    arrTable_ENC[8,1] := 960;           arrTable_ENC[8,2] := 60;
    arrTable_ENC[9,1] := 1095;          arrTable_ENC[9,2] := 70;
    arrTable_ENC[10,1] := 1225;             arrTable_ENC[10,2] := 80;
    arrTable_ENC[11,1] := 1415;             arrTable_ENC[11,2] := 90;
    arrTable_ENC[12,1] := 1495;             arrTable_ENC[12,2] := 95;
    arrTable_ENC[13,1] := 1559;             arrTable_ENC[13,2] := 98;
    arrTable_ENC[14,1] := 1645;             arrTable_ENC[14,2] := 100;


    (* init parameter struct *)
    stCTRL_LIN_INTERPOLATION_PARAMS_ENC.tCtrlCycleTime                                      := T#10ms;
    stCTRL_LIN_INTERPOLATION_PARAMS_ENC.tTaskCycleTime                                      := T#10ms;
    stCTRL_LIN_INTERPOLATION_PARAMS_ENC.nDataTable_NumberOfRows             := INT_TO_UINT(14);

    (* set the addresses *)
    stCTRL_LIN_INTERPOLATION_PARAMS_ENC.pDataTable_ADR                      := ADR(arrTable_ENC);
    stCTRL_LIN_INTERPOLATION_PARAMS_ENC.nDataTable_SIZEOF           := SIZEOF(arrTable_ENC);
END_METHOD

METHOD M_SetGoSw : BOOL
VAR_INPUT
    bGo:BOOL;
END_VAR
q_stVGP.pv_xGo_SW:=bGo;
END_METHOD

METHOD M_ValveControl : BOOL
VAR_INPUT
    state:E_VCN; // Close, Open, Pressure, Manual
END_VAR
q_stVGP.eValveControl := state;
END_METHOD

METHOD PUBLIC SetEncoderMax : BOOL
VAR_INPUT
    EncoderMax: REAl;
END_VAR
rOpenPosition := EncoderMax;
END_METHOD
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#e-homestate">E_HomeState</a></p></li>
<li><p><a class="reference internal" href="#st-vgp">ST_VGP</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-1-plctask">
<h2>PRG_1_PlcTask<a class="headerlink" href="#prg-1-plctask" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_1_PlcTask</span>
<span class="n">VAR</span>

<span class="n">bDebug</span> <span class="p">:</span> <span class="n">Bool</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">bMotionTest</span> <span class="p">:</span> <span class="n">Bool</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">fb_ADS_WATCHDOG</span><span class="p">:</span><span class="n">FB_ADS_WATCHDOG</span><span class="p">;</span>
<span class="n">sVarName</span> <span class="p">:</span> <span class="n">STRING</span><span class="o">:=</span><span class="s1">&#39;GVL_VAC_INTF.n_AT1K0_VAC_counter&#39;</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span><span class="n">GVL_VAC_INTF</span><span class="o">.</span><span class="n">n_AT1K0_VAC_counter</span>
<span class="n">fb_ADS_WATCHDOG</span><span class="p">(</span><span class="n">sNetId</span><span class="o">:=</span><span class="s1">&#39;172.21.92.61.1.1&#39;</span> <span class="p">,</span> <span class="n">nPort</span><span class="o">:=</span><span class="mi">851</span> <span class="p">,</span> <span class="n">sVarName</span><span class="o">:=</span><span class="n">sVarName</span><span class="p">,</span><span class="n">bError</span><span class="o">=&gt;</span> <span class="p">);</span>
<span class="p">(</span><span class="o">*</span><span class="n">Ethercat</span> <span class="n">Diagnostics</span><span class="o">*</span><span class="p">)</span>
<span class="n">DIAGNOSTICS</span><span class="p">();</span>
<span class="o">//</span> <span class="n">Vacuum</span> <span class="ow">and</span> <span class="n">differential</span> <span class="n">pumping</span>
<span class="n">PRG_GATT</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">bDebug</span><span class="p">)</span><span class="n">Then</span>
    <span class="o">//</span> <span class="n">Motorised</span> <span class="n">valve</span>
    <span class="n">PRG_VGP</span><span class="p">();</span>
<span class="n">END_IF</span>
<span class="k">if</span> <span class="p">(</span><span class="n">bMotionTest</span><span class="p">)</span><span class="n">Then</span>
    <span class="o">//</span> <span class="n">Functionblock</span> <span class="k">for</span> <span class="n">PTP</span> <span class="n">motion</span> <span class="n">between</span> <span class="n">different</span> <span class="n">appertures</span>
    <span class="n">PRG_Motors_Test</span><span class="p">();</span>
<span class="n">ELSE</span>
    <span class="n">PRG_Motion</span><span class="p">();</span>
<span class="n">END_IF</span>


<span class="n">PRG_ILK</span><span class="p">();</span>
<span class="o">//</span><span class="n">PMPS</span>
<span class="n">PRG_PMPS</span><span class="p">();</span>
<span class="n">PRG_GasSelection</span><span class="p">();</span>
<span class="n">PRG_Transmission</span><span class="p">();</span>
<span class="o">//</span> <span class="n">Injector</span>
<span class="n">PRG_INJ</span><span class="p">();</span>
<span class="o">//</span><span class="n">Logger</span>
<span class="n">fbLogHandler</span><span class="p">();</span>
<span class="n">fbEcatDiagWrapper</span><span class="p">();</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#diagnostics">DIAGNOSTICS</a></p></li>
<li><p><a class="reference internal" href="#prg-gatt">PRG_GATT</a></p></li>
<li><p><a class="reference internal" href="#prg-gasselection">PRG_GasSelection</a></p></li>
<li><p><a class="reference internal" href="#prg-ilk">PRG_ILK</a></p></li>
<li><p><a class="reference internal" href="#prg-inj">PRG_INJ</a></p></li>
<li><p><a class="reference internal" href="#prg-motion">PRG_Motion</a></p></li>
<li><p><a class="reference internal" href="#prg-motors-test">PRG_Motors_Test</a></p></li>
<li><p><a class="reference internal" href="#prg-pmps">PRG_PMPS</a></p></li>
<li><p><a class="reference internal" href="#prg-transmission">PRG_Transmission</a></p></li>
<li><p><a class="reference internal" href="#prg-vgp">PRG_VGP</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-gasselection">
<h2>PRG_GasSelection<a class="headerlink" href="#prg-gasselection" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_GasSelection</span>
<span class="n">VAR</span>
    <span class="n">N2LowerEdge</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mi">300</span><span class="p">;</span>
    <span class="n">N2UpperEdge</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mi">450</span><span class="p">;</span>
    <span class="n">rDelta</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span><span class="mi">20</span><span class="p">;</span>
    <span class="n">ArEdge</span><span class="p">:</span><span class="n">REAL</span><span class="o">:=</span><span class="mi">2300</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span><span class="n">Gas</span> <span class="n">Selection</span><span class="o">*</span><span class="p">)</span>
<span class="n">IF</span><span class="p">(</span><span class="n">VVC_71</span><span class="o">.</span><span class="n">M_IsOpen</span><span class="p">())</span> <span class="n">THEN</span>  <span class="n">SelectedGas</span> <span class="o">:=</span> <span class="n">E_GasType</span><span class="o">.</span><span class="n">Argon</span><span class="p">;</span>
    <span class="n">ELSIF</span> <span class="p">(</span><span class="n">VVC_72</span><span class="o">.</span><span class="n">M_IsOpen</span><span class="p">())</span> <span class="n">THEN</span>  <span class="n">SelectedGas</span> <span class="o">:=</span> <span class="n">E_GasType</span><span class="o">.</span><span class="n">Nitrogen</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">xPMPSMode</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">bChangeGas</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">IF</span><span class="p">(</span><span class="n">rPhotonEnergy</span> <span class="o">&gt;=</span><span class="n">N2LowerEdge</span><span class="o">-</span><span class="n">rDelta</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">rPhotonEnergy</span> <span class="o">&lt;=</span><span class="n">N2UpperEdge</span><span class="o">-</span><span class="n">rDelta</span><span class="p">)(</span><span class="o">*</span> <span class="n">AND</span>   <span class="n">NOT</span> <span class="p">(</span><span class="n">SelectedGas</span> <span class="o">=</span> <span class="n">E_GasType</span><span class="o">.</span><span class="n">Argon</span><span class="p">)</span><span class="o">*</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="o">//</span><span class="n">Block</span> <span class="n">N2</span>
        <span class="n">VVC_72</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span> <span class="p">(</span><span class="n">false</span><span class="p">);</span>
        <span class="n">IF</span> <span class="n">VVC_72</span><span class="o">.</span><span class="n">M_IsClosed</span><span class="p">()</span> <span class="n">THEN</span>
            <span class="n">VVC_71</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span> <span class="p">(</span><span class="n">TRUE</span><span class="p">);</span>
            <span class="n">bChangeGas</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;AT1K0 switched to Ar&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
            <span class="n">END_IF</span><span class="p">;</span>
    <span class="n">ELSIF</span>  <span class="p">((</span><span class="n">rPhotonEnergy</span> <span class="o">&lt;=</span> <span class="mi">220</span><span class="p">)</span> <span class="n">OR</span> <span class="p">(</span><span class="n">rPhotonEnergy</span> <span class="o">&gt;=</span><span class="mi">2300</span><span class="p">))</span> <span class="p">(</span><span class="o">*</span><span class="n">AND</span>  <span class="n">NOT</span> <span class="p">(</span><span class="n">SelectedGas</span> <span class="o">=</span> <span class="n">E_GasType</span><span class="o">.</span><span class="n">Nitrogen</span><span class="p">)</span><span class="o">*</span><span class="p">)</span>  <span class="n">THEN</span>
        <span class="o">//</span><span class="n">Block</span> <span class="n">Ar</span>
        <span class="n">VVC_71</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span> <span class="p">(</span><span class="n">false</span><span class="p">);</span>
        <span class="n">IF</span> <span class="n">VVC_71</span><span class="o">.</span><span class="n">M_IsClosed</span><span class="p">()</span> <span class="n">THEN</span>
            <span class="n">VVC_72</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span> <span class="p">(</span><span class="n">TRUE</span><span class="p">);</span>
            <span class="n">bChangeGas</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;AT1K0 switched to N2&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="n">ELSE</span>
        <span class="n">VVC_72</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span> <span class="p">(</span><span class="n">TRUE</span><span class="p">);</span>
        <span class="n">bChangeGas</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="o">//</span><span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;AT1K0 switched to N2&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
    <span class="n">END_IF</span>
    <span class="n">ELSE</span>
        <span class="n">bChangeGas</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#e-gastype">E_GasType</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-gatt">
<h2>PRG_GATT<a class="headerlink" href="#prg-gatt" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_GATT</span>
<span class="n">VAR</span>
    <span class="n">timer</span><span class="p">:</span><span class="n">TON</span><span class="p">;</span>
    <span class="n">vvcTimer</span><span class="p">:</span><span class="n">TON</span><span class="p">;</span>
    <span class="n">PG</span><span class="p">:</span> <span class="n">ST_VG</span><span class="p">;</span>
    <span class="n">rPRESS</span> <span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mf">0.001</span><span class="p">;</span>
    <span class="n">rPRESS_11</span> <span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">fb_ADS_WATCHDOG</span><span class="p">:</span><span class="n">FB_ADS_WATCHDOG</span><span class="p">;</span>
    <span class="n">rTrig_11</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">this</span> <span class="n">function</span> <span class="n">block</span> <span class="n">writes</span> <span class="n">the</span> <span class="n">watchdog</span> <span class="n">bit</span> <span class="n">to</span> <span class="n">the</span> <span class="n">remote</span> <span class="n">PLC</span> <span class="n">reading</span> <span class="n">the</span> <span class="n">treaty</span> <span class="n">valves</span> <span class="ow">and</span><span class="o">/</span><span class="ow">or</span> <span class="n">gauge</span>
<span class="n">fb_ADS_WATCHDOG</span><span class="p">(</span><span class="n">sNetId</span><span class="o">:=</span><span class="s1">&#39;172.21.88.32.1.1&#39;</span> <span class="p">,</span> <span class="n">nPort</span><span class="o">:=</span><span class="mi">851</span> <span class="p">,</span> <span class="n">sVarName</span><span class="o">:=</span><span class="s1">&#39;GVL_Devices.iWatchdog&#39;</span><span class="p">,</span><span class="n">bError</span><span class="o">=&gt;</span> <span class="p">);</span>


<span class="o">//</span> <span class="n">GAUGES</span>
<span class="o">//</span> <span class="n">MKS275</span> <span class="n">Gauges</span>
<span class="n">fb_AT1K0_GAS_GPI_111</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GPI_121</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GPI_141</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span><span class="p">);</span>
<span class="o">//</span> <span class="n">FB_MKS317</span>
<span class="n">fb_AT1K0_GAS_GPI_10</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GPI_20</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GPI_11</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GPI_12</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GPI_30</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GPI_40</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GPI_50</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GPI_51</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GPI_60</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GPI_80</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GPI_90</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GPI_100</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GPI_110</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GPI_120</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GPI_130</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GPI_140</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span><span class="p">);</span>

<span class="o">//</span> <span class="n">FB_MKS422</span>

<span class="n">fb_AT1K0_GAS_GCC_10</span><span class="p">(</span><span class="n">PG</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_GPI_10</span><span class="o">.</span><span class="n">PG</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GCC_20</span><span class="p">(</span><span class="n">PG</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_GPI_20</span><span class="o">.</span><span class="n">PG</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GCC_30</span><span class="p">(</span><span class="n">PG</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_GPI_30</span><span class="o">.</span><span class="n">PG</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GCC_40</span><span class="p">(</span><span class="n">PG</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_GPI_40</span><span class="o">.</span><span class="n">PG</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GCC_50</span><span class="p">(</span><span class="n">PG</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_GPI_50</span><span class="o">.</span><span class="n">PG</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GCC_60</span><span class="p">(</span><span class="n">PG</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_GPI_60</span><span class="o">.</span><span class="n">PG</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GCC_80</span><span class="p">(</span><span class="n">PG</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_GPI_80</span><span class="o">.</span><span class="n">PG</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GCC_90</span><span class="p">(</span><span class="n">PG</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_GPI_90</span><span class="o">.</span><span class="n">PG</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GCC_100</span><span class="p">(</span><span class="n">PG</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_GPI_100</span><span class="o">.</span><span class="n">PG</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GCC_110</span><span class="p">(</span><span class="n">PG</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_GPI_110</span><span class="o">.</span><span class="n">PG</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GCC_120</span><span class="p">(</span><span class="n">PG</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_GPI_120</span><span class="o">.</span><span class="n">PG</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GCC_130</span><span class="p">(</span><span class="n">PG</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_GPI_130</span><span class="o">.</span><span class="n">PG</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_GCC_140</span><span class="p">(</span><span class="n">PG</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_GPI_140</span><span class="o">.</span><span class="n">PG</span><span class="p">);</span>


<span class="o">//</span><span class="n">VALVES</span>
<span class="o">//</span> <span class="n">Pump</span> <span class="n">Isolation</span> <span class="n">Valves</span>
<span class="o">//</span> <span class="n">FB_VRC</span>
<span class="o">//</span><span class="n">EBD</span> <span class="n">Side</span>
<span class="o">//</span><span class="n">TURBO</span>
<span class="n">fb_AT1K0_GAS_VRC_10</span><span class="p">(</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">F_TurboGateValve_ILK</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_10</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_GPI_10</span><span class="o">.</span><span class="n">PG</span><span class="p">)</span><span class="n">AND</span> <span class="n">fb_AT1K0_GAS_PTM_10</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">,</span> <span class="n">i_xOverrideMode</span> <span class="o">:=</span> <span class="n">xSystemOverrideMode</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_VRC_20</span><span class="p">(</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">F_TurboGateValve_ILK</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_20</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_GPI_20</span><span class="o">.</span><span class="n">PG</span><span class="p">)</span><span class="n">AND</span> <span class="n">fb_AT1K0_GAS_PTM_20</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">,</span> <span class="n">i_xOverrideMode</span> <span class="o">:=</span> <span class="n">xSystemOverrideMode</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_VRC_30</span><span class="p">(</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">F_TurboGateValve_ILK</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_30</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_GPI_30</span><span class="o">.</span><span class="n">PG</span><span class="p">)</span><span class="n">AND</span> <span class="n">fb_AT1K0_GAS_PTM_30</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">,</span> <span class="n">i_xOverrideMode</span> <span class="o">:=</span> <span class="n">xSystemOverrideMode</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_VRC_40</span><span class="p">(</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">F_TurboGateValve_ILK</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_40</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_GPI_40</span><span class="o">.</span><span class="n">PG</span><span class="p">)</span><span class="n">AND</span> <span class="n">fb_AT1K0_GAS_PTM_40</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">,</span> <span class="n">i_xOverrideMode</span> <span class="o">:=</span> <span class="n">xSystemOverrideMode</span><span class="p">);</span>

<span class="o">//</span> <span class="n">Auto</span> <span class="nb">open</span> <span class="n">the</span> <span class="n">VRC</span> <span class="n">when</span> <span class="n">pressure</span> <span class="k">if</span> <span class="n">ok</span>
<span class="n">rTrig_11</span><span class="p">(</span><span class="n">CLK</span> <span class="o">:=</span> <span class="p">(</span> <span class="n">fb_AT1K0_GAS_GPI_11</span><span class="o">.</span><span class="n">PG</span><span class="o">.</span><span class="n">xPRESS_OK</span> <span class="n">AND</span> <span class="n">fb_AT1K0_GAS_GPI_11</span><span class="o">.</span><span class="n">PG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">));</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">rTrig_11</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">fb_AT1K0_GAS_VRC_11</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span> <span class="p">(</span><span class="n">TRUE</span><span class="p">);</span>
<span class="n">END_IF</span>
<span class="n">fb_AT1K0_GAS_VRC_11</span><span class="p">(</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_GPI_11</span><span class="o">.</span><span class="n">PG</span><span class="o">.</span><span class="n">xPRESS_OK</span> <span class="n">AND</span> <span class="n">fb_AT1K0_GAS_GPI_11</span><span class="o">.</span><span class="n">PG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&lt;</span> <span class="n">rPRESS_11</span><span class="p">)</span> <span class="p">,</span> <span class="n">i_xOverrideMode</span> <span class="o">:=</span> <span class="n">xSystemOverrideMode</span><span class="p">);</span>
<span class="o">//</span><span class="n">EBD</span>
<span class="n">fb_AT1K0_GAS_VRC_50</span><span class="p">(</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">F_VRC_DIODE_ILK_OK</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_GPI_50</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_GPI_51</span><span class="o">.</span><span class="n">PG</span><span class="p">),</span> <span class="n">i_xOverrideMode</span> <span class="o">:=</span> <span class="n">xSystemOverrideMode</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_VRC_60</span><span class="p">(</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">F_VRC_DIODE_ILK_OK</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_GPI_60</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_GPI_51</span><span class="o">.</span><span class="n">PG</span><span class="p">),</span> <span class="n">i_xOverrideMode</span> <span class="o">:=</span> <span class="n">xSystemOverrideMode</span><span class="p">);</span>
<span class="o">//</span><span class="n">FEE</span> <span class="n">Side</span>
<span class="n">PG</span><span class="o">.</span><span class="n">xPRESS_OK</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">PG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">:=</span> <span class="n">rPRESS</span><span class="p">;</span>
<span class="n">fb_AT1K0_GAS_VRC_70</span><span class="p">(</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_PMF_90</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">i_xMPStatus</span> <span class="n">AND</span> <span class="p">(</span><span class="n">F_VRC_DIODE_ILK_OK</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_GPI_80</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span><span class="n">PG</span><span class="p">)</span> <span class="n">AND</span> <span class="n">VVC_71</span><span class="o">.</span><span class="n">M_IsClosed</span><span class="p">()</span> <span class="n">AND</span> <span class="n">VVC_72</span><span class="o">.</span><span class="n">M_IsClosed</span><span class="p">()),</span> <span class="n">i_xOverrideMode</span> <span class="o">:=</span> <span class="n">xSystemOverrideMode</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_VRC_90</span><span class="p">(</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_PMF_90</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">i_xMPStatus</span> <span class="n">AND</span> <span class="p">(</span><span class="n">F_VRC_DIODE_ILK_OK</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_GPI_90</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span><span class="n">PG</span><span class="p">)),</span> <span class="n">i_xOverrideMode</span> <span class="o">:=</span> <span class="n">xSystemOverrideMode</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_VRC_100</span><span class="p">(</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_PMF_100</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">i_xMPStatus</span> <span class="n">AND</span> <span class="p">(</span><span class="n">F_VRC_DIODE_ILK_OK</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_GPI_100</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span><span class="n">PG</span><span class="p">)),</span> <span class="n">i_xOverrideMode</span> <span class="o">:=</span> <span class="n">xSystemOverrideMode</span><span class="p">);</span>
<span class="o">//</span><span class="n">TURBO</span>
<span class="n">fb_AT1K0_GAS_VRC_110</span><span class="p">(</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">F_TurboGateValve_ILK</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_110</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_GPI_110</span><span class="o">.</span><span class="n">PG</span><span class="p">)</span> <span class="n">AND</span> <span class="n">fb_AT1K0_GAS_PTM_110</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span>  <span class="p">,</span> <span class="n">i_xOverrideMode</span> <span class="o">:=</span> <span class="n">xSystemOverrideMode</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_VRC_120</span><span class="p">(</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">F_TurboGateValve_ILK</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_120</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_GPI_120</span><span class="o">.</span><span class="n">PG</span><span class="p">)</span> <span class="n">AND</span> <span class="n">fb_AT1K0_GAS_PTM_120</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">,</span> <span class="n">i_xOverrideMode</span> <span class="o">:=</span> <span class="n">xSystemOverrideMode</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_VRC_130</span><span class="p">(</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">F_TurboGateValve_ILK</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_130</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_GPI_130</span><span class="o">.</span><span class="n">PG</span><span class="p">)</span> <span class="n">AND</span> <span class="n">fb_AT1K0_GAS_PTM_130</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">,</span> <span class="n">i_xOverrideMode</span> <span class="o">:=</span> <span class="n">xSystemOverrideMode</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_VRC_140</span><span class="p">(</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">F_TurboGateValve_ILK</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_140</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_GPI_140</span><span class="o">.</span><span class="n">PG</span><span class="p">)</span> <span class="n">AND</span> <span class="n">fb_AT1K0_GAS_PTM_140</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">,</span> <span class="n">i_xOverrideMode</span> <span class="o">:=</span> <span class="n">xSystemOverrideMode</span><span class="p">);</span>
<span class="o">//</span><span class="n">N2</span> <span class="n">valve</span>
<span class="o">//</span><span class="n">INL</span> <span class="n">VCN</span><span class="p">,</span> <span class="n">VGP</span> <span class="ow">and</span> <span class="n">VRC_70</span> <span class="n">are</span> <span class="n">closed</span><span class="o">.</span>
<span class="n">fb_AT1K0_GAS_VRC_80</span><span class="o">.</span><span class="n">i_xExtILK_OK</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_VRC_90</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">i_xClsLS</span> <span class="n">AND</span> <span class="n">VCN_70</span><span class="o">.</span><span class="n">iq_stVCN</span><span class="o">.</span><span class="n">rReqPosition</span> <span class="o">&lt;</span><span class="mf">0.4</span> <span class="n">AND</span> <span class="n">VVC_71</span><span class="o">.</span><span class="n">M_IsClosed</span><span class="p">()</span> <span class="n">AND</span> <span class="n">VVC_72</span><span class="o">.</span><span class="n">M_IsClosed</span><span class="p">()</span> <span class="p">;</span> <span class="o">//</span><span class="n">AND</span> <span class="n">VGP</span> <span class="ow">is</span> <span class="n">closed</span><span class="p">;</span>
<span class="n">fb_AT1K0_GAS_VRC_80</span><span class="p">(</span> <span class="n">i_xOverrideMode</span> <span class="o">:=</span> <span class="n">xSystemOverrideMode</span><span class="p">);</span>


<span class="o">//</span> <span class="n">Turbo</span> <span class="n">Pumps</span>
<span class="o">//</span> <span class="n">FB_PTM_Ebara_010M</span>
<span class="o">//</span><span class="n">EBD</span> <span class="n">SIDE</span>
<span class="n">fb_AT1K0_GAS_PTM_10</span><span class="p">(</span><span class="n">i_xExtILKOk</span> <span class="o">:=</span> <span class="n">F_TurboExtILKLogic_2</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_10</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span> <span class="n">fb_AT1K0_GAS_GPI_12</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span> <span class="n">fb_AT1K0_GAS_GPI_10</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_PMF_10</span><span class="o">.</span><span class="n">iq_stPFO</span><span class="p">));</span><span class="o">//</span> <span class="n">AND</span> <span class="n">fb_AT1K0_GAS_VRC_11</span><span class="o">.</span><span class="n">M_IsOpen</span><span class="p">()</span> <span class="p">);</span>
<span class="n">fb_AT1K0_GAS_PTM_20</span><span class="p">(</span><span class="n">i_xExtILKOk</span> <span class="o">:=</span> <span class="n">F_TurboExtILKLogic_2</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_20</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span> <span class="n">fb_AT1K0_GAS_GPI_12</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span> <span class="n">fb_AT1K0_GAS_GPI_20</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_PMF_10</span><span class="o">.</span><span class="n">iq_stPFO</span><span class="p">));</span><span class="o">//</span> <span class="n">AND</span> <span class="n">fb_AT1K0_GAS_VRC_11</span><span class="o">.</span><span class="n">M_IsOpen</span><span class="p">()</span> <span class="p">);</span>
<span class="n">fb_AT1K0_GAS_PTM_30</span><span class="p">(</span><span class="n">i_xExtILKOk</span> <span class="o">:=</span> <span class="n">F_TurboExtILKLogic_2</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_30</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span> <span class="n">fb_AT1K0_GAS_GPI_12</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span> <span class="n">fb_AT1K0_GAS_GPI_30</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_PMF_10</span><span class="o">.</span><span class="n">iq_stPFO</span><span class="p">));</span><span class="o">//</span> <span class="n">AND</span> <span class="n">fb_AT1K0_GAS_VRC_11</span><span class="o">.</span><span class="n">M_IsOpen</span><span class="p">()</span> <span class="p">);</span>
<span class="n">fb_AT1K0_GAS_PTM_40</span><span class="p">(</span><span class="n">i_xExtILKOk</span> <span class="o">:=</span> <span class="n">F_TurboExtILKLogic_2</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_40</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span> <span class="n">fb_AT1K0_GAS_GPI_12</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span> <span class="n">fb_AT1K0_GAS_GPI_40</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_PMF_10</span><span class="o">.</span><span class="n">iq_stPFO</span><span class="p">));</span><span class="o">//</span> <span class="n">AND</span> <span class="n">fb_AT1K0_GAS_VRC_11</span><span class="o">.</span><span class="n">M_IsOpen</span><span class="p">()</span> <span class="p">);</span>
<span class="o">//</span><span class="n">FEE</span> <span class="n">Side</span>
<span class="n">fb_AT1K0_GAS_PTM_110</span><span class="p">(</span><span class="n">i_xExtILKOk</span> <span class="o">:=</span> <span class="n">F_TurboExtILKLogic_2</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_110</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span> <span class="n">fb_AT1K0_GAS_GPI_111</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_GPI_110</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_PMF_110</span><span class="o">.</span><span class="n">stPump</span><span class="p">));</span>
<span class="n">fb_AT1K0_GAS_PTM_120</span><span class="p">(</span><span class="n">i_xExtILKOk</span> <span class="o">:=</span> <span class="n">F_TurboExtILKLogic_2</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_120</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span> <span class="n">fb_AT1K0_GAS_GPI_121</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span> <span class="n">fb_AT1K0_GAS_GPI_120</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_PMF_120</span><span class="o">.</span><span class="n">stPump</span><span class="p">));</span>
<span class="n">fb_AT1K0_GAS_PTM_130</span><span class="p">(</span><span class="n">i_xExtILKOk</span> <span class="o">:=</span> <span class="n">F_TurboExtILKLogic_2</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_130</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span> <span class="n">fb_AT1K0_GAS_GPI_121</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_GPI_130</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_PMF_120</span><span class="o">.</span><span class="n">stPump</span><span class="p">));</span>
<span class="n">fb_AT1K0_GAS_PTM_140</span><span class="p">(</span><span class="n">i_xExtILKOk</span> <span class="o">:=</span> <span class="n">F_TurboExtILKLogic_2</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_140</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span> <span class="n">fb_AT1K0_GAS_GPI_141</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_GPI_140</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_PMF_140</span><span class="o">.</span><span class="n">stPump</span><span class="p">));</span>


<span class="o">//</span> <span class="n">Injector</span> <span class="n">side</span>
<span class="n">fb_AT1K0_GAS_VVC_80</span><span class="o">.</span><span class="n">i_xExtILK_OK</span><span class="o">:=</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_GPI_111</span><span class="o">.</span><span class="n">PG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&lt;=</span> <span class="n">fb_AT1K0_GAS_PTM_80</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">rBackingPressureSP</span><span class="p">)</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_80</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpFAULT</span><span class="p">)</span>  <span class="n">AND</span>  <span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_80</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span>  <span class="n">OR</span>  <span class="n">fb_AT1K0_GAS_PTM_80</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpSTARTING</span> <span class="p">)</span><span class="n">AND</span>  <span class="p">(</span><span class="n">fb_AT1K0_GAS_PMF_110</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span>  <span class="n">OR</span>  <span class="n">fb_AT1K0_GAS_PMF_110</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpSTARTING</span> <span class="p">);</span>
<span class="n">fb_AT1K0_GAS_VVC_80</span><span class="p">(</span><span class="n">i_xOverrideMode</span><span class="o">:=</span> <span class="n">xSystemOverrideMode</span> <span class="p">,</span> <span class="n">iq_stValve</span><span class="o">=&gt;</span> <span class="p">);</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_80</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">)</span> <span class="n">AND</span> <span class="n">fb_AT1K0_GAS_VVC_80</span><span class="o">.</span><span class="n">M_IsClosed</span><span class="p">()</span> <span class="n">THEN</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">timer</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span> <span class="n">fb_AT1K0_GAS_PTM_80</span><span class="o">.</span><span class="n">i_xExtILKOk</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_VVC_80</span><span class="o">.</span><span class="n">M_IsOpen</span><span class="p">()</span> <span class="n">AND</span> <span class="n">F_TurboExtILKLogic_2</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_80</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span> <span class="n">fb_AT1K0_GAS_GPI_111</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_GPI_80</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_PMF_110</span><span class="o">.</span><span class="n">stPump</span><span class="p">);</span><span class="o">//</span><span class="n">fb_AT1K0_GAS_PTM_80</span><span class="o">.</span><span class="n">i_xExtILKOk</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
 <span class="n">END_IF</span><span class="p">;</span>
<span class="n">ELSE</span>
    <span class="n">fb_AT1K0_GAS_PTM_80</span><span class="o">.</span><span class="n">i_xExtILKOk</span> <span class="o">:=</span>  <span class="n">F_TurboExtILKLogic_2</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_80</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="p">,</span> <span class="n">fb_AT1K0_GAS_GPI_111</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_GPI_80</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span><span class="n">fb_AT1K0_GAS_PMF_110</span><span class="o">.</span><span class="n">stPump</span><span class="p">);</span>
<span class="n">END_IF</span>
<span class="n">fb_AT1K0_GAS_PTM_80</span><span class="p">();</span>
<span class="n">timer</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_80</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">),</span> <span class="n">PT</span><span class="o">:=</span><span class="n">T</span><span class="c1">#1S);</span>



<span class="o">//</span><span class="n">Rouging</span> <span class="n">pumps</span>
<span class="o">//</span> <span class="n">FB_EbaraDryPump</span>
<span class="o">//</span><span class="n">EBD</span> <span class="n">SIDE</span>
<span class="n">fb_AT1K0_GAS_PMF_10</span><span class="p">(</span><span class="n">xExtIlk</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span><span class="n">TurboIsOn</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_PMF_60</span><span class="p">(</span><span class="n">xExtIlk</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span><span class="n">TurboIsOn</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">);</span>
<span class="o">//</span><span class="n">FEE</span> <span class="n">SIDE</span>
<span class="n">fb_AT1K0_GAS_PMF_90</span><span class="p">(</span><span class="n">i_stBPGauge</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_GPI_90</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span> <span class="n">i_xVlvOpn</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">i_xExtIlkOK</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_PMF_100</span><span class="p">(</span><span class="n">i_stBPGauge</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_GPI_100</span><span class="o">.</span><span class="n">PG</span><span class="p">,</span> <span class="n">i_xVlvOpn</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">i_xExtIlkOK</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">);</span>
<span class="n">fb_AT1K0_GAS_PMF_110</span><span class="p">(</span><span class="n">i_xExtIlkOK</span><span class="o">:=</span> <span class="n">TRUE</span> <span class="p">(</span><span class="o">*</span><span class="n">Interlock</span> <span class="n">Timer</span> <span class="n">on</span> <span class="n">the</span> <span class="n">Rough</span> <span class="n">Valve</span><span class="o">*</span><span class="p">)</span> <span class="p">,</span> <span class="n">stPump</span><span class="o">=&gt;</span> <span class="p">);</span>
<span class="n">fb_AT1K0_GAS_PMF_120</span><span class="p">(</span><span class="n">i_xExtIlkOK</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">(</span><span class="o">*</span><span class="n">Interlock</span> <span class="n">Timer</span> <span class="n">on</span> <span class="n">the</span> <span class="n">Rough</span> <span class="n">Valve</span><span class="o">*</span><span class="p">),</span> <span class="n">stPump</span><span class="o">=&gt;</span> <span class="p">);</span>
<span class="n">fb_AT1K0_GAS_PMF_140</span><span class="p">(</span><span class="n">i_xExtIlkOK</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">(</span><span class="o">*</span><span class="n">Interlock</span> <span class="n">Timer</span> <span class="n">on</span> <span class="n">the</span> <span class="n">Rough</span> <span class="n">Valve</span><span class="o">*</span><span class="p">),</span> <span class="n">stPump</span><span class="o">=&gt;</span> <span class="p">);</span>
<span class="k">if</span><span class="p">(</span> <span class="n">fb_AT1K0_GAS_PMF_110</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpSTARTING</span> <span class="p">)</span> <span class="n">OR</span> <span class="p">(</span> <span class="n">fb_AT1K0_GAS_PMF_110</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span> <span class="p">)</span> <span class="n">THEN</span> <span class="n">fb_AT1K0_GAS_VVC_110</span><span class="o">.</span><span class="n">M_Open</span><span class="p">(</span><span class="n">TRUE</span><span class="p">);</span> <span class="n">END_IF</span>
<span class="k">if</span><span class="p">(</span> <span class="n">fb_AT1K0_GAS_PMF_120</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpSTARTING</span> <span class="p">)</span> <span class="n">OR</span> <span class="p">(</span> <span class="n">fb_AT1K0_GAS_PMF_120</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span> <span class="p">)</span> <span class="n">THEN</span> <span class="n">fb_AT1K0_GAS_VVC_120</span><span class="o">.</span><span class="n">M_Open</span><span class="p">(</span><span class="n">TRUE</span><span class="p">);</span> <span class="n">END_IF</span>
<span class="k">if</span><span class="p">(</span> <span class="n">fb_AT1K0_GAS_PMF_140</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpSTARTING</span> <span class="p">)</span> <span class="n">OR</span> <span class="p">(</span> <span class="n">fb_AT1K0_GAS_PMF_140</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span> <span class="p">)</span> <span class="n">THEN</span> <span class="n">fb_AT1K0_GAS_VVC_140</span><span class="o">.</span><span class="n">M_Open</span><span class="p">(</span><span class="n">TRUE</span><span class="p">);</span> <span class="n">END_IF</span>
<span class="n">fb_AT1K0_GAS_VVC_110</span><span class="p">(</span><span class="n">i_xExtILK_OK</span><span class="o">:=</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_PMF_110</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span>  <span class="n">OR</span>  <span class="n">fb_AT1K0_GAS_PMF_110</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpSTARTING</span> <span class="p">),</span> <span class="n">i_xOverrideMode</span><span class="o">:=</span> <span class="p">,</span> <span class="n">iq_stValve</span><span class="o">=&gt;</span> <span class="p">);</span>
<span class="n">fb_AT1K0_GAS_VVC_120</span><span class="p">(</span><span class="n">i_xExtILK_OK</span><span class="o">:=</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_PMF_120</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span>  <span class="n">OR</span>  <span class="n">fb_AT1K0_GAS_PMF_120</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpSTARTING</span> <span class="p">),</span> <span class="n">i_xOverrideMode</span><span class="o">:=</span> <span class="p">,</span> <span class="n">iq_stValve</span><span class="o">=&gt;</span> <span class="p">);</span>
<span class="n">fb_AT1K0_GAS_VVC_140</span><span class="p">(</span><span class="n">i_xExtILK_OK</span><span class="o">:=</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_PMF_140</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span>  <span class="n">OR</span>  <span class="n">fb_AT1K0_GAS_PMF_140</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpSTARTING</span> <span class="p">),</span> <span class="n">i_xOverrideMode</span><span class="o">:=</span> <span class="p">,</span> <span class="n">iq_stValve</span><span class="o">=&gt;</span> <span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#gvl-devices">GVL_Devices</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-ilk">
<h2>PRG_ILK<a class="headerlink" href="#prg-ilk" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_ILK</span>
<span class="n">VAR</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span><span class="n">Evaluate</span> <span class="n">Global</span> <span class="n">Interlocks</span><span class="o">*</span><span class="p">)</span>

<span class="n">US_Roughing_Valves_Open</span> <span class="o">:=</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_VRC_50</span><span class="o">.</span><span class="n">M_IsOpen</span><span class="p">()</span> <span class="n">AND</span> <span class="n">fb_AT1K0_GAS_VRC_60</span><span class="o">.</span><span class="n">M_IsOpen</span><span class="p">());</span>
<span class="n">DS_Roughing_Valves_Open</span> <span class="o">:=</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_VRC_90</span><span class="o">.</span><span class="n">M_IsOpen</span><span class="p">()</span> <span class="n">AND</span><span class="p">(</span> <span class="n">fb_AT1K0_GAS_PMF_90</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">))</span> <span class="n">OR</span>   <span class="p">(</span><span class="n">fb_AT1K0_GAS_VRC_100</span><span class="o">.</span><span class="n">iq_stValve</span><span class="o">.</span><span class="n">i_xOpnLS</span> <span class="n">AND</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_PMF_100</span><span class="o">.</span><span class="n">stPump</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span> <span class="p">));</span>
<span class="n">US_Turbo_Valves_Open</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_VRC_10</span><span class="o">.</span><span class="n">M_IsOpen</span><span class="p">()</span> <span class="n">AND</span>  <span class="n">fb_AT1K0_GAS_VRC_20</span><span class="o">.</span><span class="n">M_IsOpen</span><span class="p">()</span> <span class="n">AND</span> <span class="n">fb_AT1K0_GAS_VRC_30</span><span class="o">.</span><span class="n">M_IsOpen</span><span class="p">()</span> <span class="n">AND</span> <span class="n">fb_AT1K0_GAS_VRC_40</span><span class="o">.</span><span class="n">M_IsOpen</span><span class="p">();</span>
<span class="n">DS_Turbo_Valves_Open</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_VRC_110</span><span class="o">.</span><span class="n">M_IsOpen</span><span class="p">()</span> <span class="n">AND</span>  <span class="n">fb_AT1K0_GAS_VRC_120</span><span class="o">.</span><span class="n">M_IsOpen</span><span class="p">()</span> <span class="n">AND</span> <span class="n">fb_AT1K0_GAS_VRC_130</span><span class="o">.</span><span class="n">M_IsOpen</span><span class="p">()</span><span class="n">AND</span> <span class="n">fb_AT1K0_GAS_VRC_140</span><span class="o">.</span><span class="n">M_IsOpen</span><span class="p">();</span>
<span class="n">US_Turbo_Running</span> <span class="o">:=</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_10</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_20</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_30</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_40</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">);</span>
<span class="n">DS_Turbo_Running</span> <span class="o">:=</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_110</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_120</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_130</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_140</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">);</span>

<span class="p">(</span><span class="o">*</span> <span class="n">Link</span> <span class="n">The</span> <span class="n">correct</span> <span class="n">override</span> <span class="n">bit</span> <span class="n">to</span> <span class="n">the</span> <span class="n">correct</span> <span class="n">vacuum</span> <span class="n">section</span><span class="o">*</span><span class="p">)</span>



<span class="p">(</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">MPS</span> <span class="n">FF</span><span class="o">*</span><span class="p">)</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
</section>
<section id="prg-inj">
<h2>PRG_INJ<a class="headerlink" href="#prg-inj" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_INJ</span>
<span class="n">VAR</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:CNTRL:SP;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">HOPR</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">LOPR</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">PREC</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">EGU</span> <span class="s2">&quot;TORR&quot;</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">fSetpointValue</span> <span class="p">:</span><span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:CNTRL:ON;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">STOP</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">START</span><span class="p">;</span>
     <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">bGo</span><span class="p">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:CNTRL:RESET;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
     <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
     <span class="s1">&#39;}</span>
    <span class="n">bReset</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:CNTRL:ERROR;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="n">TRUE</span><span class="p">;</span>
     <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
     <span class="s1">&#39;}</span>
    <span class="n">bError</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">different</span> <span class="n">gains</span> <span class="k">for</span> <span class="n">different</span> <span class="n">apertures</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:CNTRL:Kp1 &#39;</span><span class="p">}</span>
    <span class="n">fKp1</span> <span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span> <span class="mf">0.4</span><span class="p">;</span><span class="o">//</span><span class="mf">0.7</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:CNTRL:Kp2 &#39;</span><span class="p">}</span>
    <span class="n">fKp2</span> <span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span> <span class="mf">0.7</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:CNTRL:Kp3 &#39;</span><span class="p">}</span>
    <span class="n">fKp3</span> <span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:CNTRL:Kp4 &#39;</span><span class="p">}</span>
    <span class="n">fKp4</span> <span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:CNTRL:Tn1 &#39;</span><span class="p">}</span>
    <span class="n">fTn1</span> <span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:CNTRL:Tn2 &#39;</span><span class="p">}</span>
    <span class="n">fTn2</span> <span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="n">arrTable</span>        <span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1..15</span><span class="p">,</span><span class="mf">1..2</span><span class="p">]</span> <span class="n">OF</span> <span class="n">FLOAT</span><span class="p">;</span>
    <span class="n">arrTableAprt1</span>   <span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1..15</span><span class="p">,</span><span class="mf">1..2</span><span class="p">]</span> <span class="n">OF</span> <span class="n">FLOAT</span><span class="p">;</span>
    <span class="n">arrTableAprt2</span>   <span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1..15</span><span class="p">,</span><span class="mf">1..2</span><span class="p">]</span> <span class="n">OF</span> <span class="n">FLOAT</span><span class="p">;</span>
    <span class="n">arrTableAprt3</span>   <span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1..15</span><span class="p">,</span><span class="mf">1..2</span><span class="p">]</span> <span class="n">OF</span> <span class="n">FLOAT</span><span class="p">;</span>
    <span class="n">arrTableAprt4</span>   <span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1..15</span><span class="p">,</span><span class="mf">1..2</span><span class="p">]</span> <span class="n">OF</span> <span class="n">FLOAT</span><span class="p">;</span>
    <span class="n">fManValue</span>                                                                                       <span class="p">:</span> <span class="n">FLOAT</span><span class="p">;</span>
    <span class="n">bExtrapolate</span>                                                                            <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">eMode</span>                                                   <span class="p">:</span> <span class="n">E_CTRL_MODE</span><span class="p">;</span>
    <span class="n">stCTRL_PID_PARAMS</span>               <span class="p">:</span> <span class="n">ST_CTRL_PID_PARAMS</span><span class="p">;</span>
    <span class="n">bSync</span>                                                   <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bHold</span>                                                   <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">eErrorId</span>                                                <span class="p">:</span> <span class="n">E_CTRL_ERRORCODES</span><span class="p">;</span>
    <span class="n">bARWactive</span>                                      <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">(</span><span class="o">*</span> <span class="n">controller</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">fbCTRL_PID</span>                                      <span class="p">:</span> <span class="n">FB_CTRL_PID</span><span class="p">;</span>
    <span class="n">bInit</span>                                                   <span class="p">:</span> <span class="n">BOOL</span>  <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbCTRL_LIN_INTERPOLATION</span>                                        <span class="p">:</span> <span class="n">FB_CTRL_LIN_INTERPOLATION</span><span class="p">;</span>
    <span class="o">//</span><span class="n">stCTRL_LIN_INTERPOLATION_PARAMS</span>               <span class="p">:</span> <span class="n">ST_CTRL_LIN_INTERPOLATION_PARAMS</span><span class="p">;</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS</span> <span class="p">:</span> <span class="n">ST_CTRL_LIN_INTERPOLATION_PARAMS</span><span class="p">;</span>
    <span class="n">fbCTRL_DEADBAND</span>                                         <span class="p">:</span> <span class="n">FB_CTRL_DEADBAND</span><span class="p">;</span>
    <span class="n">stCTRL_DEADBAND_PARAMS</span>                  <span class="p">:</span> <span class="n">ST_CTRL_DEADBAND_PARAMS</span><span class="p">;</span>

    <span class="n">pid_on</span> <span class="p">:</span><span class="n">TON</span><span class="p">;</span>
    <span class="n">wait</span> <span class="p">:</span> <span class="n">time</span> <span class="o">:=</span> <span class="n">T</span><span class="c1">#10S;</span>
    <span class="n">FTrig</span><span class="p">:</span> <span class="n">F_TRIG</span><span class="p">;</span>
    <span class="n">fTrig_PMPS</span><span class="p">:</span> <span class="n">F_TRIG</span><span class="p">;</span>
    <span class="n">rTrig_PMPS</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>

    <span class="n">rtAction</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">rtTrans</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>

    <span class="n">rLimit1</span> <span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span> <span class="mi">78</span><span class="p">;</span>
    <span class="n">rLimit2</span> <span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span> <span class="mi">78</span><span class="p">;</span>
    <span class="n">rLimit3</span> <span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span> <span class="mi">78</span><span class="p">;</span>
    <span class="n">rLimit4</span> <span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span> <span class="mi">62</span><span class="p">;</span>
    <span class="n">rLimit</span><span class="p">:</span><span class="n">REAL</span><span class="o">:=</span><span class="mi">78</span><span class="p">;</span>
    <span class="n">rDelta</span><span class="p">:</span><span class="n">REAL</span><span class="o">:=</span><span class="mi">5</span><span class="p">;</span>

    <span class="n">tSettle</span><span class="p">:</span> <span class="n">TON</span><span class="p">;</span>
    <span class="n">tSettleTime</span><span class="p">:</span> <span class="n">Time</span> <span class="o">:=</span> <span class="n">T</span><span class="c1">#5S;</span>

    <span class="n">tExceed</span><span class="p">:</span> <span class="n">TON</span><span class="p">;</span>
    <span class="n">tExceedTime</span><span class="p">:</span> <span class="n">Time</span> <span class="o">:=</span> <span class="n">T</span><span class="c1">#500mS;</span>

    <span class="n">tMoving</span><span class="p">:</span> <span class="n">TON</span><span class="p">;</span>
    <span class="n">tMovingTime</span><span class="p">:</span> <span class="n">Time</span> <span class="o">:=</span> <span class="n">T</span><span class="c1">#1S;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:CNTRL:TransPerc &#39;</span><span class="p">}</span>
    <span class="n">rTransPerc</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span><span class="s1">&#39; pv: AT1K0:GAS:CNTRL:PressPerc &#39;</span><span class="p">}</span>
    <span class="n">rPressPerc</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="n">rPressThresholdHigh</span> <span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span><span class="mf">2.455e-1</span><span class="p">;</span>
    <span class="n">rPressThresholdLow</span> <span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span><span class="mf">7.733e-2</span><span class="p">;</span>
    <span class="n">iGauge</span><span class="p">:</span><span class="n">INT</span><span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
    <span class="o">//</span><span class="n">FFO</span>
        <span class="n">TRANS_FFO</span>    <span class="p">:</span>    <span class="n">FB_FastFault</span> <span class="o">:=</span><span class="p">(</span>
        <span class="n">i_DevName</span> <span class="o">:=</span> <span class="s1">&#39;AT1K0-GAS&#39;</span><span class="p">,</span>
        <span class="n">i_Desc</span> <span class="o">:=</span> <span class="s1">&#39;Fault occurs when the current transmission exceeds the requested transmission by 20%&#39;</span><span class="p">,</span>
        <span class="n">i_TypeCode</span> <span class="o">:=</span> <span class="mi">16</span><span class="c1">#AFF);</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span> <span class="n">The</span> <span class="n">gas</span> <span class="n">injection</span> <span class="n">conrol</span> <span class="n">loop</span> <span class="ow">is</span> <span class="n">augmented</span> <span class="k">with</span> <span class="n">a</span> <span class="n">feed</span> <span class="n">forward</span> <span class="n">table</span><span class="p">,</span> <span class="n">where</span> <span class="n">FF</span> <span class="n">provide</span> <span class="n">the</span> <span class="n">major</span> <span class="n">portion</span> <span class="n">of</span> <span class="n">the</span>
 <span class="n">controller</span> <span class="n">output</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">PI</span><span class="p">(</span><span class="n">D</span><span class="p">)</span> <span class="n">controller</span> <span class="n">conpensate</span> <span class="k">for</span> <span class="n">the</span> <span class="n">remaining</span> <span class="n">error</span><span class="o">.*</span><span class="p">)</span>

<span class="o">//</span><span class="n">Devices</span> <span class="ow">and</span> <span class="n">Interlock</span>
<span class="o">//</span> <span class="n">Valves</span>
<span class="n">VCN_70</span><span class="p">(</span><span class="n">i_xExtIlkOK</span> <span class="o">:=</span> <span class="p">(</span><span class="n">US_MAA_OK</span> <span class="n">AND</span> <span class="n">US_Turbo_Valves_Open</span> <span class="n">AND</span> <span class="n">US_Turbo_Running</span><span class="p">)</span>
                        <span class="n">AND</span> <span class="p">(</span><span class="n">DS_MAA_OK</span> <span class="n">AND</span> <span class="n">DS_Turbo_Valves_Open</span> <span class="n">AND</span> <span class="n">DS_Turbo_Running</span><span class="p">),</span>
                        <span class="n">i_ReqPos</span><span class="o">:=</span><span class="p">);</span>

<span class="n">VVC_71</span><span class="p">(</span><span class="n">i_xExtILK_OK</span><span class="o">:=</span> <span class="n">VVC_72</span><span class="o">.</span><span class="n">M_IsClosed</span><span class="p">()</span> <span class="n">AND</span> <span class="p">(((</span><span class="o">*</span><span class="n">US_MAA_OK</span> <span class="n">AND</span><span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">US_Roughing_Valves_Open</span> <span class="n">AND</span><span class="o">*</span><span class="p">)</span> <span class="n">US_Turbo_Valves_Open</span> <span class="n">AND</span> <span class="n">US_Turbo_Running</span><span class="p">)</span>
                        <span class="n">AND</span> <span class="p">((</span><span class="o">*</span><span class="n">DS_MAA_OK</span> <span class="n">AND</span> <span class="o">*</span><span class="p">)(</span><span class="o">*</span><span class="n">DS_Roughing_Valves_Open</span> <span class="n">AND</span><span class="o">*</span><span class="p">)</span> <span class="n">DS_Turbo_Valves_Open</span> <span class="n">AND</span> <span class="n">DS_Turbo_Running</span><span class="p">)),</span> <span class="n">i_xOverrideMode</span><span class="o">:=</span> <span class="p">,</span> <span class="n">iq_stValve</span><span class="o">=&gt;</span> <span class="p">);</span>
<span class="n">VVC_72</span><span class="p">(</span><span class="n">i_xExtILK_OK</span><span class="o">:=</span> <span class="n">VVC_71</span><span class="o">.</span><span class="n">M_IsClosed</span><span class="p">()</span> <span class="n">AND</span> <span class="p">(((</span><span class="o">*</span><span class="n">US_MAA_OK</span> <span class="n">AND</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">US_Roughing_Valves_Open</span> <span class="n">AND</span> <span class="o">*</span><span class="p">)</span><span class="n">US_Turbo_Valves_Open</span> <span class="n">AND</span> <span class="n">US_Turbo_Running</span><span class="p">)</span>
                        <span class="n">AND</span> <span class="p">((</span><span class="o">*</span><span class="n">DS_MAA_OK</span> <span class="n">AND</span> <span class="o">*</span><span class="p">)(</span><span class="o">*</span><span class="n">DS_Roughing_Valves_Open</span> <span class="n">AND</span> <span class="o">*</span><span class="p">)</span><span class="n">DS_Turbo_Valves_Open</span> <span class="n">AND</span> <span class="n">DS_Turbo_Running</span><span class="p">)),</span> <span class="n">i_xOverrideMode</span><span class="o">:=</span> <span class="p">,</span> <span class="n">iq_stValve</span><span class="o">=&gt;</span> <span class="p">);</span>

<span class="o">//</span><span class="n">Gauges</span>
<span class="n">GCM_70</span><span class="o">.</span><span class="n">M_SetBits</span><span class="p">(</span><span class="mi">30518</span><span class="p">);</span>
<span class="n">GCM_80</span><span class="o">.</span><span class="n">M_SetBits</span><span class="p">(</span><span class="mi">30518</span><span class="p">);</span>
<span class="n">GCM_81</span><span class="o">.</span><span class="n">M_SetBits</span><span class="p">(</span><span class="mi">30518</span><span class="p">);</span>
<span class="n">GCM_70</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span> <span class="p">,</span> <span class="n">i_rFULL_SCALE</span><span class="o">:=</span> <span class="mi">2000</span><span class="p">);</span>
<span class="n">GCM_80</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span> <span class="p">,</span> <span class="n">i_rFULL_SCALE</span><span class="o">:=</span> <span class="mi">20</span><span class="p">);</span>
<span class="n">GCM_81</span><span class="p">(</span><span class="n">PG</span><span class="o">=&gt;</span> <span class="p">,</span> <span class="n">i_rFULL_SCALE</span><span class="o">:=</span> <span class="mf">0.25</span><span class="p">);</span>

<span class="p">(</span><span class="o">*</span> <span class="n">Gauge</span> <span class="n">selection</span> <span class="o">*</span><span class="p">)</span>
<span class="p">(</span><span class="o">*</span><span class="n">Assign</span> <span class="n">reading</span> <span class="n">to</span> <span class="n">psuedo</span> <span class="n">gauge</span><span class="o">*</span><span class="p">)</span>
<span class="p">(</span><span class="o">*</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">fSetpointValue</span> <span class="o">&lt;=</span> <span class="mf">0.0001</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_GCC_80</span><span class="o">.</span><span class="n">IG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="n">THEN</span> <span class="n">GCM_82</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_GCC_80</span><span class="o">.</span><span class="n">IG</span><span class="p">;</span>
    <span class="n">ELSIF</span> <span class="p">(</span><span class="n">fSetpointValue</span> <span class="o">&lt;</span> <span class="mf">0.0029</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_GPI_80</span><span class="o">.</span><span class="n">PG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&gt;</span> <span class="mf">0.0001</span><span class="p">)</span> <span class="n">THEN</span> <span class="n">GCM_82</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_GPI_80</span><span class="o">.</span><span class="n">PG</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="p">(</span> <span class="n">GCM_81</span><span class="o">.</span><span class="n">PG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&lt;</span> <span class="mf">0.25</span> <span class="p">)</span> <span class="n">THEN</span> <span class="n">GCM_82</span> <span class="o">:=</span> <span class="n">GCM_81</span><span class="o">.</span><span class="n">PG</span><span class="p">;</span>
            <span class="n">ElSE</span> <span class="n">GCM_82</span> <span class="o">:=</span> <span class="n">GCM_80</span><span class="o">.</span><span class="n">PG</span><span class="p">;</span>
<span class="n">END_IF</span><span class="o">*</span><span class="p">)</span>
<span class="p">(</span><span class="o">*</span> <span class="n">MG</span><span class="p">:</span> <span class="n">removed</span> <span class="n">August</span> <span class="n">shutdown</span> <span class="mi">2021</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_GCC_80</span><span class="o">.</span><span class="n">IG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&lt;=</span><span class="mf">0.0009</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_GCC_80</span><span class="o">.</span><span class="n">IG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="n">THEN</span> <span class="n">GCM_82</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_GCC_80</span><span class="o">.</span><span class="n">IG</span><span class="p">;</span>
    <span class="n">ELSIF</span> <span class="p">(</span> <span class="n">GCM_81</span><span class="o">.</span><span class="n">PG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&lt;</span> <span class="mf">0.25</span> <span class="p">)</span> <span class="n">THEN</span> <span class="n">GCM_82</span> <span class="o">:=</span> <span class="n">GCM_81</span><span class="o">.</span><span class="n">PG</span><span class="p">;</span>
            <span class="n">ElSE</span> <span class="n">GCM_82</span> <span class="o">:=</span> <span class="n">GCM_80</span><span class="o">.</span><span class="n">PG</span><span class="p">;</span>
<span class="n">END_IF</span><span class="o">*</span><span class="p">)</span>

<span class="o">//</span><span class="n">MG</span><span class="p">:</span> <span class="n">Added</span> <span class="n">to</span> <span class="n">avoid</span> <span class="n">sudden</span> <span class="n">switching</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_GCC_80</span><span class="o">.</span><span class="n">IG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&lt;=</span><span class="mf">0.0009</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_GCC_80</span><span class="o">.</span><span class="n">IG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="n">THEN</span> <span class="n">iGauge</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span><span class="o">//</span><span class="n">GCM_82</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_GCC_80</span><span class="o">.</span><span class="n">IG</span><span class="p">;</span>
    <span class="n">ELSIF</span> <span class="p">(</span><span class="n">GCM_80</span><span class="o">.</span><span class="n">PG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&lt;=</span> <span class="n">rPressThresholdLow</span> <span class="p">)</span> <span class="n">THEN</span> <span class="n">iGauge</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span><span class="o">//</span><span class="n">GCM_82</span> <span class="o">:=</span> <span class="n">GCM_81</span><span class="o">.</span><span class="n">PG</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="p">(</span><span class="n">GCM_81</span><span class="o">.</span><span class="n">PG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&gt;=</span> <span class="n">rPressThresholdHigh</span> <span class="p">)</span> <span class="n">THEN</span> <span class="n">iGauge</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">;</span><span class="o">//</span><span class="n">GCM_82</span> <span class="o">:=</span> <span class="n">GCM_80</span><span class="o">.</span><span class="n">PG</span><span class="p">;</span>
            <span class="o">//</span><span class="n">ElSIF</span> <span class="p">(</span><span class="n">GCM_82</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">=</span> <span class="n">fb_AT1K0_GAS_GCC_80</span><span class="o">.</span><span class="n">IG</span><span class="o">.</span><span class="n">rPRESS</span><span class="p">)</span> <span class="n">THEN</span> <span class="n">iGauge</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span><span class="o">//</span><span class="n">GCM_82</span> <span class="o">:=</span> <span class="n">GCM_81</span><span class="o">.</span><span class="n">PG</span> <span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">CASE</span> <span class="n">iGauge</span> <span class="n">OF</span>
    <span class="mi">0</span><span class="p">:</span> <span class="n">GCM_82</span> <span class="o">:=</span> <span class="n">fb_AT1K0_GAS_GCC_80</span><span class="o">.</span><span class="n">IG</span><span class="p">;</span>
    <span class="mi">1</span><span class="p">:</span> <span class="n">GCM_82</span> <span class="o">:=</span> <span class="n">GCM_81</span><span class="o">.</span><span class="n">PG</span> <span class="p">;</span>
    <span class="mi">2</span><span class="p">:</span> <span class="n">GCM_82</span> <span class="o">:=</span> <span class="n">GCM_80</span><span class="o">.</span><span class="n">PG</span><span class="p">;</span>
    <span class="n">ELSE</span> <span class="n">GCM_82</span> <span class="o">:=</span> <span class="n">GCM_80</span><span class="o">.</span><span class="n">PG</span><span class="p">;</span>
<span class="n">END_CASE</span>



<span class="p">(</span><span class="o">*</span><span class="n">Automation</span> <span class="n">of</span> <span class="n">other</span> <span class="n">devices</span><span class="o">*</span><span class="p">)</span>
<span class="p">(</span><span class="o">*</span><span class="n">When</span> <span class="n">to</span> <span class="n">Open</span> <span class="n">the</span> <span class="n">VRC</span> <span class="n">Valves</span> <span class="n">to</span> <span class="n">the</span> <span class="n">MAA</span> <span class="n">chambers</span><span class="o">*</span><span class="p">)</span>
<span class="p">(</span><span class="o">*</span><span class="n">When</span> <span class="n">PID</span> <span class="ow">is</span> <span class="n">ON</span><span class="o">*</span><span class="p">)</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">bGo</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="p">(</span><span class="o">*</span><span class="n">VRC</span> <span class="n">US</span><span class="o">*</span><span class="p">)</span>
    <span class="n">IF</span> <span class="p">(</span> <span class="n">fb_AT1K0_GAS_GPI_40</span><span class="o">.</span><span class="n">PG</span> <span class="o">.</span><span class="n">rPRESS</span> <span class="o">&gt;=</span> <span class="n">rVRC_US_SP</span> <span class="p">)</span> <span class="n">THEN</span>
        <span class="n">IF</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_VRC_50</span><span class="o">.</span><span class="n">M_IsOpen</span><span class="p">())</span> <span class="n">THEN</span> <span class="n">fb_AT1K0_GAS_VRC_60</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span> <span class="p">(</span><span class="n">TRUE</span><span class="p">);</span>
            <span class="n">ELSE</span> <span class="n">fb_AT1K0_GAS_VRC_50</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span> <span class="p">(</span><span class="n">TRUE</span><span class="p">);</span>
        <span class="n">END_IF</span>
    <span class="n">END_IF</span>

    <span class="p">(</span><span class="o">*</span><span class="n">VRC</span> <span class="n">DS</span><span class="o">*</span><span class="p">)</span>
    <span class="n">IF</span> <span class="p">(</span> <span class="n">fb_AT1K0_GAS_GPI_110</span><span class="o">.</span><span class="n">PG</span> <span class="o">.</span><span class="n">rPRESS</span> <span class="o">&gt;=</span> <span class="n">rVRC_DS_SP</span> <span class="p">)</span> <span class="n">THEN</span>
        <span class="n">IF</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_VRC_100</span><span class="o">.</span><span class="n">M_IsOpen</span><span class="p">())</span> <span class="n">THEN</span> <span class="n">fb_AT1K0_GAS_VRC_90</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span> <span class="p">(</span><span class="n">TRUE</span><span class="p">);</span>
            <span class="n">ELSE</span> <span class="n">fb_AT1K0_GAS_VRC_100</span><span class="o">.</span><span class="n">M_Set_OPN_SW</span> <span class="p">(</span><span class="n">TRUE</span><span class="p">);</span>
        <span class="n">END_IF</span>
    <span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="o">//</span><span class="n">Try</span> <span class="n">to</span> <span class="n">switch</span> <span class="n">on</span> <span class="n">the</span> <span class="n">GCC</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">Gas</span> <span class="n">cell</span> <span class="k">for</span> <span class="n">accurate</span> <span class="n">transmission</span> <span class="n">calculation</span>
<span class="n">IF</span>  <span class="n">NOT</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_GCC_80</span><span class="o">.</span><span class="n">IG</span><span class="o">.</span><span class="n">i_xHV_ON</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_GPI_80</span><span class="o">.</span><span class="n">PG</span><span class="o">.</span><span class="n">rPRESS</span> <span class="o">&lt;=</span> <span class="mf">1.1E-4</span><span class="p">)</span> <span class="n">THEN</span> <span class="n">fb_AT1K0_GAS_GCC_80</span><span class="o">.</span><span class="n">M_HVE</span><span class="p">(</span><span class="n">TRUE</span><span class="p">);</span> <span class="n">END_IF</span><span class="p">;</span>

<span class="p">(</span><span class="o">*</span> <span class="n">On</span> <span class="n">change</span> <span class="n">transmission</span> <span class="n">reset</span> <span class="o">*</span><span class="p">)</span>
<span class="n">rtNewTrans</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span>  <span class="p">(</span><span class="n">OldTransmissionValue</span> <span class="o">&lt;&gt;</span> <span class="n">TransmissionValue</span><span class="p">)</span> <span class="n">OR</span> <span class="p">(</span><span class="n">fTrig_PMPS</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">OR</span> <span class="p">(</span><span class="n">rTrig_PMPS</span><span class="o">.</span><span class="n">Q</span><span class="p">));</span>
<span class="n">IF</span><span class="p">(</span><span class="n">rtNewTrans</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">OldTransmissionValue</span> <span class="o">:=</span> <span class="n">TransmissionValue</span><span class="p">;</span>
    <span class="n">bChangeAperture</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bChangeGas</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;AT1K0 new transmission request.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Info</span><span class="p">);</span>
    <span class="n">IF</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">tSettle</span><span class="o">.</span><span class="n">IN</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="n">stStatus</span><span class="o">.</span><span class="n">AtTarget</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">END_IF</span>
    <span class="n">stStatus</span><span class="o">.</span><span class="n">Moving</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="o">//</span> <span class="n">change</span> <span class="n">setpoint</span>
<span class="o">//</span> <span class="n">As</span> <span class="n">calculated</span> <span class="n">by</span> <span class="n">the</span> <span class="n">PRG_INJ</span>
<span class="n">IF</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">xPressureControlMode</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">fSetpointValue</span> <span class="o">:=</span> <span class="n">rRequiredPressureSP</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="p">(</span><span class="o">*</span><span class="n">Setpoint</span> <span class="n">Validation</span><span class="o">*</span><span class="p">)</span>
<span class="n">fSetpointValue</span><span class="o">:=</span> <span class="n">LIMIT</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">fSetpointValue</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>


<span class="n">ACT_init</span><span class="p">();</span>
<span class="n">ACT_Cntrl</span><span class="p">();</span>
<span class="n">ACT_Logger</span><span class="p">();</span>
<span class="n">ACT_FFO</span><span class="p">();</span>
<span class="n">ACT_STATE</span><span class="p">();</span>

<span class="n">END_PROGRAM</span>

<span class="n">ACTION</span> <span class="n">ACT_Cntrl</span><span class="p">:</span>
<span class="o">//</span> <span class="n">Turn</span> <span class="n">the</span> <span class="n">PID</span> <span class="n">on</span> <span class="n">rising</span> <span class="n">edge</span> <span class="n">of</span> <span class="n">the</span> <span class="n">PMPSMode</span> <span class="ow">and</span> <span class="n">off</span> <span class="n">at</span> <span class="n">falling</span> <span class="n">edge</span>
<span class="n">fTrig_PMPS</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span> <span class="n">xPMPSMode</span><span class="p">);</span>
<span class="n">rTrig_PMPS</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span> <span class="n">xPMPSMode</span><span class="p">);</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">xPMPSMode</span><span class="p">)</span> <span class="n">THEN</span> <span class="n">bGo</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="n">xPressureControlMode</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span> <span class="n">END_IF</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">fTrig_PMPS</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>
     <span class="n">bGo</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">bChangeAperture</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
     <span class="n">bChangeGas</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
     <span class="n">rTransmissionSP</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="o">//</span><span class="n">IF</span> <span class="p">(</span><span class="n">rTrig_PMPS</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span> <span class="n">bGo</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="n">END_IF</span>

<span class="k">if</span> <span class="p">(</span><span class="n">bGo</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="o">//</span><span class="n">VCN_70</span><span class="o">.</span><span class="n">i_ReqPos</span><span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">(</span><span class="n">fbCTRL_LIN_INTERPOLATION</span><span class="o">.</span><span class="n">fOut</span> <span class="o">+</span> <span class="n">fbCTRL_PID</span><span class="o">.</span><span class="n">fOut</span><span class="p">);</span>
    <span class="n">VCN_70</span><span class="o">.</span><span class="n">i_ReqPos</span><span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">(</span><span class="n">fbCTRL_LIN_INTERPOLATION</span><span class="o">.</span><span class="n">fOut</span> <span class="o">+</span> <span class="n">fbCTRL_PID</span><span class="o">.</span><span class="n">fOut</span><span class="p">);</span>
    <span class="n">IF</span> <span class="p">(</span><span class="n">bReset</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="p">(</span><span class="o">*</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">mode</span> <span class="n">to</span> <span class="n">RESET</span><span class="o">*</span><span class="p">)</span>
    <span class="n">eMode</span>                                                   <span class="o">:=</span> <span class="n">eCTRL_MODE_RESET</span>   <span class="p">;</span>
    <span class="n">VCN_70</span><span class="o">.</span><span class="n">M_ValveControl</span><span class="p">(</span><span class="n">CloseValve</span><span class="p">);</span>
    <span class="o">//</span><span class="n">bReset</span> <span class="o">:=</span> <span class="kc">False</span><span class="p">;</span>
    <span class="n">ELSE</span>
        <span class="p">(</span><span class="o">*</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">mode</span> <span class="n">to</span> <span class="n">ACTIVE</span> <span class="o">--&gt;</span> <span class="n">normal</span> <span class="n">operation</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">eMode</span>                                                   <span class="o">:=</span> <span class="n">eCTRL_MODE_ACTIVE</span>   <span class="p">;</span>
     <span class="n">VCN_70</span><span class="o">.</span><span class="n">M_ValveControl</span><span class="p">(</span><span class="n">PressureControl</span><span class="p">);</span>
    <span class="n">END_IF</span>
<span class="n">END_IF</span>
<span class="n">FTRIG</span><span class="p">(</span><span class="n">CLK</span> <span class="o">:=</span> <span class="n">bGo</span><span class="p">);</span>
<span class="n">IF</span><span class="p">(</span><span class="n">FTrig</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span><span class="n">THEN</span>
        <span class="n">eMode</span>                                                       <span class="o">:=</span> <span class="n">eCTRL_MODE_PASSIVE</span><span class="p">;</span>
        <span class="n">VCN_70</span><span class="o">.</span><span class="n">M_ValveControl</span><span class="p">(</span><span class="n">CloseValve</span><span class="p">);</span>
        <span class="n">fSetpointValue</span> <span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="p">(</span><span class="o">*</span><span class="n">Interlock</span> <span class="n">setpoint</span> <span class="n">reset</span><span class="o">*</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">VVC_71</span><span class="o">.</span><span class="n">M_IsClosed</span><span class="p">()</span> <span class="n">AND</span> <span class="n">VVC_72</span><span class="o">.</span><span class="n">M_IsClosed</span><span class="p">()</span> <span class="p">)</span> <span class="n">THEN</span>
        <span class="o">//</span><span class="n">eMode</span>     <span class="o">:=</span> <span class="n">eCTRL_MODE_PASSIVE</span><span class="p">;</span>
        <span class="n">fSetpointValue</span> <span class="o">:=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="p">(</span><span class="o">*</span><span class="n">Switch</span> <span class="n">PID</span> <span class="n">Mode</span> <span class="n">to</span> <span class="n">passive</span> <span class="k">if</span> <span class="n">VCN</span> <span class="ow">is</span> <span class="n">interlocked</span><span class="o">*</span><span class="p">)</span>
<span class="n">IF</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">VCN_70</span><span class="o">.</span><span class="n">i_xExtIlkOK</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="n">eMode</span>       <span class="o">:=</span> <span class="n">eCTRL_MODE_PASSIVE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">fbCTRL_LIN_INTERPOLATION</span><span class="p">(</span>
    <span class="n">fIn</span><span class="o">:=</span> <span class="n">fSetpointValue</span> <span class="p">,</span>
    <span class="n">fManValue</span><span class="o">:=</span> <span class="n">fManValue</span> <span class="p">,</span>
    <span class="n">bExtrapolate</span><span class="o">:=</span> <span class="n">bExtrapolate</span><span class="p">,</span>
    <span class="n">eMode</span><span class="o">:=</span> <span class="n">eMode</span><span class="p">,</span>
    <span class="n">stParams</span><span class="o">:=</span> <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS</span><span class="p">,</span>
    <span class="n">fOut</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">bInIsGreaterThanMaxElement</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">bInIsLessThanMinElement</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">eState</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">eErrorId</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">bError</span><span class="o">=&gt;</span> <span class="p">);</span>


<span class="p">(</span><span class="o">*</span> <span class="n">call</span> <span class="n">controller</span> <span class="o">*</span><span class="p">)</span>
<span class="n">fbCTRL_PID</span><span class="p">(</span>         <span class="n">fSetpointValue</span>          <span class="o">:=</span> <span class="n">fSetpointValue</span><span class="p">,</span><span class="o">//</span><span class="n">TransmissionValue</span><span class="p">,</span><span class="o">//</span><span class="n">fSetpointValue</span><span class="p">,</span>
                    <span class="n">fActualValue</span>            <span class="o">:=</span> <span class="n">GCM_82</span><span class="o">.</span><span class="n">rPRESS</span><span class="p">,</span><span class="o">//</span><span class="n">rCalculatedTransmissionValue</span><span class="p">,</span><span class="o">//</span><span class="n">GCM_82</span><span class="o">.</span><span class="n">rPRESS</span> <span class="p">,</span>
                    <span class="n">fManSyncValue</span>   <span class="o">:=</span> <span class="p">,</span>
                    <span class="n">bSync</span>                           <span class="o">:=</span> <span class="n">bSync</span><span class="p">,</span>
                    <span class="n">eMode</span>                           <span class="o">:=</span> <span class="n">eMode</span><span class="p">,</span>
                    <span class="n">bHold</span>                           <span class="o">:=</span> <span class="n">bHold</span><span class="p">,</span>
                    <span class="n">stParams</span>                        <span class="o">:=</span> <span class="n">stCTRL_PID_PARAMS</span><span class="p">,</span>
                    <span class="n">fOut</span>                            <span class="o">=&gt;</span> <span class="p">,</span>
                    <span class="n">bARWactive</span>              <span class="o">=&gt;</span> <span class="n">bARWactive</span><span class="p">,</span>
                    <span class="n">eErrorId</span>                        <span class="o">=&gt;</span> <span class="n">eErrorId</span><span class="p">,</span>
                    <span class="n">bError</span>                          <span class="o">=&gt;</span>
                <span class="p">);</span>


<span class="p">(</span><span class="o">*</span><span class="n">deadband</span><span class="o">/</span><span class="n">clipper</span> <span class="o">*</span><span class="p">)</span>

<span class="p">(</span><span class="o">*</span> <span class="n">call</span> <span class="n">function</span> <span class="n">block</span> <span class="o">*</span><span class="p">)</span>
<span class="n">stCTRL_DEADBAND_PARAMS</span><span class="o">.</span><span class="n">fThreshold</span>   <span class="o">:=</span>  <span class="n">fSetpointValue</span><span class="o">*</span><span class="mf">0.0016</span> <span class="p">;</span>
<span class="p">(</span><span class="o">*</span><span class="n">fbCTRL_DEADBAND</span>   <span class="p">(</span>       <span class="n">fIn</span>                                     <span class="o">:=</span> <span class="p">,</span>
                    <span class="n">stParams</span>                        <span class="o">:=</span> <span class="n">stCTRL_DEADBAND_PARAMS</span><span class="p">,</span>
                    <span class="n">bInIsUnderThreshold</span> <span class="o">=&gt;</span> <span class="p">,</span>
                    <span class="n">eErrorId</span>                        <span class="o">=&gt;</span> <span class="p">,</span>
                    <span class="n">bError</span>                          <span class="o">=&gt;</span>
                <span class="p">);</span><span class="o">*</span><span class="p">)</span>

<span class="n">bError</span> <span class="o">:=</span> <span class="n">fbCTRL_PID</span><span class="o">.</span><span class="n">bError</span> <span class="n">OR</span> <span class="n">fbCTRL_LIN_INTERPOLATION</span><span class="o">.</span><span class="n">bError</span><span class="p">;</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_FFO</span><span class="p">:</span>
<span class="n">TRANS_FFO</span><span class="o">.</span><span class="n">i_xOK</span> <span class="o">:=</span> <span class="p">(</span><span class="n">rCalculatedTransmissionValue</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">TransmissionValue</span> <span class="o">+</span> <span class="p">(</span><span class="n">TransmissionValue</span><span class="o">*</span><span class="mi">20</span><span class="o">/</span><span class="mi">100</span><span class="p">)))</span> <span class="n">OR</span> <span class="n">NOT</span> <span class="n">tExceed</span><span class="o">.</span><span class="n">Q</span><span class="p">;</span>

<span class="o">//</span><span class="n">auto</span> <span class="n">reset</span> <span class="n">true</span>
<span class="p">(</span><span class="o">*</span><span class="n">FAST</span> <span class="n">FAULT</span><span class="o">*</span><span class="p">)</span>
<span class="n">TRANS_FFO</span><span class="p">(</span><span class="n">i_xOK</span> <span class="o">:=</span> <span class="p">,</span><span class="o">//</span><span class="n">NOT</span> <span class="n">tExceed</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span>
    <span class="n">i_xReset</span> <span class="o">:=</span>  <span class="p">,</span>
    <span class="n">i_xAutoReset</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
    <span class="n">io_fbFFHWO</span> <span class="o">:=</span> <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">g_FastFaultOutput1</span><span class="p">);</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Init</span><span class="p">:</span>
<span class="o">//</span><span class="n">control</span> <span class="n">Loop</span> <span class="ow">and</span> <span class="n">FeedForward</span> <span class="n">table</span> <span class="n">initialisation</span>
<span class="p">(</span><span class="o">*</span><span class="n">Iniitialization</span><span class="o">*</span><span class="p">)</span>
<span class="n">IF</span> <span class="n">bInit</span>
<span class="n">THEN</span>
    <span class="p">(</span><span class="o">*</span> <span class="n">Feed</span> <span class="n">forward</span> <span class="n">table</span> <span class="n">records</span> <span class="mi">9</span> <span class="n">disticnt</span> <span class="n">positions</span> <span class="n">of</span> <span class="n">the</span> <span class="n">needle</span> <span class="n">valves</span><span class="p">,</span> <span class="n">breaking</span> <span class="n">the</span> <span class="o">*</span><span class="p">)</span>
    <span class="p">(</span><span class="o">*</span> <span class="n">the</span> <span class="n">needle</span> <span class="n">valve</span> <span class="n">profile</span> <span class="n">into</span> <span class="n">disticnt</span> <span class="n">nearly</span> <span class="n">linear</span> <span class="n">segments</span><span class="o">*</span><span class="p">)</span>
    <span class="p">(</span><span class="o">*</span> <span class="n">init</span> <span class="n">array</span> <span class="k">with</span> <span class="n">the</span> <span class="n">interpolation</span> <span class="n">points</span>  <span class="o">*</span><span class="p">)</span>
    <span class="p">(</span><span class="o">*</span>      <span class="n">fIn</span>                                      <span class="o">|</span>              <span class="n">fOut</span>            <span class="o">*</span><span class="p">)</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>             <span class="n">arrTable</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">12</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.000001</span><span class="p">;</span>      <span class="n">arrTable</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">15</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.000024</span><span class="p">;</span>      <span class="n">arrTable</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">19</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span>  <span class="mf">0.0001</span><span class="p">;</span>       <span class="n">arrTable</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">25</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span>  <span class="mf">0.001</span><span class="p">;</span>        <span class="n">arrTable</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">28</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.0082</span><span class="p">;</span>        <span class="n">arrTable</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">31</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.04</span><span class="p">;</span>          <span class="n">arrTable</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">34</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.062</span><span class="p">;</span> <span class="n">arrTable</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">39</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.09</span><span class="p">;</span>          <span class="n">arrTable</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">44</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.112</span><span class="p">;</span>                <span class="n">arrTable</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">49</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.6</span><span class="p">;</span>                  <span class="n">arrTable</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">55</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">1.34</span><span class="p">;</span>         <span class="n">arrTable</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">62</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">;</span>                    <span class="n">arrTable</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">70</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">7.27</span><span class="p">;</span>         <span class="n">arrTable</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">78</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">20</span><span class="p">;</span>                   <span class="n">arrTable</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">100</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span> <span class="n">init</span> <span class="n">array</span> <span class="k">with</span> <span class="n">the</span> <span class="n">interpolation</span> <span class="n">points</span>  <span class="o">*</span><span class="p">)</span>
    <span class="p">(</span><span class="o">*</span>      <span class="n">fIn</span>                                      <span class="o">|</span>              <span class="n">fOut</span>            <span class="o">*</span><span class="p">)</span>
    <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>                <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">12</span><span class="p">;</span>
    <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.000001</span><span class="p">;</span> <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">15</span><span class="p">;</span>
    <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.000024</span><span class="p">;</span> <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">19</span><span class="p">;</span>
    <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span>  <span class="mf">0.0001</span><span class="p">;</span>  <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">25</span><span class="p">;</span>
    <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span>  <span class="mf">0.001</span><span class="p">;</span>   <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">28</span><span class="p">;</span>
    <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.0082</span><span class="p">;</span>   <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">31</span><span class="p">;</span>
    <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.04</span><span class="p">;</span>             <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">34</span><span class="p">;</span>
    <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.062</span><span class="p">;</span>    <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">39</span><span class="p">;</span>
    <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.09</span><span class="p">;</span>             <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">44</span><span class="p">;</span>
    <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.112</span><span class="p">;</span>           <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">49</span><span class="p">;</span>
    <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.6</span><span class="p">;</span>                     <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">55</span><span class="p">;</span>
    <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">1.34</span><span class="p">;</span>            <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">62</span><span class="p">;</span>
    <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">;</span>                       <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">70</span><span class="p">;</span>
    <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">7.27</span><span class="p">;</span>            <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">78</span><span class="p">;</span>
    <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">20</span><span class="p">;</span>                      <span class="n">arrTableAprt1</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">100</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span> <span class="n">init</span> <span class="n">array</span> <span class="k">with</span> <span class="n">the</span> <span class="n">interpolation</span> <span class="n">points</span>  <span class="o">*</span><span class="p">)</span>
    <span class="p">(</span><span class="o">*</span>      <span class="n">fIn</span>                                      <span class="o">|</span>              <span class="n">fOut</span>            <span class="o">*</span><span class="p">)</span>
    <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>                    <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">12</span><span class="p">;</span>
    <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.000001</span><span class="p">;</span>         <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">15</span><span class="p">;</span>
    <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.000024</span><span class="p">;</span>         <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">19</span><span class="p">;</span>
    <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span>  <span class="mf">0.000072</span><span class="p">;</span>        <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">25</span><span class="p">;</span>
    <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span>  <span class="mf">0.0059</span><span class="p">;</span>      <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">28</span><span class="p">;</span>
    <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.0059</span><span class="p">;</span>           <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">31</span><span class="p">;</span>
    <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.0099</span><span class="p">;</span>           <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">34</span><span class="p">;</span>
    <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.034</span><span class="p">;</span>            <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">39</span><span class="p">;</span>
    <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.051</span><span class="p">;</span>            <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">44</span><span class="p">;</span>
    <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.074</span><span class="p">;</span>           <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">49</span><span class="p">;</span>
    <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.2</span><span class="p">;</span>                     <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">55</span><span class="p">;</span>
    <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.598</span><span class="p">;</span>           <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">62</span><span class="p">;</span>
    <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>                       <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">70</span><span class="p">;</span>
    <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">3.34</span><span class="p">;</span>            <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">78</span><span class="p">;</span>
    <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">20</span><span class="p">;</span>                      <span class="n">arrTableAprt2</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="p">(</span><span class="o">*</span> <span class="n">init</span> <span class="n">array</span> <span class="k">with</span> <span class="n">the</span> <span class="n">interpolation</span> <span class="n">points</span>  <span class="o">*</span><span class="p">)</span>
    <span class="p">(</span><span class="o">*</span>      <span class="n">fIn</span>                                      <span class="o">|</span>              <span class="n">fOut</span>            <span class="o">*</span><span class="p">)</span>
    <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>                    <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">12</span><span class="p">;</span>
    <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.000001</span><span class="p">;</span>         <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">15</span><span class="p">;</span>
    <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.000024</span><span class="p">;</span>         <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">19</span><span class="p">;</span>
    <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span>  <span class="mf">0.000062</span><span class="p">;</span>        <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">25</span><span class="p">;</span>
    <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span>  <span class="mf">0.001</span><span class="p">;</span>       <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">28</span><span class="p">;</span>
    <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.005</span><span class="p">;</span>            <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">31</span><span class="p">;</span>
    <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.01</span><span class="p">;</span>                     <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">34</span><span class="p">;</span>
    <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.029</span><span class="p">;</span>            <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">39</span><span class="p">;</span>
    <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.036</span><span class="p">;</span>            <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">44</span><span class="p">;</span>
    <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.058</span><span class="p">;</span>           <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">49</span><span class="p">;</span>
    <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.2</span><span class="p">;</span>                     <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">55</span><span class="p">;</span>
    <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.363</span><span class="p">;</span>           <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">62</span><span class="p">;</span>
    <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>                       <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">70</span><span class="p">;</span>
    <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">1.95</span><span class="p">;</span>            <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">78</span><span class="p">;</span>
    <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">20</span><span class="p">;</span>                      <span class="n">arrTableAprt3</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">100</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span> <span class="n">init</span> <span class="n">array</span> <span class="k">with</span> <span class="n">the</span> <span class="n">interpolation</span> <span class="n">points</span>  <span class="o">*</span><span class="p">)</span>
    <span class="p">(</span><span class="o">*</span>      <span class="n">fIn</span>                                      <span class="o">|</span>              <span class="n">fOut</span>            <span class="o">*</span><span class="p">)</span>
    <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>                    <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.000001</span><span class="p">;</span>         <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">12</span><span class="p">;</span>
    <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.000024</span><span class="p">;</span>         <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">17</span><span class="p">;</span>
    <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span>  <span class="mf">0.000071</span><span class="p">;</span>        <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">23</span><span class="p">;</span>
    <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span>  <span class="mf">0.00036</span><span class="p">;</span>     <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">26</span><span class="p">;</span>
    <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span>  <span class="mf">0.005</span><span class="p">;</span>       <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">29</span><span class="p">;</span>
    <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.0073</span><span class="p">;</span>           <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">32</span><span class="p">;</span>
    <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.028</span><span class="p">;</span>            <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">37</span><span class="p">;</span>
    <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.04</span><span class="p">;</span>                     <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">42</span><span class="p">;</span>
    <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.0535</span><span class="p">;</span>          <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">47</span><span class="p">;</span>
    <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.083</span><span class="p">;</span>           <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">53</span><span class="p">;</span>
    <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">0.3</span><span class="p">;</span>                     <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">60</span><span class="p">;</span>
    <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>                       <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">68</span><span class="p">;</span>
    <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mf">1.95</span><span class="p">;</span>            <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">76</span><span class="p">;</span>
    <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">20</span><span class="p">;</span>                      <span class="n">arrTableAprt4</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">98</span><span class="p">;</span>



    <span class="p">(</span><span class="o">*</span> <span class="n">init</span> <span class="n">parameter</span> <span class="n">struct</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS</span><span class="o">.</span><span class="n">tCtrlCycleTime</span>                                  <span class="o">:=</span> <span class="n">T</span><span class="c1">#10ms;</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS</span><span class="o">.</span><span class="n">tTaskCycleTime</span>                                  <span class="o">:=</span> <span class="n">T</span><span class="c1">#10ms;</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS</span><span class="o">.</span><span class="n">nDataTable_NumberOfRows</span>         <span class="o">:=</span> <span class="n">INT_TO_UINT</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>

    <span class="p">(</span><span class="o">*</span><span class="n">FBCNTRL</span><span class="o">*</span><span class="p">)</span>
    <span class="p">(</span><span class="o">*</span> <span class="n">init</span> <span class="n">parameter</span> <span class="n">struct</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">stCTRL_PID_PARAMS</span><span class="o">.</span><span class="n">tCtrlCycleTime</span>                <span class="o">:=</span> <span class="n">T</span><span class="c1">#250ms;</span>
    <span class="n">stCTRL_PID_PARAMS</span><span class="o">.</span><span class="n">tTaskCycleTime</span>                <span class="o">:=</span> <span class="n">T</span><span class="c1">#10ms;</span>
    <span class="n">stCTRL_PID_PARAMS</span><span class="o">.</span><span class="n">fKp</span>                                   <span class="o">:=</span> <span class="n">fKp1</span><span class="p">;</span>                        <span class="p">(</span><span class="o">*</span> <span class="n">proportional</span> <span class="n">gain</span> <span class="n">Kp</span>                         <span class="o">*</span><span class="p">)</span>
    <span class="n">stCTRL_PID_PARAMS</span><span class="o">.</span><span class="n">tTn</span>                                   <span class="o">:=</span> <span class="n">T</span><span class="c1">#500ms;             (*  Tn                                                                  *)</span>
    <span class="n">stCTRL_PID_PARAMS</span><span class="o">.</span><span class="n">tTv</span>                                   <span class="o">:=</span> <span class="n">T</span><span class="c1">#200ms;     (*  Tv                                                                  *)</span>
    <span class="n">stCTRL_PID_PARAMS</span><span class="o">.</span><span class="n">tTd</span>                                   <span class="o">:=</span> <span class="n">T</span><span class="c1">#500ms;     (*  Td                          200                                     *)</span>
    <span class="n">stCTRL_PID_PARAMS</span><span class="o">.</span><span class="n">fOutMaxLimit</span>                  <span class="o">:=</span>  <span class="mi">25</span><span class="p">;</span>                 <span class="p">(</span><span class="o">*</span> <span class="n">maximum</span> <span class="n">output</span> <span class="n">limit</span>                         <span class="o">*</span><span class="p">)</span>
    <span class="n">stCTRL_PID_PARAMS</span><span class="o">.</span><span class="n">fOutMinLimit</span>                  <span class="o">:=</span>  <span class="o">-</span><span class="mi">100</span><span class="p">;</span>                       <span class="p">(</span><span class="o">*</span> <span class="n">minimum</span> <span class="n">output</span> <span class="n">limit</span>                         <span class="o">*</span><span class="p">)</span>

    <span class="p">(</span><span class="o">*</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">mode</span> <span class="n">to</span> <span class="n">ACTIVE</span> <span class="o">--&gt;</span> <span class="n">normal</span> <span class="n">operation</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">eMode</span>                                                   <span class="o">:=</span> <span class="n">eCTRL_MODE_PASSIVE</span>   <span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="nb">set</span> <span class="n">the</span> <span class="n">upper</span> <span class="n">limit</span> <span class="n">on</span> <span class="n">the</span> <span class="n">VCN</span><span class="o">*</span><span class="p">)</span>
    <span class="n">VCN_70</span><span class="o">.</span><span class="n">M_SetThrottle</span><span class="p">(</span><span class="n">rLimit</span><span class="p">);</span>

    <span class="p">(</span><span class="o">*</span> <span class="n">reset</span> <span class="n">the</span> <span class="n">init</span> <span class="n">flag</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">bInit</span>                                                   <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="p">(</span><span class="o">*</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">addresses</span> <span class="o">*</span><span class="p">)</span>
<span class="p">(</span><span class="o">*</span> <span class="n">Gain</span> <span class="n">selection</span> <span class="o">*</span><span class="p">)</span>
<span class="p">(</span><span class="o">*</span> <span class="n">VCN</span> <span class="n">limit</span> <span class="o">*</span><span class="p">)</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">bGo</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">CASE</span> <span class="n">eSelectedAprt</span> <span class="n">of</span>
         <span class="n">E_MAA_States</span><span class="o">.</span><span class="n">Aprt1</span><span class="p">:</span>
            <span class="n">arrTable</span> <span class="o">:=</span> <span class="n">arrTableAprt1</span><span class="p">;</span>
            <span class="n">stCTRL_PID_PARAMS</span><span class="o">.</span><span class="n">fKp</span>   <span class="o">:=</span> <span class="n">fKp1</span><span class="p">;</span>
            <span class="o">//</span><span class="n">rLimit</span><span class="o">:=</span> <span class="n">rLimit1</span><span class="p">;</span>
            <span class="o">//</span><span class="n">VCN_70</span><span class="o">.</span><span class="n">M_SetThrottle</span><span class="p">(</span><span class="mi">78</span><span class="p">);</span>
         <span class="n">E_MAA_States</span><span class="o">.</span><span class="n">Aprt2</span><span class="p">:</span>
            <span class="n">arrTable</span> <span class="o">:=</span> <span class="n">arrTableAprt2</span><span class="p">;</span>
            <span class="n">stCTRL_PID_PARAMS</span><span class="o">.</span><span class="n">fKp</span>   <span class="o">:=</span> <span class="n">fKp2</span><span class="p">;</span>
            <span class="o">//</span><span class="n">rLimit</span><span class="o">:=</span> <span class="n">rLimit2</span><span class="p">;</span>
            <span class="o">//</span><span class="n">VCN_70</span><span class="o">.</span><span class="n">M_SetThrottle</span><span class="p">(</span><span class="mi">78</span><span class="p">);</span>
         <span class="n">E_MAA_States</span><span class="o">.</span><span class="n">Aprt3</span><span class="p">:</span>
            <span class="n">arrTable</span> <span class="o">:=</span> <span class="n">arrTableAprt3</span><span class="p">;</span>
            <span class="n">stCTRL_PID_PARAMS</span><span class="o">.</span><span class="n">fKp</span>   <span class="o">:=</span> <span class="n">fKp3</span><span class="p">;</span>
            <span class="o">//</span><span class="n">rLimit</span><span class="o">:=</span> <span class="n">rLimit3</span><span class="p">;</span>
            <span class="o">//</span><span class="n">VCN_70</span><span class="o">.</span><span class="n">M_SetThrottle</span><span class="p">(</span><span class="mi">78</span><span class="p">);</span>
         <span class="n">E_MAA_States</span><span class="o">.</span><span class="n">Aprt4</span><span class="p">:</span>
            <span class="n">arrTable</span> <span class="o">:=</span> <span class="n">arrTableAprt4</span><span class="p">;</span>
            <span class="n">stCTRL_PID_PARAMS</span><span class="o">.</span><span class="n">fKp</span>   <span class="o">:=</span> <span class="n">fKp4</span><span class="p">;</span>
            <span class="o">//</span><span class="n">rLimit</span><span class="o">:=</span> <span class="n">rLimit4</span><span class="p">;</span>
            <span class="o">//</span><span class="n">VCN_70</span><span class="o">.</span><span class="n">M_SetThrottle</span><span class="p">(</span><span class="mi">78</span><span class="p">);</span>
    <span class="n">END_CASE</span>
<span class="n">END_IF</span>

<span class="n">stCTRL_LIN_INTERPOLATION_PARAMS</span><span class="o">.</span><span class="n">pDataTable_ADR</span>                      <span class="o">:=</span> <span class="n">ADR</span><span class="p">(</span><span class="n">arrTable</span><span class="p">);</span>
<span class="n">stCTRL_LIN_INTERPOLATION_PARAMS</span><span class="o">.</span><span class="n">nDataTable_SIZEOF</span>   <span class="o">:=</span> <span class="n">SIZEOF</span><span class="p">(</span><span class="n">arrTable</span><span class="p">);</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Logger</span><span class="p">:</span>
<span class="n">rtAction</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span><span class="n">eSelectedAprt</span> <span class="o">&lt;&gt;</span>  <span class="n">eSetAprt</span><span class="p">);</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">fTrig_PMPS</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span> <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;AT1K0 switched to local mode.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Info</span><span class="p">);</span>  <span class="n">END_IF</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">rTrig_PMPS</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span> <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;AT1K0 switched to PMPS mode.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Info</span><span class="p">);</span>   <span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">rtAction</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>  <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;AT1K0-MAA current aperture size mismatch, change aperture state or switch to local mode&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Critical</span><span class="p">);</span>   <span class="n">END_IF</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_STATE</span><span class="p">:</span>
<span class="n">IF</span> <span class="n">tExceed</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
    <span class="n">eState</span> <span class="o">:=</span> <span class="n">E_State</span><span class="o">.</span><span class="n">error</span><span class="p">;</span>
    <span class="n">stStatus</span><span class="o">.</span><span class="n">AtTarget</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">tSettle</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
    <span class="o">//</span> <span class="n">ok</span>
    <span class="n">eState</span> <span class="o">:=</span> <span class="n">E_State</span><span class="o">.</span><span class="n">ok</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">At</span> <span class="n">Target</span>
    <span class="n">stStatus</span><span class="o">.</span><span class="n">AtTarget</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">stStatus</span><span class="o">.</span><span class="n">Moving</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="p">(</span><span class="n">rCalculatedTransmissionValue</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">TransmissionValue</span> <span class="o">-</span> <span class="p">(</span><span class="n">TransmissionValue</span><span class="o">*</span><span class="mi">20</span><span class="o">/</span><span class="mi">100</span><span class="p">)))</span> <span class="n">THEN</span>
    <span class="o">//</span><span class="n">warning</span>
    <span class="n">eState</span> <span class="o">:=</span> <span class="n">E_State</span><span class="o">.</span><span class="n">warning</span><span class="p">;</span>
<span class="n">ELSE</span> <span class="n">eState</span> <span class="o">:=</span> <span class="n">E_State</span><span class="o">.</span><span class="n">unknown</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="o">//</span> <span class="n">State</span> <span class="n">ok</span> <span class="n">when</span> <span class="n">the</span> <span class="n">Transmission</span> <span class="ow">is</span> <span class="n">within</span> <span class="n">the</span> <span class="n">acceptable</span> <span class="nb">range</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">MAA</span> <span class="n">are</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">errors</span>
<span class="n">stStatus</span><span class="o">.</span><span class="n">OK</span> <span class="o">:=</span> <span class="p">(</span><span class="o">*</span><span class="n">TRANS_FFO</span><span class="o">.</span><span class="n">i_xOK</span> <span class="n">AND</span><span class="o">*</span><span class="p">)</span> <span class="n">US_MAA_OK</span> <span class="n">AND</span> <span class="n">DS_MAA_OK</span> <span class="n">AND</span> <span class="n">US_Turbo_Valves_Open</span>
                    <span class="n">AND</span> <span class="n">DS_Turbo_Valves_Open</span> <span class="n">AND</span> <span class="n">US_Turbo_Running</span> <span class="n">AND</span> <span class="n">DS_Turbo_Running</span><span class="p">;</span>  <span class="p">;</span>


<span class="n">bStatus</span><span class="mf">.0</span> <span class="o">:=</span> <span class="n">stStatus</span><span class="o">.</span><span class="n">AtTarget</span><span class="p">;</span>
<span class="n">bStatus</span><span class="mf">.1</span> <span class="o">:=</span> <span class="n">stStatus</span><span class="o">.</span><span class="n">Moving</span><span class="p">;</span>
<span class="n">bStatus</span><span class="mf">.2</span> <span class="o">:=</span> <span class="n">stStatus</span><span class="o">.</span><span class="n">LocalMode</span><span class="p">;</span>
<span class="n">bStatus</span><span class="mf">.3</span> <span class="o">:=</span> <span class="n">stStatus</span><span class="o">.</span><span class="n">PMPSMode</span><span class="p">;</span>
<span class="n">bStatus</span><span class="mf">.4</span> <span class="o">:=</span> <span class="n">stStatus</span><span class="o">.</span><span class="n">OK</span><span class="p">;</span>
<span class="n">bStatus</span><span class="mf">.5</span> <span class="o">:=</span> <span class="n">stStatus</span><span class="o">.</span><span class="n">Toggle</span><span class="p">;</span>
<span class="n">bStatus</span><span class="mf">.6</span> <span class="o">:=</span> <span class="n">stStatus</span><span class="o">.</span><span class="n">Include</span><span class="p">;</span>

<span class="n">stStatus</span><span class="o">.</span><span class="n">Moving</span> <span class="o">:=</span> <span class="n">NOT</span> <span class="n">tMoving</span><span class="o">.</span><span class="n">Q</span><span class="p">;</span>
<span class="n">xAtTarget</span> <span class="o">:=</span>  <span class="n">stStatus</span><span class="o">.</span><span class="n">AtTarget</span><span class="p">;</span>
<span class="n">xMoving</span> <span class="o">:=</span>  <span class="n">stStatus</span><span class="o">.</span><span class="n">Moving</span><span class="p">;</span>
<span class="n">xOK</span> <span class="o">:=</span>  <span class="n">stStatus</span><span class="o">.</span><span class="n">OK</span><span class="p">;</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">TransmissionValue</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="n">THEN</span> <span class="n">rTransPerc</span><span class="o">:=</span> <span class="n">rCalculatedTransmissionValue</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="n">TransmissionValue</span><span class="p">;</span> <span class="n">END_IF</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">fSetpointValue</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="n">THEN</span> <span class="n">rPressPerc</span><span class="o">:=</span> <span class="n">GCM_82</span><span class="o">.</span><span class="n">rPRESS</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="n">fSetpointValue</span><span class="p">;</span> <span class="n">END_IF</span>

<span class="n">tSettle</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span> <span class="p">(</span><span class="n">rCalculatedTransmissionValue</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">TransmissionValue</span> <span class="o">+</span> <span class="p">(</span><span class="n">TransmissionValue</span><span class="o">*</span><span class="mi">20</span><span class="o">/</span><span class="mi">100</span><span class="p">)))</span> <span class="n">AND</span> <span class="p">(</span><span class="n">rCalculatedTransmissionValue</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">TransmissionValue</span> <span class="o">-</span> <span class="p">(</span><span class="n">TransmissionValue</span><span class="o">*</span><span class="mi">20</span><span class="o">/</span><span class="mi">100</span><span class="p">))),</span>
    <span class="n">PT</span> <span class="o">:=</span> <span class="n">tSettleTime</span><span class="p">);</span>

<span class="n">tMoving</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span> <span class="p">(</span><span class="n">rCalculatedTransmissionValue</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">TransmissionValue</span> <span class="o">+</span> <span class="p">(</span><span class="n">TransmissionValue</span><span class="o">*</span><span class="mi">5</span><span class="o">/</span><span class="mi">100</span><span class="p">)))</span> <span class="n">AND</span> <span class="p">(</span><span class="n">rCalculatedTransmissionValue</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">TransmissionValue</span> <span class="o">-</span> <span class="p">(</span><span class="n">TransmissionValue</span><span class="o">*</span><span class="mi">10</span><span class="o">/</span><span class="mi">100</span><span class="p">))),</span>
    <span class="n">PT</span> <span class="o">:=</span> <span class="n">tMovingTime</span><span class="p">);</span>

<span class="n">tExceed</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span> <span class="p">(</span><span class="n">rCalculatedTransmissionValue</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">TransmissionValue</span> <span class="o">+</span> <span class="p">(</span><span class="n">TransmissionValue</span><span class="o">*</span><span class="mi">20</span><span class="o">/</span><span class="mi">100</span><span class="p">))),</span>
    <span class="n">PT</span> <span class="o">:=</span> <span class="n">tExceedTime</span><span class="p">);</span>
<span class="n">END_ACTION</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#e-maa-states">E_MAA_States</a></p></li>
<li><p><a class="reference internal" href="#e-state">E_State</a></p></li>
<li><p><a class="reference internal" href="#gvl-pmps">GVL_PMPS</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-motion">
<h2>PRG_Motion<a class="headerlink" href="#prg-motion" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_Motion</span>
<span class="n">VAR</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">nTransitionAssertionRootID</span><span class="p">:</span> <span class="n">UDINT</span> <span class="o">:=</span><span class="mi">1000</span><span class="p">;</span>
    <span class="n">nUnknownAssertionRootID</span><span class="p">:</span> <span class="n">UDINT</span> <span class="o">:=</span><span class="mi">9000</span><span class="p">;</span>
    <span class="n">bAllGo</span> <span class="p">:</span> <span class="n">Bool</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>



    <span class="o">/////</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">AT1K0</span><span class="p">:</span><span class="n">GAS_MAA</span><span class="p">:</span><span class="mi">01</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">fbMAA_1_States</span><span class="p">:</span> <span class="n">FB_MAA</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">AT1K0</span><span class="p">:</span><span class="n">GAS_MAA</span><span class="p">:</span><span class="mi">02</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">fbMAA_2_States</span><span class="p">:</span> <span class="n">FB_MAA</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span>  <span class="n">AT1K0</span><span class="p">:</span><span class="n">GAS_MAA</span><span class="p">:</span><span class="mi">03</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">fbMAA_3_States</span><span class="p">:</span> <span class="n">FB_MAA</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">AT1K0</span><span class="p">:</span><span class="n">GAS_MAA</span><span class="p">:</span><span class="mi">04</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">fbMAA_4_States</span><span class="p">:</span> <span class="n">FB_MAA</span><span class="p">;</span>



<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">bInit</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="kc">False</span><span class="p">;</span>

    <span class="o">///</span> <span class="n">PMPS</span>
    <span class="o">//</span><span class="n">MAA</span> <span class="mi">1</span> <span class="n">Y</span>
    <span class="o">//</span><span class="n">fbMAA_1_States</span><span class="o">.</span><span class="n">nTransitionAssertionID</span> <span class="o">:=</span> <span class="mi">43536</span><span class="p">;</span><span class="o">//</span> <span class="n">nTransitionAssertionRootID</span><span class="o">+</span><span class="mi">10</span><span class="p">;</span>
    <span class="o">//</span><span class="n">fbMAA_1_States</span><span class="o">.</span><span class="n">nUnknownAssertionID</span> <span class="o">:=</span> <span class="n">nUnknownAssertionRootID</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Aperture</span> <span class="mi">1</span>
    <span class="n">fbMAA_1_States</span><span class="o">.</span><span class="n">stAprt1</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span>  <span class="o">-</span><span class="mf">0.78</span><span class="p">;</span><span class="o">//-</span><span class="mf">1.4</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Aperture</span> <span class="mi">2</span>
    <span class="n">fbMAA_1_States</span><span class="o">.</span><span class="n">stAprt2</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">16.1</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Aperture</span> <span class="mi">3</span>
    <span class="n">fbMAA_1_States</span><span class="o">.</span><span class="n">stAprt3</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">30.93</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Aperture</span> <span class="mi">4</span>
    <span class="n">fbMAA_1_States</span><span class="o">.</span><span class="n">stAprt4</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">48.7</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">X</span> <span class="n">Cen</span>
    <span class="n">fbMAA_1_States</span><span class="o">.</span><span class="n">stXCen</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span><span class="o">//</span><span class="mf">1.5</span><span class="p">;</span><span class="o">//</span> <span class="mi">0</span><span class="p">;</span><span class="o">//</span> <span class="o">-</span><span class="mf">2.083</span><span class="p">;</span>


    <span class="o">//</span><span class="n">MAA</span> <span class="mi">2</span> <span class="n">Y</span>
    <span class="o">//</span><span class="n">fbMAA_2_States</span><span class="o">.</span><span class="n">nTransitionAssertionID</span> <span class="o">:=</span> <span class="mi">43552</span><span class="p">;</span><span class="o">//</span><span class="n">nTransitionAssertionRootID</span><span class="o">+</span><span class="mi">20</span><span class="p">;</span>
    <span class="o">//</span><span class="n">fbMAA_1_States</span><span class="o">.</span><span class="n">nUnknownAssertionID</span> <span class="o">:=</span> <span class="n">nUnknownAssertionRootID</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Aperture</span> <span class="mi">1</span>
    <span class="n">fbMAA_2_States</span><span class="o">.</span><span class="n">stAprt1</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span>  <span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="o">//-</span><span class="mf">1.4</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Aperture</span> <span class="mi">2</span>
    <span class="n">fbMAA_2_States</span><span class="o">.</span><span class="n">stAprt2</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">16.5</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Aperture</span> <span class="mi">3</span>
    <span class="n">fbMAA_2_States</span><span class="o">.</span><span class="n">stAprt3</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">30.9</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Aperture</span> <span class="mi">4</span>
    <span class="n">fbMAA_2_States</span><span class="o">.</span><span class="n">stAprt4</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">48.96</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">X</span> <span class="n">Cen</span>
    <span class="n">fbMAA_2_States</span><span class="o">.</span><span class="n">stXCen</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span><span class="mf">1.5</span><span class="p">;</span><span class="o">//</span><span class="mf">0.475</span><span class="p">;</span><span class="o">//</span><span class="mi">0</span><span class="p">;</span><span class="o">//-</span><span class="mf">0.77</span><span class="p">;</span>


    <span class="o">//</span><span class="n">MAA</span> <span class="mi">3</span> <span class="n">Y</span>
    <span class="o">//</span><span class="n">fbMAA_3_States</span><span class="o">.</span><span class="n">nTransitionAssertionID</span> <span class="o">:=</span> <span class="mi">43568</span><span class="p">;</span><span class="o">//</span><span class="n">nTransitionAssertionRootID</span><span class="o">+</span><span class="mi">30</span><span class="p">;</span>
    <span class="o">//</span><span class="n">fbMAA_1_States</span><span class="o">.</span><span class="n">nUnknownAssertionID</span> <span class="o">:=</span> <span class="n">nUnknownAssertionRootID</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Aperture</span> <span class="mi">1</span>
    <span class="n">fbMAA_3_States</span><span class="o">.</span><span class="n">stAprt1</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span>  <span class="o">-</span><span class="mf">0.35</span><span class="p">;</span><span class="o">//-</span><span class="mf">1.15</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Aperture</span> <span class="mi">2</span>
    <span class="n">fbMAA_3_States</span><span class="o">.</span><span class="n">stAprt2</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">16.2</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Aperture</span> <span class="mi">3</span>
    <span class="n">fbMAA_3_States</span><span class="o">.</span><span class="n">stAprt3</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">30.8</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Aperture</span> <span class="mi">4</span>
    <span class="n">fbMAA_3_States</span><span class="o">.</span><span class="n">stAprt4</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">48.95</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">X</span> <span class="n">Cen</span>
    <span class="n">fbMAA_3_States</span><span class="o">.</span><span class="n">stXCen</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span><span class="mi">1</span><span class="p">;</span><span class="o">//-</span><span class="mf">0.4064</span><span class="p">;</span><span class="o">//</span><span class="mi">0</span><span class="p">;</span><span class="o">//</span><span class="mf">2.031</span><span class="p">;</span>


    <span class="o">//</span><span class="n">MAA</span> <span class="mi">4</span> <span class="n">Y</span>
    <span class="o">//</span><span class="n">fbMAA_4_States</span><span class="o">.</span><span class="n">nTransitionAssertionID</span> <span class="o">:=</span> <span class="mi">43584</span><span class="p">;</span><span class="o">//</span><span class="n">nTransitionAssertionRootID</span><span class="o">+</span><span class="mi">40</span><span class="p">;</span>
    <span class="o">//</span><span class="n">fbMAA_1_States</span><span class="o">.</span><span class="n">nUnknownAssertionID</span> <span class="o">:=</span> <span class="n">nUnknownAssertionRootID</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Aperture</span> <span class="mi">1</span>
    <span class="n">fbMAA_4_States</span><span class="o">.</span><span class="n">stAprt1</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span>  <span class="mi">0</span><span class="p">;</span><span class="o">//-</span><span class="mi">1</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Aperture</span> <span class="mi">2</span>
    <span class="n">fbMAA_4_States</span><span class="o">.</span><span class="n">stAprt2</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">14.5</span><span class="p">;</span><span class="o">//-</span><span class="mf">16.6</span><span class="p">;</span> <span class="n">re</span> <span class="n">align</span> <span class="n">data</span> <span class="n">May</span> <span class="mi">17</span><span class="p">,</span><span class="mi">2024</span>
    <span class="o">//</span> <span class="n">Aperture</span> <span class="mi">3</span>
    <span class="n">fbMAA_4_States</span><span class="o">.</span><span class="n">stAprt3</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">30.9</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Aperture</span> <span class="mi">4</span>
    <span class="n">fbMAA_4_States</span><span class="o">.</span><span class="n">stAprt4</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">49.06</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">X</span> <span class="n">Cen</span>
    <span class="n">fbMAA_4_States</span><span class="o">.</span><span class="n">stXCen</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span><span class="mf">1.0</span><span class="p">;</span><span class="o">//</span><span class="mi">0</span><span class="p">;</span><span class="o">//-</span><span class="mf">0.9861</span><span class="p">;</span><span class="o">//</span><span class="mi">0</span><span class="p">;</span><span class="o">//</span><span class="mf">2.0345</span><span class="p">;</span>

<span class="n">END_IF</span>

<span class="o">//</span><span class="n">EBD</span>
<span class="n">fbMAA_1_States</span><span class="p">(</span>
     <span class="n">fbArbiter</span> <span class="o">:=</span> <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbArbiter1</span><span class="p">,</span>
     <span class="n">i_DevName</span><span class="o">:=</span> <span class="s1">&#39;AT1K0:GAS_MAA:01&#39;</span><span class="p">,</span>
    <span class="n">fbFFHWO</span> <span class="o">:=</span>  <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">g_FastFaultOutput1</span><span class="p">,</span>
    <span class="n">sPmpsDeviceName</span><span class="o">:=</span><span class="s1">&#39;AT1K0:GAS_MAA:01&#39;</span><span class="p">,</span>
    <span class="n">sTransitionKey</span><span class="o">:=</span><span class="s1">&#39;AT1K0:GAS_MAA:01-TRANSITION&#39;</span><span class="p">,</span>
    <span class="n">stYStage</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="p">,</span>
    <span class="n">stXStage</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="p">);</span>

<span class="n">fbMAA_2_States</span><span class="p">(</span>
    <span class="n">fbArbiter</span> <span class="o">:=</span> <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbArbiter1</span><span class="p">,</span>
    <span class="n">i_DevName</span><span class="o">:=</span> <span class="s1">&#39;AT1K0:GAS_MAA:02&#39;</span><span class="p">,</span>
    <span class="n">sPmpsDeviceName</span><span class="o">:=</span><span class="s1">&#39;AT1K0:GAS_MAA:02&#39;</span><span class="p">,</span>
    <span class="n">sTransitionKey</span><span class="o">:=</span><span class="s1">&#39;AT1K0:GAS_MAA:02-TRANSITION&#39;</span><span class="p">,</span>
    <span class="n">fbFFHWO</span> <span class="o">:=</span> <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">g_FastFaultOutput1</span><span class="p">,</span>
    <span class="n">stYStage</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M4</span><span class="p">,</span>
    <span class="n">stXStage</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M3</span><span class="p">);</span>
<span class="o">//</span><span class="n">FEE</span>
<span class="n">fbMAA_3_States</span><span class="p">(</span>
    <span class="n">fbArbiter</span> <span class="o">:=</span> <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbArbiter1</span><span class="p">,</span>
    <span class="n">i_DevName</span><span class="o">:=</span> <span class="s1">&#39;AT1K0:GAS_MAA:03&#39;</span><span class="p">,</span>
    <span class="n">sPmpsDeviceName</span><span class="o">:=</span><span class="s1">&#39;AT1K0:GAS_MAA:03&#39;</span><span class="p">,</span>
    <span class="n">sTransitionKey</span><span class="o">:=</span><span class="s1">&#39;AT1K0:GAS_MAA:03-TRANSITION&#39;</span><span class="p">,</span>
    <span class="n">fbFFHWO</span> <span class="o">:=</span> <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">g_FastFaultOutput1</span><span class="p">,</span>
    <span class="n">stYStage</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M6</span><span class="p">,</span>
    <span class="n">stXStage</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M5</span><span class="p">);</span>

<span class="n">fbMAA_4_States</span><span class="p">(</span>
    <span class="n">fbArbiter</span> <span class="o">:=</span> <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbArbiter1</span><span class="p">,</span>
    <span class="n">i_DevName</span><span class="o">:=</span> <span class="s1">&#39;AT1K0:GAS_MAA:04&#39;</span><span class="p">,</span>
    <span class="n">sPmpsDeviceName</span><span class="o">:=</span><span class="s1">&#39;AT1K0:GAS_MAA:04&#39;</span><span class="p">,</span>
    <span class="n">sTransitionKey</span><span class="o">:=</span><span class="s1">&#39;AT1K0:GAS_MAA:04-TRANSITION&#39;</span><span class="p">,</span>
    <span class="n">fbFFHWO</span> <span class="o">:=</span> <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">g_FastFaultOutput1</span><span class="p">,</span>
    <span class="n">stYStage</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M8</span><span class="p">,</span>
    <span class="n">stXStage</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M7</span><span class="p">);</span>


<span class="p">(</span><span class="o">*</span><span class="n">Set</span> <span class="k">global</span> <span class="n">OK</span> <span class="n">bit</span><span class="o">*</span><span class="p">)</span>
<span class="n">US_MAA_OK</span> <span class="o">:=</span> <span class="p">(</span><span class="n">fbMAA_1_States</span><span class="o">.</span><span class="n">fbStates</span><span class="o">.</span><span class="n">enumGet</span> <span class="o">=</span> <span class="n">fbMAA_2_States</span><span class="o">.</span><span class="n">fbStates</span><span class="o">.</span><span class="n">enumGet</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">fbMAA_2_States</span><span class="o">.</span><span class="n">fbStates</span><span class="o">.</span><span class="n">enumGet</span> <span class="o">=</span> <span class="n">fbMAA_3_States</span><span class="o">.</span><span class="n">fbStates</span><span class="o">.</span><span class="n">enumGet</span><span class="p">)</span><span class="n">AND</span><span class="p">(</span> <span class="n">fbMAA_3_States</span><span class="o">.</span><span class="n">fbStates</span><span class="o">.</span><span class="n">enumGet</span> <span class="o">=</span> <span class="n">fbMAA_4_States</span><span class="o">.</span><span class="n">fbStates</span><span class="o">.</span><span class="n">enumGet</span><span class="p">)</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">fbMAA_1_States</span><span class="o">.</span><span class="n">fbStates</span><span class="o">.</span><span class="n">bError</span><span class="p">)</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">fbMAA_2_States</span><span class="o">.</span><span class="n">fbStates</span><span class="o">.</span><span class="n">bError</span><span class="p">);</span>
<span class="n">DS_MAA_OK</span> <span class="o">:=</span> <span class="p">(</span><span class="n">fbMAA_3_States</span><span class="o">.</span><span class="n">fbStates</span><span class="o">.</span><span class="n">enumGet</span> <span class="o">=</span> <span class="n">fbMAA_4_States</span><span class="o">.</span><span class="n">fbStates</span><span class="o">.</span><span class="n">enumGet</span><span class="p">)</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">fbMAA_3_States</span><span class="o">.</span><span class="n">fbStates</span><span class="o">.</span><span class="n">bError</span><span class="p">)</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">fbMAA_4_States</span><span class="o">.</span><span class="n">fbStates</span><span class="o">.</span><span class="n">bError</span><span class="p">);</span>

<span class="o">//</span><span class="n">change</span> <span class="n">here</span> <span class="n">line103</span> <span class="ow">and</span> <span class="mi">119</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">US_MAA_OK</span> <span class="n">AND</span> <span class="n">DS_MAA_OK</span><span class="p">)</span> <span class="n">THEN</span>   <span class="n">eSelectedAprt</span><span class="o">:=</span><span class="n">fbMAA_4_States</span><span class="o">.</span><span class="n">fbStates</span><span class="o">.</span><span class="n">enumGet</span><span class="p">;</span><span class="o">//</span><span class="n">was</span> <span class="n">fbMAA_1</span>
<span class="n">ELSE</span>  <span class="n">eSelectedAprt</span><span class="o">:=</span> <span class="n">E_MAA_States</span><span class="o">.</span><span class="n">Unknown</span><span class="p">;</span> <span class="n">END_IF</span><span class="p">;</span>
<span class="o">////////////////////</span>
<span class="o">//</span><span class="n">Set</span> <span class="n">the</span> <span class="n">right</span> <span class="n">state</span> <span class="n">i</span><span class="o">.</span><span class="n">e</span><span class="o">.</span> <span class="n">apperture</span> <span class="n">based</span> <span class="n">on</span> <span class="n">the</span> <span class="n">current</span> <span class="n">beam</span> <span class="n">size</span><span class="o">/</span>
<span class="o">/////</span>
    <span class="n">IF</span><span class="p">(</span> <span class="n">rPhotonEnergy</span> <span class="o">&gt;=</span><span class="mf">0.9E3</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="n">eSetAprt</span> <span class="o">:=</span> <span class="n">E_MAA_States</span><span class="o">.</span><span class="n">Aprt1</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="p">(</span> <span class="n">rPhotonEnergy</span> <span class="o">&gt;=</span><span class="mf">0.6E3</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">eSetAprt</span> <span class="o">:=</span> <span class="n">E_MAA_States</span><span class="o">.</span><span class="n">Aprt2</span><span class="p">;</span>
            <span class="n">ELSIF</span> <span class="p">(</span> <span class="n">rPhotonEnergy</span> <span class="o">&gt;=</span><span class="mf">0.5E3</span><span class="p">)</span> <span class="n">THEN</span>
                <span class="n">eSetAprt</span> <span class="o">:=</span> <span class="n">E_MAA_States</span><span class="o">.</span><span class="n">Aprt3</span><span class="p">;</span>
                <span class="n">ELSE</span>
                    <span class="n">eSetAprt</span> <span class="o">:=</span> <span class="n">E_MAA_States</span><span class="o">.</span><span class="n">Aprt4</span><span class="p">;</span>
    <span class="n">END_IF</span>
<span class="p">(</span><span class="o">*</span><span class="n">Aperture</span> <span class="n">state</span> <span class="n">selection</span><span class="o">*</span><span class="p">)</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">xPMPSMode</span><span class="p">)</span> <span class="n">AND</span> <span class="p">(</span><span class="n">bChangeAperture</span><span class="p">)</span>  <span class="n">AND</span> <span class="p">(</span><span class="n">eSelectedAprt</span> <span class="o">&lt;&gt;</span> <span class="n">eSetAprt</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">fbMAA_1_States</span><span class="o">.</span><span class="n">enumSet</span> <span class="o">:=</span> <span class="n">eSetAprt</span><span class="p">;</span>
    <span class="n">fbMAA_2_States</span><span class="o">.</span><span class="n">enumSet</span> <span class="o">:=</span> <span class="n">eSetAprt</span><span class="p">;</span>
    <span class="n">fbMAA_3_States</span><span class="o">.</span><span class="n">enumSet</span> <span class="o">:=</span> <span class="n">eSetAprt</span><span class="p">;</span>
    <span class="n">fbMAA_4_States</span><span class="o">.</span><span class="n">enumSet</span> <span class="o">:=</span> <span class="n">eSetAprt</span><span class="p">;</span>
    <span class="n">bChangeAperture</span><span class="o">:=</span><span class="kc">False</span><span class="p">;</span>
    <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;AT1K0-MAA moving to correct apperture size&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
    <span class="n">ELSE</span>
    <span class="n">bChangeAperture</span><span class="o">:=</span><span class="kc">False</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">xPMPSMode</span><span class="p">)</span> <span class="n">AND</span> <span class="n">bChangeAperture</span> <span class="n">AND</span> <span class="p">(</span><span class="n">eSelectedAprt</span> <span class="o">&lt;&gt;</span> <span class="n">eSetAprt</span><span class="p">)</span>  <span class="n">THEN</span>
    <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;AT1K0-MAA is not set to correct apperture size&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Critical</span><span class="p">);</span>
    <span class="n">bChangeAperture</span><span class="o">:=</span><span class="kc">False</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#e-maa-states">E_MAA_States</a></p></li>
<li><p><a class="reference internal" href="#fb-maa">FB_MAA</a></p></li>
<li><p><a class="reference internal" href="#gvl-pmps">GVL_PMPS</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-motors-test">
<h2>PRG_Motors_Test<a class="headerlink" href="#prg-motors-test" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>PROGRAM PRG_Motors_Test
VAR

    Y1_Power: MC_Power;
    Y2_Power: MC_Power;
    Y3_Power: MC_Power;
    Y4_Power: MC_Power;
    X1_Power: MC_Power;
    X2_Power: MC_Power;
    X3_Power: MC_Power;
    X4_Power: MC_Power;


    Y1_ENC AT%I* :INT;
    Y2_ENC AT%I* :INT;
    Y3_ENC AT%I* :INT;
    Y4_ENC AT%I* :INT;
    X1_ENC AT%I* :INT;
    X2_ENC AT%I* :INT;
    X3_ENC AT%I* :INT;
    X4_ENC AT%I* :INT;

END_VAR
X1_Power(//reverse motor direction?
    Axis:=  M1.Axis,
    Enable:= M1.bBrakeRelease,
    Enable_Positive:= M1.bLimitForwardEnable, // fix
    Enable_Negative:= M1.bLimitBackwardEnable,  // fix -- verify
    Override:= ,
    BufferMode:= ,
    Options:= ,
    Status=&gt; ,
    Busy=&gt; ,
    Active=&gt; ,
    Error=&gt; ,
    ErrorID=&gt; );

Y1_Power(
    Axis:=  M2.Axis,
    Enable:= M2.bBrakeRelease,
    Enable_Positive:= M2.bLimitForwardEnable,
    Enable_Negative:= M2.bLimitBackwardEnable,
    Override:= ,
    BufferMode:= ,
    Options:= ,
    Status=&gt; ,
    Busy=&gt; ,
    Active=&gt; ,
    Error=&gt; ,
    ErrorID=&gt; );



X2_Power(
    Axis:=  M3.Axis,
    Enable:= M3.bBrakeRelease,
    Enable_Positive:= M3.bLimitForwardEnable, // fix
    Enable_Negative:= M3.bLimitBackwardEnable,  // fix -- verify
    Override:= ,
    BufferMode:= ,
    Options:= ,
    Status=&gt; ,
    Busy=&gt; ,
    Active=&gt; ,
    Error=&gt; ,
    ErrorID=&gt; );

Y2_Power(
    Axis:=  M4.Axis,
    Enable:= M4.bBrakeRelease,
    Enable_Positive:= M4.bLimitForwardEnable,
    Enable_Negative:= M4.bLimitBackwardEnable,
    Override:= ,
    BufferMode:= ,
    Options:= ,
    Status=&gt; ,
    Busy=&gt; ,
    Active=&gt; ,
    Error=&gt; ,
    ErrorID=&gt; );

X3_Power(
    Axis:=  M5.Axis,
    Enable:= M5.bBrakeRelease,
    Enable_Positive:= M5.bLimitForwardEnable,
    Enable_Negative:= M5.bLimitBackwardEnable,
    Override:= ,
    BufferMode:= ,
    Options:= ,
    Status=&gt; ,
    Busy=&gt; ,
    Active=&gt; ,
    Error=&gt; ,
    ErrorID=&gt; );
Y3_Power(
    Axis:=  M6.Axis,
    Enable:= M6.bBrakeRelease,
    Enable_Positive:= M6.bLimitForwardEnable,
    Enable_Negative:= M6.bLimitBackwardEnable,
    Override:= ,
    BufferMode:= ,
    Options:= ,
    Status=&gt; ,
    Busy=&gt; ,
    Active=&gt; ,
    Error=&gt; ,
    ErrorID=&gt; );


X4_Power(
    Axis:=  M7.Axis,
    Enable:= M7.bBrakeRelease,
    Enable_Positive:= M7.bLimitForwardEnable,
    Enable_Negative:= M7.bLimitBackwardEnable,
    Override:= ,
    BufferMode:= ,
    Options:= ,
    Status=&gt; ,
    Busy=&gt; ,
    Active=&gt; ,
    Error=&gt; ,
    ErrorID=&gt; );
Y4_Power(
    Axis:=  M8.Axis,
    Enable:= M8.bBrakeRelease,
    Enable_Positive:= M8.bLimitForwardEnable,
    Enable_Negative:= M8.bLimitBackwardEnable,
    Override:= ,
    BufferMode:= ,
    Options:= ,
    Status=&gt; ,
    Busy=&gt; ,
    Active=&gt; ,
    Error=&gt; ,
    ErrorID=&gt; );

END_PROGRAM
</pre></div>
</div>
</section>
<section id="prg-pmps">
<h2>PRG_PMPS<a class="headerlink" href="#prg-pmps" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_PMPS</span>
<span class="n">VAR</span>
 <span class="n">fbArbiterIO</span> <span class="p">:</span> <span class="n">FB_SubSysToArbiter_IO</span><span class="p">;</span>
 <span class="n">ar1</span> <span class="p">:</span> <span class="nb">bool</span><span class="p">;</span>
 <span class="n">ar2</span> <span class="p">:</span> <span class="nb">bool</span><span class="p">;</span>
 <span class="n">nReqID</span><span class="p">:</span><span class="n">UDINT</span><span class="p">;</span>
 <span class="n">nReqRM</span><span class="p">:</span><span class="n">UDINT</span><span class="p">;</span>
 <span class="n">bRemove</span><span class="p">:</span><span class="nb">bool</span><span class="p">;</span>
 <span class="n">rtRemove</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>

 <span class="o">//</span><span class="n">Testing</span>
 <span class="n">ID1</span><span class="p">:</span><span class="n">DWORD</span><span class="o">:=</span><span class="mi">43536</span><span class="p">;</span>
 <span class="n">ID2</span><span class="p">:</span><span class="n">DWORD</span><span class="o">:=</span><span class="mi">43552</span><span class="p">;;</span>
 <span class="n">ID3</span><span class="p">:</span><span class="n">DWORD</span><span class="o">:=</span><span class="mi">43568</span><span class="p">;</span>
 <span class="n">ID4</span><span class="p">:</span><span class="n">DWORD</span><span class="o">:=</span><span class="mi">43584</span><span class="p">;</span>
 <span class="n">bTrans</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bAp11</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bAp12</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bAp13</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bAp14</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>


 <span class="n">bTrans2</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bTrans3</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bTrans4</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bTrans1X</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bTrans2X</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bTrans3X</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bTrans4X</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bAp1XS</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bAp2XS</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bAp3XS</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bAp4XS</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>

 <span class="n">bAp21</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bAp22</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bAp23</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bAp24</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bAp31</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bAp32</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bAp33</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bAp34</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bAp41</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bAp42</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bAp43</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
 <span class="n">bAp44</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>

 <span class="n">iAp</span><span class="p">:</span><span class="n">INT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="p">(</span><span class="o">*</span><span class="n">Fast</span> <span class="n">Fault</span> <span class="n">instantiation</span><span class="o">*</span><span class="p">)</span>
<span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">g_FastFaultOutput1</span><span class="o">.</span><span class="n">bAutoReset</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">g_FastFaultOutput2</span><span class="o">.</span><span class="n">bAutoReset</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">g_FastFaultOutput1</span><span class="o">.</span><span class="n">Execute</span><span class="p">();</span>
<span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">g_FastFaultOutput2</span><span class="o">.</span><span class="n">Execute</span><span class="p">();</span>

<span class="p">(</span><span class="o">*</span> <span class="n">Arbiter</span> <span class="n">Instantiation</span><span class="o">*</span><span class="p">)</span>
<span class="p">(</span><span class="o">*</span><span class="n">Arbiter</span> <span class="n">one</span> <span class="n">responsible</span> <span class="k">for</span> <span class="n">the</span> <span class="n">aperture</span> <span class="n">valves</span><span class="o">*</span><span class="p">)</span>
<span class="n">fbArbiterIO</span><span class="p">(</span><span class="n">Arbiter</span> <span class="o">:=</span> <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbArbiter1</span><span class="p">,</span> <span class="n">fbFFHWO</span> <span class="o">:=</span> <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">g_FastFaultOutput1</span><span class="p">);</span>
<span class="o">//</span><span class="n">GVL_ILK</span><span class="o">.</span><span class="n">fbArbiter2</span><span class="o">.</span><span class="n">ElevateRequest</span><span class="p">(</span><span class="n">GVL_ILK</span><span class="o">.</span><span class="n">fbArbiter1</span><span class="p">);</span>

<span class="p">(</span><span class="o">*</span> <span class="n">Photon</span> <span class="n">Energy</span> <span class="o">*</span><span class="p">)</span>
<span class="n">rPhotonEnergy</span> <span class="o">:=</span> <span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">stCurrentBeamParameters</span><span class="o">.</span><span class="n">neV</span><span class="p">;</span>

<span class="n">MOTION_GVL</span><span class="o">.</span><span class="n">fbStandardPMPSDB</span><span class="p">(</span>
    <span class="n">io_fbFFHWO</span><span class="o">:=</span><span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">g_FastFaultOutput1</span><span class="p">,</span>
    <span class="n">bEnable</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
    <span class="n">sPLCName</span><span class="o">:=</span><span class="s1">&#39;plc-kfe-gatt&#39;</span><span class="p">,</span>
<span class="p">);</span>

<span class="p">(</span><span class="o">*</span><span class="n">remove</span><span class="o">*</span><span class="p">)</span>
<span class="p">(</span><span class="o">*</span><span class="n">Debugging</span> <span class="n">functions</span><span class="o">*</span><span class="p">)</span>
<span class="n">bTrans</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID1</span><span class="p">);</span><span class="o">//</span><span class="n">TransitionID</span>
<span class="n">bAp11</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID1</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="n">bAp12</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID1</span><span class="o">+</span><span class="mi">2</span><span class="p">);</span>
<span class="n">bAp13</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID1</span><span class="o">+</span><span class="mi">3</span><span class="p">);</span>
<span class="n">bAp14</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID1</span><span class="o">+</span><span class="mi">4</span><span class="p">);</span>
<span class="n">bTrans1X</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID1</span><span class="o">+</span><span class="mi">5</span><span class="p">);</span>
<span class="n">bAp1XS</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID1</span><span class="o">+</span><span class="mi">6</span><span class="p">);</span>

<span class="n">bTrans2</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID2</span><span class="p">);</span><span class="o">//</span><span class="n">TransitionID</span>
<span class="n">bAp21</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID2</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="n">bAp22</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID2</span><span class="o">+</span><span class="mi">2</span><span class="p">);</span>
<span class="n">bAp23</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID2</span><span class="o">+</span><span class="mi">3</span><span class="p">);</span>
<span class="n">bAp24</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID2</span><span class="o">+</span><span class="mi">4</span><span class="p">);</span>
<span class="n">bTrans2X</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID2</span><span class="o">+</span><span class="mi">5</span><span class="p">);</span>
<span class="n">bAp2XS</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID2</span><span class="o">+</span><span class="mi">6</span><span class="p">);</span>

<span class="n">bTrans3</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID3</span><span class="p">);</span><span class="o">//</span><span class="n">TransitionID</span>
<span class="n">bAp31</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID3</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="n">bAp32</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID3</span><span class="o">+</span><span class="mi">2</span><span class="p">);</span>
<span class="n">bAp33</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID3</span><span class="o">+</span><span class="mi">3</span><span class="p">);</span>
<span class="n">bAp34</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID3</span><span class="o">+</span><span class="mi">4</span><span class="p">);</span>
<span class="n">bTrans3X</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID3</span><span class="o">+</span><span class="mi">5</span><span class="p">);</span>
<span class="n">bAp3XS</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID3</span><span class="o">+</span><span class="mi">6</span><span class="p">);</span>

<span class="n">bTrans4</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID4</span><span class="p">);</span><span class="o">//</span><span class="n">TransitionID</span>
<span class="n">bAp41</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID4</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="n">bAp42</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID4</span><span class="o">+</span><span class="mi">2</span><span class="p">);</span>
<span class="n">bAp43</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID4</span><span class="o">+</span><span class="mi">3</span><span class="p">);</span>
<span class="n">bAp44</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID4</span><span class="o">+</span><span class="mi">4</span><span class="p">);</span>
<span class="n">bTrans3X</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID4</span><span class="o">+</span><span class="mi">5</span><span class="p">);</span>
<span class="n">bAp4XS</span><span class="o">:=</span> <span class="n">fbArbiter1</span><span class="o">.</span><span class="n">CheckRequestInPool</span><span class="p">(</span><span class="n">ID4</span><span class="o">+</span><span class="mi">6</span><span class="p">);</span>


<span class="n">rtRemove</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span> <span class="n">bRemove</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">rtRemove</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>
     <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbArbiter1</span><span class="o">.</span><span class="n">RemoveRequest</span><span class="p">(</span><span class="n">nReqRM</span><span class="p">);</span>
    <span class="o">//</span><span class="n">GVL_ILK</span><span class="o">.</span><span class="n">fbArbiter2</span><span class="o">.</span><span class="n">RemoveRequest</span><span class="p">(</span><span class="n">nReqRM</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#gvl-pmps">GVL_PMPS</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-transmission">
<h2>PRG_Transmission<a class="headerlink" href="#prg-transmission" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_Transmission</span>
<span class="n">VAR</span>
    <span class="n">arr_COEF_Table_Ar</span>                       <span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1..50</span><span class="p">,</span><span class="mf">1..2</span><span class="p">]</span> <span class="n">OF</span> <span class="n">FLOAT</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span>                       <span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1..40</span><span class="p">,</span><span class="mf">1..2</span><span class="p">]</span> <span class="n">OF</span> <span class="n">FLOAT</span><span class="p">;</span>


    <span class="n">fbCTRL_LIN_INTERPOLATION_Ar</span>                                     <span class="p">:</span> <span class="n">FB_CTRL_LIN_INTERPOLATION</span><span class="p">;</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS_Ar</span>      <span class="p">:</span> <span class="n">ST_CTRL_LIN_INTERPOLATION_PARAMS</span><span class="p">;</span>
    <span class="n">fbCTRL_LIN_INTERPOLATION_N2</span>                                     <span class="p">:</span> <span class="n">FB_CTRL_LIN_INTERPOLATION</span><span class="p">;</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS_N2</span>      <span class="p">:</span> <span class="n">ST_CTRL_LIN_INTERPOLATION_PARAMS</span><span class="p">;</span>
    <span class="n">eMode</span>                                                   <span class="p">:</span> <span class="n">E_CTRL_MODE</span><span class="p">;</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>



    <span class="n">FFO</span>    <span class="p">:</span>    <span class="n">FB_FastFault</span> <span class="o">:=</span><span class="p">(</span>
    <span class="n">i_DevName</span> <span class="o">:=</span> <span class="s1">&#39;AT1K0-GAS&#39;</span><span class="p">,</span>
    <span class="n">i_Desc</span> <span class="o">:=</span> <span class="s1">&#39;Fault occurs when the PMPS mode is switched off&#39;</span><span class="p">,</span>
    <span class="n">i_TypeCode</span> <span class="o">:=</span> <span class="mi">16</span><span class="c1">#AAFF);</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span> <span class="n">CONSTANT</span>
    <span class="n">rGasCellLength</span> <span class="p">:</span> <span class="n">REAL</span><span class="o">:=</span> <span class="mf">1450.696</span><span class="p">;</span>
    <span class="n">iTorr</span><span class="p">:</span> <span class="n">INT</span> <span class="o">:=</span><span class="mi">750</span><span class="p">;</span>
    <span class="n">rR_Ar</span><span class="p">:</span><span class="n">REAL</span> <span class="o">:=</span> <span class="mf">1.66e-3</span><span class="p">;</span>
    <span class="n">rR_N2</span><span class="p">:</span><span class="n">REAL</span> <span class="o">:=</span> <span class="mf">1.16e-3</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">A_INIT</span><span class="p">();</span>

<span class="p">(</span><span class="o">*</span><span class="n">Calculate</span> <span class="n">current</span> <span class="n">transmission</span> <span class="n">value</span><span class="o">*</span><span class="p">)</span>
<span class="n">IF</span> <span class="p">(</span> <span class="n">SelectedGas</span> <span class="o">=</span> <span class="n">E_GasType</span><span class="o">.</span><span class="n">Argon</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="n">rCalculatedTransmissionValue</span> <span class="o">:=</span> <span class="n">EXP</span><span class="p">(</span><span class="o">-</span><span class="n">fbCTRL_LIN_INTERPOLATION_Ar</span><span class="o">.</span><span class="n">fOut</span><span class="o">*</span><span class="p">(</span><span class="n">GCM_82</span><span class="o">.</span><span class="n">rPRESS</span><span class="o">/</span><span class="n">iTorr</span><span class="p">)</span><span class="o">*</span><span class="n">rR_Ar</span><span class="o">*</span><span class="n">rGasCellLength</span><span class="p">);</span>
    <span class="n">ELSE</span>
        <span class="n">rCalculatedTransmissionValue</span> <span class="o">:=</span> <span class="n">EXP</span><span class="p">(</span><span class="o">-</span><span class="n">fbCTRL_LIN_INTERPOLATION_N2</span><span class="o">.</span><span class="n">fOut</span><span class="o">*</span><span class="p">(</span><span class="n">GCM_82</span><span class="o">.</span><span class="n">rPRESS</span><span class="o">/</span><span class="n">iTorr</span><span class="p">)</span><span class="o">*</span><span class="n">rR_N2</span><span class="o">*</span><span class="n">rGasCellLength</span><span class="p">);</span>
<span class="n">END_IF</span>
<span class="n">Cur_Trans</span><span class="o">.</span><span class="n">nTran</span><span class="o">:=</span> <span class="n">TO_REAL</span><span class="p">(</span><span class="n">rCalculatedTransmissionValue</span><span class="o">*</span><span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">TRANS_SCALING_FACTOR</span><span class="p">);</span>

<span class="p">(</span><span class="o">*</span><span class="n">Calculate</span> <span class="n">Pressure</span> <span class="n">setpoint</span> <span class="kn">from</span> <span class="nn">requested</span> <span class="n">transmission</span> <span class="n">value</span><span class="o">*</span><span class="p">)</span>
<span class="n">IF</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">TRANS_SCALING_FACTOR</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">rRequestedTransmission</span> <span class="o">:=</span> <span class="p">(</span><span class="n">TO_REAL</span><span class="p">(</span><span class="n">Req_Trans</span><span class="o">.</span><span class="n">nTran</span><span class="p">)</span><span class="o">/</span><span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">TRANS_SCALING_FACTOR</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="p">(</span><span class="o">*</span><span class="n">Transmission</span> <span class="n">Request</span> <span class="n">selection</span><span class="o">*</span><span class="p">)</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">xPMPSMode</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">xPressureControlMode</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">IF</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">TRANS_SCALING_FACTOR</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">THEN</span> <span class="n">TransmissionValue</span> <span class="o">:=</span> <span class="p">(</span><span class="n">TO_REAL</span><span class="p">(</span><span class="n">Req_Trans</span><span class="o">.</span><span class="n">nTran</span><span class="p">)</span><span class="o">/</span><span class="n">PMPS_GVL</span><span class="o">.</span><span class="n">TRANS_SCALING_FACTOR</span><span class="p">);</span> <span class="n">END_IF</span>
    <span class="n">rTransmissionSP</span> <span class="o">:=</span>  <span class="n">LIMIT</span><span class="p">(</span><span class="mf">0.00000000001</span><span class="p">,</span><span class="n">TransmissionValue</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">ELSE</span> <span class="n">TransmissionValue</span> <span class="o">:=</span> <span class="n">LIMIT</span><span class="p">(</span><span class="mf">0.00000000001</span><span class="p">,</span><span class="n">rTransmissionSP</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">END_IF</span>
<span class="o">//</span> <span class="n">Set</span> <span class="n">Status</span> <span class="n">to</span> <span class="n">the</span> <span class="n">arbiter</span>
<span class="n">stStatus</span><span class="o">.</span><span class="n">PMPSMode</span><span class="o">:=</span> <span class="n">xPMPSMode</span><span class="p">;</span>
<span class="n">stStatus</span><span class="o">.</span><span class="n">LocalMode</span> <span class="o">:=</span> <span class="n">NOT</span><span class="p">(</span><span class="n">xPMPSMode</span><span class="p">);</span>


<span class="n">IF</span> <span class="p">(</span> <span class="n">SelectedGas</span> <span class="o">=</span> <span class="n">E_GasType</span><span class="o">.</span><span class="n">Argon</span><span class="p">)</span> <span class="n">THEN</span>
       <span class="k">if</span> <span class="p">(</span><span class="n">fbCTRL_LIN_INTERPOLATION_Ar</span><span class="o">.</span><span class="n">fOut</span> <span class="o">&lt;&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="n">rRequiredPressureSP</span> <span class="o">:=</span> <span class="p">(</span><span class="o">-</span><span class="n">LN</span><span class="p">(</span><span class="n">TransmissionValue</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">fbCTRL_LIN_INTERPOLATION_Ar</span><span class="o">.</span><span class="n">fOut</span><span class="o">*</span><span class="n">rR_Ar</span><span class="o">*</span><span class="n">rGasCellLength</span><span class="p">))</span><span class="o">*</span><span class="n">iTorr</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">ELSE</span>
        <span class="n">IF</span> <span class="p">(</span><span class="n">fbCTRL_LIN_INTERPOLATION_N2</span><span class="o">.</span><span class="n">fOut</span> <span class="o">&lt;&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">rRequiredPressureSP</span> <span class="o">:=</span> <span class="p">(</span><span class="o">-</span><span class="n">LN</span><span class="p">(</span><span class="n">TransmissionValue</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">fbCTRL_LIN_INTERPOLATION_N2</span><span class="o">.</span><span class="n">fOut</span><span class="o">*</span><span class="n">rR_N2</span><span class="o">*</span><span class="n">rGasCellLength</span><span class="p">))</span><span class="o">*</span><span class="n">iTorr</span><span class="p">;</span>
        <span class="n">END_IF</span>

<span class="n">END_IF</span>


<span class="p">(</span><span class="o">*</span><span class="n">FAST</span> <span class="n">FAULT</span><span class="o">*</span><span class="p">)</span>
<span class="n">FFO</span><span class="p">(</span><span class="n">i_xOK</span> <span class="o">:=</span> <span class="n">xPMPSMode</span><span class="p">,</span>
    <span class="n">i_xReset</span> <span class="o">:=</span> <span class="p">,</span>
    <span class="n">i_xAutoReset</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
    <span class="n">io_fbFFHWO</span> <span class="o">:=</span> <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">g_FastFaultOutput1</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>

<span class="n">ACTION</span> <span class="n">A_INIT</span><span class="p">:</span>
<span class="n">IF</span> <span class="n">bInit</span>
<span class="n">THEN</span>


    <span class="p">(</span><span class="o">*</span> <span class="n">init</span> <span class="n">array</span> <span class="k">with</span> <span class="n">the</span> <span class="n">interpolation</span> <span class="n">points</span>  <span class="o">*</span><span class="p">)</span>
    <span class="p">(</span><span class="o">*</span>      <span class="n">fIn</span>             <span class="p">(</span><span class="n">eV</span><span class="p">)</span>                     <span class="o">|</span>              <span class="n">fOut</span> <span class="p">(</span><span class="n">mass</span> <span class="n">coefficient</span><span class="p">)</span>         <span class="o">*</span><span class="p">)</span>

    <span class="p">(</span><span class="o">*</span><span class="n">X</span><span class="o">-</span><span class="n">Ray</span> <span class="n">Mass</span> <span class="n">Attenuation</span> <span class="n">Coefficients</span> <span class="k">for</span> <span class="n">N2</span><span class="o">*</span><span class="p">)</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">201.37</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">7840.7</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">215.2655</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">6694.2</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">230.1188</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">5711.5</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">245.997</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">4870.1</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">262.9708</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">4150.6</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">281.1158</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">3535.8</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">300.5128</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">3011</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">321.2482</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">2563.3</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">343.4143</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">2181.6</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">367.1099</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">1856.4</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">392.4405</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">1579.5</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">393.568</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">1568.6</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">399.592</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">1511.9</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">401.1984</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">1497.3</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">403.608</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">30009</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">409.632</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">29063</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">17</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">419.5189</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">17</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">27603</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">18</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">448.4657</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">18</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">23892</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">19</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">479.4098</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">19</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">20593</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">512.4891</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">17652</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">21</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">547.8508</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">21</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">15059</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">22</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">585.6525</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">22</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">12797</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">23</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">626.0625</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">23</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">10838</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">24</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">669.2609</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">24</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">9153.6</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">25</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">715.4399</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">25</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">7711.4</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">26</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">764.8052</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">26</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">6482.3</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">817.5768</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">27</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">5438.6</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">28</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">873.9896</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">28</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">4555.2</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">29</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">934.2948</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">29</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">3809.4</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">998.7612</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">3181.2</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">31</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">1067.676</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">31</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">2651</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">32</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">1141.345</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">32</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">2206.1</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">33</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">1220.098</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">33</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">1833.6</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">34</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">1304.285</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">34</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">1522.5</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">35</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">1394.281</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">35</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">1263.2</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">36</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">1490.486</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">36</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">1047.3</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">37</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">1593.329</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">37</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">867.89</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">38</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">1703.269</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">38</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">715.55</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">39</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">1820.795</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">39</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">589.6</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">40</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">1946.43</span><span class="p">;</span>    <span class="n">arr_COEF_Table_N2</span><span class="p">[</span><span class="mi">40</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">485.83</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span> <span class="n">init</span> <span class="n">parameter</span> <span class="n">struct</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS_N2</span><span class="o">.</span><span class="n">tCtrlCycleTime</span>                                       <span class="o">:=</span> <span class="n">T</span><span class="c1">#10ms;</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS_N2</span><span class="o">.</span><span class="n">tTaskCycleTime</span>                                       <span class="o">:=</span> <span class="n">T</span><span class="c1">#10ms;</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS_N2</span><span class="o">.</span><span class="n">nDataTable_NumberOfRows</span>              <span class="o">:=</span> <span class="n">INT_TO_UINT</span><span class="p">(</span><span class="mi">40</span><span class="p">);</span>

    <span class="p">(</span><span class="o">*</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">addresses</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS_N2</span><span class="o">.</span><span class="n">pDataTable_ADR</span>                       <span class="o">:=</span> <span class="n">ADR</span><span class="p">(</span><span class="n">arr_COEF_Table_N2</span><span class="p">);</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS_N2</span><span class="o">.</span><span class="n">nDataTable_SIZEOF</span>            <span class="o">:=</span> <span class="n">SIZEOF</span><span class="p">(</span><span class="n">arr_COEF_Table_N2</span><span class="p">);</span>

    <span class="p">(</span><span class="o">*</span><span class="n">X</span><span class="o">-</span><span class="n">Ray</span> <span class="n">Mass</span> <span class="n">Attenuation</span> <span class="n">Coefficients</span> <span class="k">for</span> <span class="n">Ar</span><span class="o">*</span><span class="p">)</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">201.3709</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">6332.4</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">215.2655</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">5911.6</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">230.1188</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">5492.2</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">240.296</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">5153.8</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">242.354</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">5083</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">243.974</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">5028</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">244.9548</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">4995</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">245.997</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">50587</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">246.0635</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">50556</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">246.426</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">50385</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">247.0527</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">50090</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">248.5365</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">71652</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">250.104</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">70616</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">252.246</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">69234</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">262.9708</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">62861</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">281.1158</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">53865</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">17</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">300.5128</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">17</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">46248</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">18</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">313.6</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">18</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">41979</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">19</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">318.4</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">19</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">40556</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">319.68</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">40189</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">21</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">321.2482</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">21</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">44258</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">22</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">321.6</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">22</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">44155</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">23</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">326.4</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">23</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">42786</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">24</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">343.4143</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">24</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">38407</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">25</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">367.1099</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">25</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">33319</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">26</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">392.4405</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">26</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">28856</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">27</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">419.5189</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">27</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">24938</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">28</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">448.4657</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">28</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">21501</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">29</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">479.4098</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">29</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">18493</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">512.4891</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">15863</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">31</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">547.8508</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">31</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">13574</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">32</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">585.6525</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">32</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">11589</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">33</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">626.0625</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">33</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">9873.1</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">34</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">669.2609</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">34</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">8394.2</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">35</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">715.4399</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">35</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">7123.6</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">36</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">764.8052</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">36</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">6035.4</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">37</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">817.5768</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">37</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">5105.8</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">38</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">873.9896</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">38</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">4313.6</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">39</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">934.2948</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">39</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">3639.9</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">40</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">998.7612</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">40</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">3068.4</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">41</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">1067.676</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">41</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">2558</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">42</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">1141.345</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">42</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">2133.7</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">43</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">1220.098</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">43</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">1781.3</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">44</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">1304.285</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">44</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">1486.6</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">45</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">1394.281</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">45</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mi">1238</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">46</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">1490.486</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">46</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">1031.9</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">47</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">1593.329</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">47</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">861.03</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">48</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">1703.269</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">48</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">719.19</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">49</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">1820.795</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">49</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">601.34</span><span class="p">;</span>
    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">:=</span><span class="mf">1946.43</span><span class="p">;</span>    <span class="n">arr_COEF_Table_Ar</span><span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">:=</span><span class="mf">503.35</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span> <span class="n">init</span> <span class="n">parameter</span> <span class="n">struct</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS_Ar</span><span class="o">.</span><span class="n">tCtrlCycleTime</span>                                       <span class="o">:=</span> <span class="n">T</span><span class="c1">#10ms;</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS_Ar</span><span class="o">.</span><span class="n">tTaskCycleTime</span>                                       <span class="o">:=</span> <span class="n">T</span><span class="c1">#10ms;</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS_Ar</span><span class="o">.</span><span class="n">nDataTable_NumberOfRows</span>              <span class="o">:=</span> <span class="n">INT_TO_UINT</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>

    <span class="p">(</span><span class="o">*</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">addresses</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS_Ar</span><span class="o">.</span><span class="n">pDataTable_ADR</span>                       <span class="o">:=</span> <span class="n">ADR</span><span class="p">(</span><span class="n">arr_COEF_Table_Ar</span><span class="p">);</span>
    <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS_Ar</span><span class="o">.</span><span class="n">nDataTable_SIZEOF</span>            <span class="o">:=</span> <span class="n">SIZEOF</span><span class="p">(</span><span class="n">arr_COEF_Table_Ar</span><span class="p">);</span>

    <span class="p">(</span><span class="o">*</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">mode</span> <span class="n">to</span> <span class="n">ACTIVE</span> <span class="o">--&gt;</span> <span class="n">normal</span> <span class="n">operation</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">eMode</span>                                                   <span class="o">:=</span> <span class="n">eCTRL_MODE_ACTIVE</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span> <span class="n">reset</span> <span class="n">the</span> <span class="n">init</span> <span class="n">flag</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">bInit</span>                                                   <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>




<span class="n">fbCTRL_LIN_INTERPOLATION_Ar</span><span class="p">(</span>
    <span class="n">fIn</span><span class="o">:=</span> <span class="n">rPhotonEnergy</span> <span class="p">,</span>
    <span class="n">fManValue</span><span class="o">:=</span> <span class="mi">1</span> <span class="p">,</span>
    <span class="n">bExtrapolate</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
    <span class="n">eMode</span><span class="o">:=</span> <span class="n">eMode</span><span class="p">,</span>
    <span class="n">stParams</span><span class="o">:=</span> <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS_Ar</span><span class="p">,</span>
    <span class="n">fOut</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">bInIsGreaterThanMaxElement</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">bInIsLessThanMinElement</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">eState</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">eErrorId</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">bError</span><span class="o">=&gt;</span> <span class="p">);</span>

<span class="n">fbCTRL_LIN_INTERPOLATION_N2</span><span class="p">(</span>
    <span class="n">fIn</span><span class="o">:=</span> <span class="n">rPhotonEnergy</span> <span class="p">,</span>
    <span class="n">fManValue</span><span class="o">:=</span> <span class="mi">1</span> <span class="p">,</span>
    <span class="n">bExtrapolate</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
    <span class="n">eMode</span><span class="o">:=</span> <span class="n">eMode</span><span class="p">,</span>
    <span class="n">stParams</span><span class="o">:=</span> <span class="n">stCTRL_LIN_INTERPOLATION_PARAMS_N2</span><span class="p">,</span>
    <span class="n">fOut</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">bInIsGreaterThanMaxElement</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">bInIsLessThanMinElement</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">eState</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">eErrorId</span><span class="o">=&gt;</span> <span class="p">,</span>
    <span class="n">bError</span><span class="o">=&gt;</span> <span class="p">);</span>
<span class="n">END_ACTION</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#e-gastype">E_GasType</a></p></li>
<li><p><a class="reference internal" href="#gvl-pmps">GVL_PMPS</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-vgp">
<h2>PRG_VGP<a class="headerlink" href="#prg-vgp" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_VGP</span>
<span class="n">VAR</span>
    <span class="n">arrTable</span>                                                                                        <span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1..14</span><span class="p">,</span><span class="mf">1..2</span><span class="p">]</span> <span class="n">OF</span> <span class="n">FLOAT</span><span class="p">;</span>
    <span class="n">arrTable_ENC</span>                                                                            <span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1..14</span><span class="p">,</span><span class="mf">1..2</span><span class="p">]</span> <span class="n">OF</span> <span class="n">FLOAT</span><span class="p">;</span>

    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span><span class="o">:=</span><span class="n">true</span><span class="p">;</span>

    <span class="n">VGP_REQ_POS</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">VGP_OUT_POS</span><span class="p">:</span><span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">bInit</span>
<span class="n">THEN</span>


    <span class="p">(</span><span class="o">*</span> <span class="n">init</span> <span class="n">array</span> <span class="k">with</span> <span class="n">the</span> <span class="n">interpolation</span> <span class="n">points</span>  <span class="o">*</span><span class="p">)</span>
    <span class="p">(</span><span class="o">*</span>      <span class="n">fIn</span>                                      <span class="o">|</span>              <span class="n">fOut</span>            <span class="o">*</span><span class="p">)</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>                     <span class="n">arrTable</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">5</span><span class="p">;</span>                 <span class="n">arrTable</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">160</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">10</span><span class="p">;</span>            <span class="n">arrTable</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">270</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span>  <span class="mi">20</span><span class="p">;</span>       <span class="n">arrTable</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">435</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span>  <span class="mi">30</span><span class="p">;</span>       <span class="n">arrTable</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">570</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">40</span><span class="p">;</span>            <span class="n">arrTable</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">720</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">50</span><span class="p">;</span>            <span class="n">arrTable</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">854</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">60</span><span class="p">;</span>        <span class="n">arrTable</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">980</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">70</span><span class="p">;</span>        <span class="n">arrTable</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">1120</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">80</span><span class="p">;</span>           <span class="n">arrTable</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">1270</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">90</span><span class="p">;</span>           <span class="n">arrTable</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">1430</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">95</span><span class="p">;</span>           <span class="n">arrTable</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">1540</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">98</span><span class="p">;</span>           <span class="n">arrTable</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">1595</span><span class="p">;</span>
    <span class="n">arrTable</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">100</span><span class="p">;</span>          <span class="n">arrTable</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">:=</span> <span class="mi">1680</span><span class="p">;</span>


    <span class="p">(</span><span class="o">*</span> <span class="n">reset</span> <span class="n">the</span> <span class="n">init</span> <span class="n">flag</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">bInit</span>                                                   <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">VGP_80</span><span class="o">.</span><span class="n">i_xOpenIlkOK</span> <span class="o">:=</span> <span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_80</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">)</span> <span class="p">;</span>

<span class="n">VGP_80</span><span class="p">(</span>
    <span class="n">i_xExtIlkOK</span><span class="o">:=</span><span class="p">(</span><span class="n">fb_AT1K0_GAS_PTM_80</span><span class="o">.</span><span class="n">iq_stPtm</span><span class="o">.</span><span class="n">eState</span> <span class="o">=</span> <span class="n">pumpRUNNING</span><span class="p">),</span>
    <span class="n">i_ReqPos</span><span class="o">:=</span>  <span class="p">,</span>
    <span class="n">arrTable</span><span class="o">:=</span> <span class="n">arrTable</span> <span class="p">,</span>
    <span class="n">q_stVGP</span><span class="o">=&gt;</span> <span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="plc-kfe-gatt_plc_kfe_gatt_epics.html" class="btn btn-neutral float-left" title="Data Types" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, SLAC National Accelerator Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>